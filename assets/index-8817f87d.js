(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const style="";function peg$subclass(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}function peg$SyntaxError(t,r,e,o){var n=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(n,peg$SyntaxError.prototype),n.expected=r,n.found=e,n.location=o,n.name="SyntaxError",n}peg$subclass(peg$SyntaxError,Error);function peg$padEnd(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,e+=e.repeat(r),t+e.slice(0,r))}peg$SyntaxError.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var e=null,o;for(o=0;o<t.length;o++)if(t[o].source===this.location.source){e=t[o].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,a=this.location.source+":"+n.line+":"+n.column;if(e){var l=this.location.end,u=peg$padEnd("",n.line.toString().length," "),p=e[n.line-1],f=n.line===l.line?l.column:p.length+1,h=f-n.column||1;r+=`
 --> `+a+`
`+u+` |
`+n.line+" | "+p+`
`+u+" | "+peg$padEnd("",n.column-1," ")+peg$padEnd("",h,"^")}else r+=`
 at `+a}return r};peg$SyntaxError.buildMessage=function(t,r){var e={literal:function(f){return'"'+n(f.text)+'"'},class:function(f){var h=f.parts.map(function(E){return Array.isArray(E)?a(E[0])+"-"+a(E[1]):a(E)});return"["+(f.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function o(f){return f.charCodeAt(0).toString(16).toUpperCase()}function n(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+o(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+o(h)})}function a(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+o(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+o(h)})}function l(f){return e[f.type](f)}function u(f){var h=f.map(l),E,F;if(h.sort(),h.length>0){for(E=1,F=1;E<h.length;E++)h[E-1]!==h[E]&&(h[F]=h[E],F++);h.length=F}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function p(f){return f?'"'+n(f)+'"':"end of input"}return"Expected "+u(t)+" but "+p(r)+" found."};function peg$parse(t,r){r=r!==void 0?r:{};var e={},o=r.grammarSource,n={start:Ce},a=Ce,l=".",u="true",p="True",f="false",h="False",E="{",F="}",_="audio",b="time",B="rect",U="diffuse(",I=")",w="rateA(",d="rateB(",V="feed(",R="kill(",T="size(",C="wait(",M="reset",D="automata(",k="playMusic(",q="pauseMusic",W="#",K="rgb(",z=",",Z="colorA(",N="colorB(",Q="kal",S="blur",m="celShade",$="foggy",L="light",G="noise",ie="oldFilm",oe="vignette",he="size",xe="side",_e="noEffect",ke="(",qe=/^[0-9]/,Oe=/^[1-9]/,ve=/^[^{}]/,$e=/^[ \t\n\r]/,be=/^[^{} \t\n\r]/,Ge=/^[0-9A-Fa-f]/,je=ne("start"),We=ne("term"),Xe=A(".",!1),ze=te([["0","9"]],!1,!1),He=te([["1","9"]],!1,!1),Ke=A("true",!1),Ye=A("True",!1),Je=A("false",!1),Qe=A("False",!1),Ze=ne("primary"),Ee=te(["{","}"],!0,!1),er=A("{",!1),rr=A("}",!1),tr=ne("whitespace"),ye=te([" ","	",`
`,"\r"],!1,!1),sr=ne("keyword"),we=te(["{","}"," ","	",`
`,"\r"],!0,!1),or=A("audio",!1),nr=A("time",!1),ar=A("rect",!1),ir=A("diffuse(",!1),X=A(")",!1),lr=A("rateA(",!1),cr=A("rateB(",!1),ur=A("feed(",!1),pr=A("kill(",!1),fr=A("size(",!1),gr=A("wait(",!1),mr=A("reset",!1),dr=A("automata(",!1),hr=A("playMusic(",!1),xr=A("pauseMusic",!1),_r=te([["0","9"],["A","F"],["a","f"]],!1,!1),vr=A("#",!1),$r=A("rgb(",!1),Fe=A(",",!1),br=A("colorA(",!1),Er=A("colorB(",!1),yr=A("kal",!1),wr=A("blur",!1),Fr=A("celShade",!1),Sr=A("foggy",!1),Tr=A("light",!1),Cr=A("noise",!1),Vr=A("oldFilm",!1),Ar=A("vignette",!1),Br=A("size",!1),Mr=A("side",!1),Rr=A("noEffect",!1),Ir=A("(",!1),Pr=function(s){return s},Lr=function(){return"true"},Dr=function(){return"false"},Ur=function(s,c){return parseFloat(`${s}`)+parseFloat(`${c}`)},Nr=function(s,c){return parseFloat(`.${c}`)},kr=function(s,c){return parseInt(`${fe()}`)},qr=function(){return fe()},Or=function(s){return s.join("")},Gr=function(){return"'audio'"},jr=function(){return Date.getTime},Wr=function(s,c,g,x){var O=`shape.rect( ${s}, ${c}, ${g}, ${x} )`;return O},Xr=function(s){return`setDiffuse(${s})`},zr=function(s){return`rateA(${s})`},Hr=function(s){return`rateB(${s})`},Kr=function(s){return`feed(${s})`},Yr=function(s){return`kill(${s})`},Jr=function(s){return`size(${s})`},Qr=function(s){return`wait(${s}*1000)`},Zr=function(){return"reset()"},et=function(s){return`setAutomata(${s})`},rt=function(s){return`playMusic(${s})`},tt=function(){return"pauseMusic()"},st=function(s){return`${s}`},ot=function(s){return`"#${s.join("")}"`},nt=function(){return fe()},at=function(s){return`col.setColor( "A", ${s} )`},it=function(s){return`col.setColor("B", "${s}")`},lt=function(){return"noEffect()"},ct=function(s){return`postEffect("${s}")`},ut=function(s){return`${s}`},pt=function(s,c,g){return`setEffect('${s}', '${c}', ${g})`},i=0,P=0,le=[{line:1,column:1}],Y=0,pe=[],v=0,ce;if("startRule"in r){if(!(r.startRule in n))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');a=n[r.startRule]}function fe(){return t.substring(P,i)}function A(s,c){return{type:"literal",text:s,ignoreCase:c}}function te(s,c,g){return{type:"class",parts:s,inverted:c,ignoreCase:g}}function ft(){return{type:"end"}}function ne(s){return{type:"other",description:s}}function Se(s){var c=le[s],g;if(c)return c;for(g=s-1;!le[g];)g--;for(c=le[g],c={line:c.line,column:c.column};g<s;)t.charCodeAt(g)===10?(c.line++,c.column=1):c.column++,g++;return le[s]=c,c}function Te(s,c){var g=Se(s),x=Se(c);return{source:o,start:{offset:s,line:g.line,column:g.column},end:{offset:c,line:x.line,column:x.column}}}function y(s){i<Y||(i>Y&&(Y=i,pe=[]),pe.push(s))}function gt(s,c,g){return new peg$SyntaxError(peg$SyntaxError.buildMessage(s,c),s,c,g)}function Ce(){var s,c;if(v++,s=[],c=Ve(),c!==e)for(;c!==e;)s.push(c),c=Ve();else s=e;return v--,s===e&&(c=e,v===0&&y(je)),s}function Ve(){var s,c;return v++,s=i,ee(),c=$t(),c===e&&(c=vt()),c!==e?(ee(),P=s,s=Pr(c)):(i=s,s=e),v--,s===e&&v===0&&y(We),s}function Ae(){var s;return t.charCodeAt(i)===46?(s=l,i++):(s=e,v===0&&y(Xe)),s}function ue(){var s;return qe.test(t.charAt(i))?(s=t.charAt(i),i++):(s=e,v===0&&y(ze)),s}function mt(){var s;return Oe.test(t.charAt(i))?(s=t.charAt(i),i++):(s=e,v===0&&y(He)),s}function dt(){var s,c;return t.substr(i,4)===u?(s=u,i+=4):(s=e,v===0&&y(Ke)),s===e&&(s=i,t.substr(i,4)===p?(c=p,i+=4):(c=e,v===0&&y(Ye)),c!==e&&(P=s,c=Lr()),s=c),s}function ht(){var s,c;return t.substr(i,5)===f?(s=f,i+=5):(s=e,v===0&&y(Je)),s===e&&(s=i,t.substr(i,5)===h?(c=h,i+=5):(c=e,v===0&&y(Qe)),c!==e&&(P=s,c=Dr()),s=c),s}function H(){var s;return v++,s=xt(),s===e&&(s=ge()),v--,s===e&&v===0&&y(Ze),s}function xt(){var s,c,g;return s=i,c=ge(),c!==e?(g=_t(),g!==e?(P=s,s=Ur(c,g)):(i=s,s=e)):(i=s,s=e),s}function _t(){var s,c,g,x;if(s=i,c=Ae(),c!==e){if(g=[],x=ue(),x!==e)for(;x!==e;)g.push(x),x=ue();else g=e;g!==e?(P=s,s=Nr(c,g)):(i=s,s=e)}else i=s,s=e;return s}function ge(){var s,c,g,x;if(s=i,c=mt(),c!==e){for(g=[],x=ue();x!==e;)g.push(x),x=ue();P=s,s=kr()}else i=s,s=e;return s}function Be(){var s;return s=dt(),s===e&&(s=ht()),s}function me(){var s,c,g;if(s=i,c=[],ve.test(t.charAt(i))?(g=t.charAt(i),i++):(g=e,v===0&&y(Ee)),g!==e)for(;g!==e;)c.push(g),ve.test(t.charAt(i))?(g=t.charAt(i),i++):(g=e,v===0&&y(Ee));else c=e;return c!==e&&(P=s,c=qr()),s=c,s}function Me(){var s,c;for(s=[],c=me();c!==e;)s.push(c),c=me();return s}function vt(){var s,c,g,x;return s=i,t.charCodeAt(i)===123?(c=E,i++):(c=e,v===0&&y(er)),c!==e?(g=Me(),t.charCodeAt(i)===125?(x=F,i++):(x=e,v===0&&y(rr)),x!==e?(P=s,s=Or(g)):(i=s,s=e)):(i=s,s=e),s===e&&(s=me()),s}function ee(){var s,c;for(v++,s=[],$e.test(t.charAt(i))?(c=t.charAt(i),i++):(c=e,v===0&&y(ye));c!==e;)s.push(c),$e.test(t.charAt(i))?(c=t.charAt(i),i++):(c=e,v===0&&y(ye));return v--,c=e,v===0&&y(tr),s}function $t(){var s,c,g;if(v++,s=Rt(),s===e&&(s=yt(),s===e&&(s=Ct(),s===e&&(s=Dt(),s===e&&(s=Tt(),s===e&&(s=Vt(),s===e&&(s=Re(),s===e&&(s=bt(),s===e&&(s=Et(),s===e&&(s=Ie(),s===e&&(s=Pe(),s===e&&(s=Le(),s===e&&(s=De(),s===e&&(s=St(),s===e&&(s=H(),s===e&&(s=Ue(),s===e)))))))))))))))){if(s=i,c=[],be.test(t.charAt(i))?(g=t.charAt(i),i++):(g=e,v===0&&y(we)),g!==e)for(;g!==e;)c.push(g),be.test(t.charAt(i))?(g=t.charAt(i),i++):(g=e,v===0&&y(we));else c=e;c!==e?s=t.substring(s,i):s=c}return v--,s===e&&(c=e,v===0&&y(sr)),s}function Re(){var s,c;return s=i,t.substr(i,5)===_?(c=_,i+=5):(c=e,v===0&&y(or)),c!==e&&(P=s,c=Gr()),s=c,s}function bt(){var s,c;return s=i,t.substr(i,4)===b?(c=b,i+=4):(c=e,v===0&&y(nr)),c!==e&&(P=s,c=jr()),s=c,s}function Et(){var s,c,g,x,O,j;return s=i,t.substr(i,4)===B?(c=B,i+=4):(c=e,v===0&&y(ar)),c!==e?(ee(),g=H(),g!==e?(ee(),x=H(),x!==e?(ee(),O=H(),O!==e?(ee(),j=H(),j!==e?(P=s,s=Wr(g,x,O,j)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function yt(){var s;return s=wt(),s===e&&(s=Ie(),s===e&&(s=Pe(),s===e&&(s=Le(),s===e&&(s=De(),s===e&&(s=Ft()))))),s}function ae(){var s;return s=H(),s===e&&(s=Re()),s}function wt(){var s,c,g,x;return s=i,t.substr(i,8)===U?(c=U,i+=8):(c=e,v===0&&y(ir)),c!==e?(g=Be(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=Xr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Ie(){var s,c,g,x;return s=i,t.substr(i,6)===w?(c=w,i+=6):(c=e,v===0&&y(lr)),c!==e?(g=ae(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=zr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Pe(){var s,c,g,x;return s=i,t.substr(i,6)===d?(c=d,i+=6):(c=e,v===0&&y(cr)),c!==e?(g=ae(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=Hr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Le(){var s,c,g,x;return s=i,t.substr(i,5)===V?(c=V,i+=5):(c=e,v===0&&y(ur)),c!==e?(g=ae(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=Kr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function De(){var s,c,g,x;return s=i,t.substr(i,5)===R?(c=R,i+=5):(c=e,v===0&&y(pr)),c!==e?(g=ae(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=Yr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Ft(){var s,c,g,x;return s=i,t.substr(i,5)===T?(c=T,i+=5):(c=e,v===0&&y(fr)),c!==e?(g=ae(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=Jr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function St(){var s,c,g,x;return s=i,t.substr(i,5)===C?(c=C,i+=5):(c=e,v===0&&y(gr)),c!==e?(g=H(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=Qr(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Tt(){var s,c;return s=i,t.substr(i,5)===M?(c=M,i+=5):(c=e,v===0&&y(mr)),c!==e&&(P=s,c=Zr()),s=c,s}function Ct(){var s,c,g,x;return s=i,t.substr(i,9)===D?(c=D,i+=9):(c=e,v===0&&y(dr)),c!==e?(g=Be(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=et(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Vt(){var s;return s=At(),s===e&&(s=Bt()),s}function At(){var s,c,g,x;return s=i,t.substr(i,10)===k?(c=k,i+=10):(c=e,v===0&&y(hr)),c!==e?(g=ge(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=rt(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Bt(){var s,c;return s=i,t.substr(i,10)===q?(c=q,i+=10):(c=e,v===0&&y(xr)),c!==e&&(P=s,c=tt()),s=c,s}function se(){var s,c;return s=i,Ge.test(t.charAt(i))?(c=t.charAt(i),i++):(c=e,v===0&&y(_r)),c!==e&&(P=s,c=st(c)),s=c,s}function Ue(){var s,c,g,x,O,j,J,re,de;return s=i,t.charCodeAt(i)===35?(c=W,i++):(c=e,v===0&&y(vr)),c!==e?(g=i,x=se(),x!==e?(O=se(),O!==e?(j=se(),j!==e?(J=se(),J!==e?(re=se(),re!==e?(de=se(),de!==e?(x=[x,O,j,J,re,de],g=x):(i=g,g=e)):(i=g,g=e)):(i=g,g=e)):(i=g,g=e)):(i=g,g=e)):(i=g,g=e),g!==e?(P=s,s=ot(g)):(i=s,s=e)):(i=s,s=e),s}function Mt(){var s,c,g,x,O,j,J,re;return s=i,t.substr(i,4)===K?(c=K,i+=4):(c=e,v===0&&y($r)),c!==e?(g=H(),g!==e?(t.charCodeAt(i)===44?(x=z,i++):(x=e,v===0&&y(Fe)),x!==e?(O=H(),O!==e?(t.charCodeAt(i)===44?(j=z,i++):(j=e,v===0&&y(Fe)),j!==e?(J=H(),J!==e?(t.charCodeAt(i)===41?(re=I,i++):(re=e,v===0&&y(X)),re!==e?(P=s,s=nt()):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Rt(){var s;return s=Pt(),s===e&&(s=Lt()),s}function It(){var s;return s=Ue(),s===e&&(s=Mt()),s}function Pt(){var s,c,g,x;return s=i,t.substr(i,7)===Z?(c=Z,i+=7):(c=e,v===0&&y(br)),c!==e?(g=It(),g!==e?(t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=at(g)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}function Lt(){var s,c,g,x;return s=i,t.substr(i,7)===N?(c=N,i+=7):(c=e,v===0&&y(Er)),c!==e?(g=Me(),t.charCodeAt(i)===41?(x=I,i++):(x=e,v===0&&y(X)),x!==e?(P=s,s=it(g)):(i=s,s=e)):(i=s,s=e),s}function Dt(){var s;return s=Ot(),s===e&&(s=Nt(),s===e&&(s=kt())),s}function Ne(){var s;return t.substr(i,3)===Q?(s=Q,i+=3):(s=e,v===0&&y(yr)),s===e&&(t.substr(i,4)===S?(s=S,i+=4):(s=e,v===0&&y(wr)),s===e&&(t.substr(i,8)===m?(s=m,i+=8):(s=e,v===0&&y(Fr)),s===e&&(t.substr(i,5)===$?(s=$,i+=5):(s=e,v===0&&y(Sr)),s===e&&(t.substr(i,5)===L?(s=L,i+=5):(s=e,v===0&&y(Tr)),s===e&&(t.substr(i,5)===G?(s=G,i+=5):(s=e,v===0&&y(Cr)),s===e&&(t.substr(i,7)===ie?(s=ie,i+=7):(s=e,v===0&&y(Vr)),s===e&&(t.substr(i,8)===oe?(s=oe,i+=8):(s=e,v===0&&y(Ar))))))))),s}function Ut(){var s;return t.substr(i,4)===he?(s=he,i+=4):(s=e,v===0&&y(Br)),s===e&&(t.substr(i,4)===xe?(s=xe,i+=4):(s=e,v===0&&y(Mr))),s}function Nt(){var s,c;return s=i,t.substr(i,8)===_e?(c=_e,i+=8):(c=e,v===0&&y(Rr)),c!==e&&(P=s,c=lt()),s=c,s}function kt(){var s,c;return s=i,c=Ne(),c!==e?(ee(),P=s,s=ct(c)):(i=s,s=e),s}function qt(){var s,c;return s=i,c=Ut(),c!==e&&(P=s,c=ut(c)),s=c,s}function Ot(){var s,c,g,x,O,j,J;return s=i,c=Ne(),c!==e?(g=Ae(),g!==e?(x=qt(),x!==e?(t.charCodeAt(i)===40?(O=ke,i++):(O=e,v===0&&y(Ir)),O!==e?(j=H(),j!==e?(t.charCodeAt(i)===41?(J=I,i++):(J=e,v===0&&y(X)),J!==e?(P=s,s=pt(c,x,j)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e)):(i=s,s=e),s}if(ce=a(),ce!==e&&i===t.length)return ce;throw ce!==e&&i<t.length&&y(ft()),gt(pe,Y<t.length?t.charAt(Y):null,Y<t.length?Te(Y,Y+1):Te(Y,Y))}function rect(t,r,e,o){for(var n=0;n<window.innerWidth;n++)for(var a=0;a<window.innerHeight;a++)n>=t&&n<=t+e&&a<=r+o&&a>=r?poking(n,a,0,255,0):poking(n,a,255,0,0);console.log("rect")}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const cssKeywords=colorName,reverseKeywords={};for(const t of Object.keys(cssKeywords))reverseKeywords[cssKeywords[t]]=t;const convert$1={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};var conversions$2=convert$1;for(const t of Object.keys(convert$1)){if(!("channels"in convert$1[t]))throw new Error("missing channels property: "+t);if(!("labels"in convert$1[t]))throw new Error("missing channel labels property: "+t);if(convert$1[t].labels.length!==convert$1[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:r,labels:e}=convert$1[t];delete convert$1[t].channels,delete convert$1[t].labels,Object.defineProperty(convert$1[t],"channels",{value:r}),Object.defineProperty(convert$1[t],"labels",{value:e})}convert$1.rgb.hsl=function(t){const r=t[0]/255,e=t[1]/255,o=t[2]/255,n=Math.min(r,e,o),a=Math.max(r,e,o),l=a-n;let u,p;a===n?u=0:r===a?u=(e-o)/l:e===a?u=2+(o-r)/l:o===a&&(u=4+(r-e)/l),u=Math.min(u*60,360),u<0&&(u+=360);const f=(n+a)/2;return a===n?p=0:f<=.5?p=l/(a+n):p=l/(2-a-n),[u,p*100,f*100]};convert$1.rgb.hsv=function(t){let r,e,o,n,a;const l=t[0]/255,u=t[1]/255,p=t[2]/255,f=Math.max(l,u,p),h=f-Math.min(l,u,p),E=function(F){return(f-F)/6/h+1/2};return h===0?(n=0,a=0):(a=h/f,r=E(l),e=E(u),o=E(p),l===f?n=o-e:u===f?n=1/3+r-o:p===f&&(n=2/3+e-r),n<0?n+=1:n>1&&(n-=1)),[n*360,a*100,f*100]};convert$1.rgb.hwb=function(t){const r=t[0],e=t[1];let o=t[2];const n=convert$1.rgb.hsl(t)[0],a=1/255*Math.min(r,Math.min(e,o));return o=1-1/255*Math.max(r,Math.max(e,o)),[n,a*100,o*100]};convert$1.rgb.cmyk=function(t){const r=t[0]/255,e=t[1]/255,o=t[2]/255,n=Math.min(1-r,1-e,1-o),a=(1-r-n)/(1-n)||0,l=(1-e-n)/(1-n)||0,u=(1-o-n)/(1-n)||0;return[a*100,l*100,u*100,n*100]};function comparativeDistance(t,r){return(t[0]-r[0])**2+(t[1]-r[1])**2+(t[2]-r[2])**2}convert$1.rgb.keyword=function(t){const r=reverseKeywords[t];if(r)return r;let e=1/0,o;for(const n of Object.keys(cssKeywords)){const a=cssKeywords[n],l=comparativeDistance(t,a);l<e&&(e=l,o=n)}return o};convert$1.keyword.rgb=function(t){return cssKeywords[t]};convert$1.rgb.xyz=function(t){let r=t[0]/255,e=t[1]/255,o=t[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92;const n=r*.4124+e*.3576+o*.1805,a=r*.2126+e*.7152+o*.0722,l=r*.0193+e*.1192+o*.9505;return[n*100,a*100,l*100]};convert$1.rgb.lab=function(t){const r=convert$1.rgb.xyz(t);let e=r[0],o=r[1],n=r[2];e/=95.047,o/=100,n/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;const a=116*o-16,l=500*(e-o),u=200*(o-n);return[a,l,u]};convert$1.hsl.rgb=function(t){const r=t[0]/360,e=t[1]/100,o=t[2]/100;let n,a,l;if(e===0)return l=o*255,[l,l,l];o<.5?n=o*(1+e):n=o+e-o*e;const u=2*o-n,p=[0,0,0];for(let f=0;f<3;f++)a=r+1/3*-(f-1),a<0&&a++,a>1&&a--,6*a<1?l=u+(n-u)*6*a:2*a<1?l=n:3*a<2?l=u+(n-u)*(2/3-a)*6:l=u,p[f]=l*255;return p};convert$1.hsl.hsv=function(t){const r=t[0];let e=t[1]/100,o=t[2]/100,n=e;const a=Math.max(o,.01);o*=2,e*=o<=1?o:2-o,n*=a<=1?a:2-a;const l=(o+e)/2,u=o===0?2*n/(a+n):2*e/(o+e);return[r,u*100,l*100]};convert$1.hsv.rgb=function(t){const r=t[0]/60,e=t[1]/100;let o=t[2]/100;const n=Math.floor(r)%6,a=r-Math.floor(r),l=255*o*(1-e),u=255*o*(1-e*a),p=255*o*(1-e*(1-a));switch(o*=255,n){case 0:return[o,p,l];case 1:return[u,o,l];case 2:return[l,o,p];case 3:return[l,u,o];case 4:return[p,l,o];case 5:return[o,l,u]}};convert$1.hsv.hsl=function(t){const r=t[0],e=t[1]/100,o=t[2]/100,n=Math.max(o,.01);let a,l;l=(2-e)*o;const u=(2-e)*n;return a=e*n,a/=u<=1?u:2-u,a=a||0,l/=2,[r,a*100,l*100]};convert$1.hwb.rgb=function(t){const r=t[0]/360;let e=t[1]/100,o=t[2]/100;const n=e+o;let a;n>1&&(e/=n,o/=n);const l=Math.floor(6*r),u=1-o;a=6*r-l,l&1&&(a=1-a);const p=e+a*(u-e);let f,h,E;switch(l){default:case 6:case 0:f=u,h=p,E=e;break;case 1:f=p,h=u,E=e;break;case 2:f=e,h=u,E=p;break;case 3:f=e,h=p,E=u;break;case 4:f=p,h=e,E=u;break;case 5:f=u,h=e,E=p;break}return[f*255,h*255,E*255]};convert$1.cmyk.rgb=function(t){const r=t[0]/100,e=t[1]/100,o=t[2]/100,n=t[3]/100,a=1-Math.min(1,r*(1-n)+n),l=1-Math.min(1,e*(1-n)+n),u=1-Math.min(1,o*(1-n)+n);return[a*255,l*255,u*255]};convert$1.xyz.rgb=function(t){const r=t[0]/100,e=t[1]/100,o=t[2]/100;let n,a,l;return n=r*3.2406+e*-1.5372+o*-.4986,a=r*-.9689+e*1.8758+o*.0415,l=r*.0557+e*-.204+o*1.057,n=n>.0031308?1.055*n**(1/2.4)-.055:n*12.92,a=a>.0031308?1.055*a**(1/2.4)-.055:a*12.92,l=l>.0031308?1.055*l**(1/2.4)-.055:l*12.92,n=Math.min(Math.max(0,n),1),a=Math.min(Math.max(0,a),1),l=Math.min(Math.max(0,l),1),[n*255,a*255,l*255]};convert$1.xyz.lab=function(t){let r=t[0],e=t[1],o=t[2];r/=95.047,e/=100,o/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;const n=116*e-16,a=500*(r-e),l=200*(e-o);return[n,a,l]};convert$1.lab.xyz=function(t){const r=t[0],e=t[1],o=t[2];let n,a,l;a=(r+16)/116,n=e/500+a,l=a-o/200;const u=a**3,p=n**3,f=l**3;return a=u>.008856?u:(a-16/116)/7.787,n=p>.008856?p:(n-16/116)/7.787,l=f>.008856?f:(l-16/116)/7.787,n*=95.047,a*=100,l*=108.883,[n,a,l]};convert$1.lab.lch=function(t){const r=t[0],e=t[1],o=t[2];let n;n=Math.atan2(o,e)*360/2/Math.PI,n<0&&(n+=360);const l=Math.sqrt(e*e+o*o);return[r,l,n]};convert$1.lch.lab=function(t){const r=t[0],e=t[1],n=t[2]/360*2*Math.PI,a=e*Math.cos(n),l=e*Math.sin(n);return[r,a,l]};convert$1.rgb.ansi16=function(t,r=null){const[e,o,n]=t;let a=r===null?convert$1.rgb.hsv(t)[2]:r;if(a=Math.round(a/50),a===0)return 30;let l=30+(Math.round(n/255)<<2|Math.round(o/255)<<1|Math.round(e/255));return a===2&&(l+=60),l};convert$1.hsv.ansi16=function(t){return convert$1.rgb.ansi16(convert$1.hsv.rgb(t),t[2])};convert$1.rgb.ansi256=function(t){const r=t[0],e=t[1],o=t[2];return r===e&&e===o?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(e/255*5)+Math.round(o/255*5)};convert$1.ansi16.rgb=function(t){let r=t%10;if(r===0||r===7)return t>50&&(r+=3.5),r=r/10.5*255,[r,r,r];const e=(~~(t>50)+1)*.5,o=(r&1)*e*255,n=(r>>1&1)*e*255,a=(r>>2&1)*e*255;return[o,n,a]};convert$1.ansi256.rgb=function(t){if(t>=232){const a=(t-232)*10+8;return[a,a,a]}t-=16;let r;const e=Math.floor(t/36)/5*255,o=Math.floor((r=t%36)/6)/5*255,n=r%6/5*255;return[e,o,n]};convert$1.rgb.hex=function(t){const e=(((Math.round(t[0])&255)<<16)+((Math.round(t[1])&255)<<8)+(Math.round(t[2])&255)).toString(16).toUpperCase();return"000000".substring(e.length)+e};convert$1.hex.rgb=function(t){const r=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!r)return[0,0,0];let e=r[0];r[0].length===3&&(e=e.split("").map(u=>u+u).join(""));const o=parseInt(e,16),n=o>>16&255,a=o>>8&255,l=o&255;return[n,a,l]};convert$1.rgb.hcg=function(t){const r=t[0]/255,e=t[1]/255,o=t[2]/255,n=Math.max(Math.max(r,e),o),a=Math.min(Math.min(r,e),o),l=n-a;let u,p;return l<1?u=a/(1-l):u=0,l<=0?p=0:n===r?p=(e-o)/l%6:n===e?p=2+(o-r)/l:p=4+(r-e)/l,p/=6,p%=1,[p*360,l*100,u*100]};convert$1.hsl.hcg=function(t){const r=t[1]/100,e=t[2]/100,o=e<.5?2*r*e:2*r*(1-e);let n=0;return o<1&&(n=(e-.5*o)/(1-o)),[t[0],o*100,n*100]};convert$1.hsv.hcg=function(t){const r=t[1]/100,e=t[2]/100,o=r*e;let n=0;return o<1&&(n=(e-o)/(1-o)),[t[0],o*100,n*100]};convert$1.hcg.rgb=function(t){const r=t[0]/360,e=t[1]/100,o=t[2]/100;if(e===0)return[o*255,o*255,o*255];const n=[0,0,0],a=r%1*6,l=a%1,u=1-l;let p=0;switch(Math.floor(a)){case 0:n[0]=1,n[1]=l,n[2]=0;break;case 1:n[0]=u,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=l;break;case 3:n[0]=0,n[1]=u,n[2]=1;break;case 4:n[0]=l,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=u}return p=(1-e)*o,[(e*n[0]+p)*255,(e*n[1]+p)*255,(e*n[2]+p)*255]};convert$1.hcg.hsv=function(t){const r=t[1]/100,e=t[2]/100,o=r+e*(1-r);let n=0;return o>0&&(n=r/o),[t[0],n*100,o*100]};convert$1.hcg.hsl=function(t){const r=t[1]/100,o=t[2]/100*(1-r)+.5*r;let n=0;return o>0&&o<.5?n=r/(2*o):o>=.5&&o<1&&(n=r/(2*(1-o))),[t[0],n*100,o*100]};convert$1.hcg.hwb=function(t){const r=t[1]/100,e=t[2]/100,o=r+e*(1-r);return[t[0],(o-r)*100,(1-o)*100]};convert$1.hwb.hcg=function(t){const r=t[1]/100,o=1-t[2]/100,n=o-r;let a=0;return n<1&&(a=(o-n)/(1-n)),[t[0],n*100,a*100]};convert$1.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]};convert$1.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]};convert$1.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]};convert$1.gray.hsl=function(t){return[0,0,t[0]]};convert$1.gray.hsv=convert$1.gray.hsl;convert$1.gray.hwb=function(t){return[0,100,t[0]]};convert$1.gray.cmyk=function(t){return[0,0,0,t[0]]};convert$1.gray.lab=function(t){return[t[0],0,0]};convert$1.gray.hex=function(t){const r=Math.round(t[0]/100*255)&255,o=((r<<16)+(r<<8)+r).toString(16).toUpperCase();return"000000".substring(o.length)+o};convert$1.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};const conversions$1=conversions$2;function buildGraph(){const t={},r=Object.keys(conversions$1);for(let e=r.length,o=0;o<e;o++)t[r[o]]={distance:-1,parent:null};return t}function deriveBFS(t){const r=buildGraph(),e=[t];for(r[t].distance=0;e.length;){const o=e.pop(),n=Object.keys(conversions$1[o]);for(let a=n.length,l=0;l<a;l++){const u=n[l],p=r[u];p.distance===-1&&(p.distance=r[o].distance+1,p.parent=o,e.unshift(u))}}return r}function link(t,r){return function(e){return r(t(e))}}function wrapConversion(t,r){const e=[r[t].parent,t];let o=conversions$1[r[t].parent][t],n=r[t].parent;for(;r[n].parent;)e.unshift(r[n].parent),o=link(conversions$1[r[n].parent][n],o),n=r[n].parent;return o.conversion=e,o}var route$1=function(t){const r=deriveBFS(t),e={},o=Object.keys(r);for(let n=o.length,a=0;a<n;a++){const l=o[a];r[l].parent!==null&&(e[l]=wrapConversion(l,r))}return e};const conversions=conversions$2,route=route$1,convert={},models=Object.keys(conversions);function wrapRaw(t){const r=function(...e){const o=e[0];return o==null?o:(o.length>1&&(e=o),t(e))};return"conversion"in t&&(r.conversion=t.conversion),r}function wrapRounded(t){const r=function(...e){const o=e[0];if(o==null)return o;o.length>1&&(e=o);const n=t(e);if(typeof n=="object")for(let a=n.length,l=0;l<a;l++)n[l]=Math.round(n[l]);return n};return"conversion"in t&&(r.conversion=t.conversion),r}models.forEach(t=>{convert[t]={},Object.defineProperty(convert[t],"channels",{value:conversions[t].channels}),Object.defineProperty(convert[t],"labels",{value:conversions[t].labels});const r=route(t);Object.keys(r).forEach(o=>{const n=r[o];convert[t][o]=wrapRounded(n),convert[t][o].raw=wrapRaw(n)})});var colors={A:color("#e6c457"),B:color("#9257e6")};function getColor(t){return colors[t]}function color(t){var r=hexToRgb(t);return r}function hexToRgb(t){var r=t.substring(1),e=parseInt(r.slice(0,2),16),o=parseInt(r.slice(2,4),16),n=parseInt(r.slice(4,6),16),a=[e/255,o/255,n/255];return a}var margin={top:5,right:5,bottom:5,left:5},width$1=125-margin.left-margin.right,height$1=50-margin.top-margin.bottom,svg=d3.select("#graphParams").append("svg").attr("width",width$1+margin.left+margin.right).attr("height",height$1+margin.left+margin.right).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),xMin=0,xMax=10,data=[];function update(t,r){for(let n in t){var e={time:r/100,type:n,val:t[n][0]};data.push(e)}let o=4;for(;data.length>10*o;)data.shift();data.length===10*o&&(xMax++,xMin++),makeGraph()}function makeGraph(){document.querySelector("audio").duration;var t=d3.nest().key(function(a){return a.type}).entries(data),r=t.map(function(a){return a.type}),e=d3.scaleOrdinal().domain(r).range(["#e41a1c","#377eb8","#4daf4a","#984ea3"]),o=d3.scaleTime().domain([xMin,xMax]).range([0,width$1]);svg.append("g").attr("transform","translate(0,"+height$1+")").call(d3.axisBottom(o).ticks(10));var n=d3.scaleLinear().domain([0,1]).range([height$1,0]);svg.append("g").call(d3.axisLeft(n)),d3.selectAll("path.line").remove(),svg.selectAll(".line").data(t).enter().append("path").attr("class","line").attr("fill","none").attr("stroke",function(a){return e(a.key)}).attr("stroke-width",1).attr("d",function(a){return d3.line().x(function(l){return o(l.time)}).y(function(l){return n(l.val)})(a.values)})}var dist$1={},foggyrays$1={},dist={},mergepass={},codebuilder={},expr={},webglprogramloop={},settings={};Object.defineProperty(settings,"__esModule",{value:!0});settings.settings=void 0;settings.settings={verbosity:0,offset:0};Object.defineProperty(webglprogramloop,"__esModule",{value:!0});webglprogramloop.WebGLProgramLoop=webglprogramloop.WebGLProgramLeaf=webglprogramloop.updateNeeds=void 0;const settings_1=settings;function updateNeeds(t,r){return{neighborSample:t.neighborSample||r.neighborSample,centerSample:t.centerSample||r.centerSample,sceneBuffer:t.sceneBuffer||r.sceneBuffer,timeUniform:t.timeUniform||r.timeUniform,mouseUniform:t.mouseUniform||r.mouseUniform,passCount:t.passCount||r.passCount,extraBuffers:new Set([...t.extraBuffers,...r.extraBuffers])}}webglprogramloop.updateNeeds=updateNeeds;class WebGLProgramLeaf{constructor(r,e,o){this.program=r,this.totalNeeds=e,this.effects=o}}webglprogramloop.WebGLProgramLeaf=WebGLProgramLeaf;function getLoc(t,r,e){r.useProgram(t.program);const o=r.getUniformLocation(t.program,e);if(o===null)throw new Error("could not get the "+e+" uniform location");return o}class WebGLProgramLoop{constructor(r,e,o){if(this.last=!1,this.counter=0,this.programElement=r,this.loopInfo=e,this.programElement instanceof WebGLProgramLeaf){if(o===void 0)throw new Error("program element is a program but context is undefined");this.programElement.totalNeeds.timeUniform&&(this.timeLoc=getLoc(this.programElement,o,"uTime")),this.programElement.totalNeeds.mouseUniform&&(this.mouseLoc=getLoc(this.programElement,o,"uMouse")),this.programElement.totalNeeds.passCount&&(this.countLoc=getLoc(this.programElement,o,"uCount"))}}getTotalNeeds(){if(!(this.programElement instanceof WebGLProgramLeaf)){const r=[];for(const e of this.programElement)r.push(e.getTotalNeeds());return r.reduce(updateNeeds)}return this.programElement.totalNeeds}run(r,e,o,n,a,l,u){let p;if(this.loopInfo.target!==void 0&&(u==null?void 0:u.loopInfo.target)!==this.loopInfo.target){if(p=e.back,this.loopInfo.target!==-1)e.back=e.bufTextures[this.loopInfo.target];else{if(e.scene===void 0)throw new Error("tried to target -1 but scene texture was undefined");e.back=e.scene}e.bufTextures[this.loopInfo.target]=p,settings_1.settings.verbosity>99&&console.log("saved texture: "+p.name)}if(this.programElement instanceof WebGLProgramLeaf){if(this.programElement.totalNeeds.sceneBuffer){if(e.scene===void 0)throw new Error("needs scene buffer, but scene texture is somehow undefined");r.activeTexture(r.TEXTURE1+settings_1.settings.offset),this.loopInfo.target===-1?r.bindTexture(r.TEXTURE_2D,p.tex):r.bindTexture(r.TEXTURE_2D,e.scene.tex)}for(const f of this.programElement.totalNeeds.extraBuffers)r.activeTexture(r.TEXTURE2+f+settings_1.settings.offset),r.bindTexture(r.TEXTURE_2D,e.bufTextures[f].tex);r.useProgram(this.programElement.program);for(const f of this.programElement.effects)f.applyUniforms(r,n);if(this.programElement.totalNeeds.timeUniform){if(this.timeLoc===void 0||l.timeVal===void 0)throw new Error("time or location is undefined");r.uniform1f(this.timeLoc,l.timeVal)}if(this.programElement.totalNeeds.mouseUniform){if(this.mouseLoc===void 0||l.mouseX===void 0||l.mouseY===void 0)throw new Error("mouse uniform or location is undefined");r.uniform2f(this.mouseLoc,l.mouseX,l.mouseY)}if(this.programElement.totalNeeds.passCount&&u!==void 0){if(this.countLoc===void 0)throw new Error("count location is undefined");u!==void 0&&r.uniform1i(this.countLoc,u.counter),this.counter++;const f=u===void 0?1:u.loopInfo.num;this.counter%=f}}for(let f=0;f<this.loopInfo.num;f++){const h=f===this.loopInfo.num-1;if(this.programElement instanceof WebGLProgramLeaf){h&&a&&this.last?r.bindFramebuffer(r.FRAMEBUFFER,null):(r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.front.tex,0)),r.activeTexture(r.TEXTURE0+settings_1.settings.offset),r.bindTexture(r.TEXTURE_2D,e.back.tex),r.drawArrays(r.TRIANGLES,0,6),settings_1.settings.verbosity>99&&(console.log("intermediate back",e.back.name),console.log("intermediate front",e.front.name)),[e.back,e.front]=[e.front,e.back];for(const E of this.programElement.totalNeeds.extraBuffers)r.activeTexture(r.TEXTURE2+E+settings_1.settings.offset),r.bindTexture(r.TEXTURE_2D,null);r.activeTexture(r.TEXTURE1+settings_1.settings.offset),r.bindTexture(r.TEXTURE_2D,null)}else{this.loopInfo.func!==void 0&&this.loopInfo.func(f);for(const E of this.programElement)E.run(r,e,o,n,h,l,this)}}if(p!==void 0){const f=this.loopInfo.target;if(settings_1.settings.verbosity>99&&(console.log("pre final back",e.back.name),console.log("pre final front",e.front.name)),this.loopInfo.target!==-1)e.bufTextures[f]=e.back;else{if(e.scene===void 0)throw new Error("tried to replace -1 but scene texture was undefined");e.scene=e.back}e.back=p,settings_1.settings.verbosity>99&&(console.log("post final back",e.back.name),console.log("post final front",e.front.name),console.log("channel texture",e.bufTextures[f].name))}}delete(r){if(this.programElement instanceof WebGLProgramLeaf)r.deleteProgram(this.programElement.program);else for(const e of this.programElement)e.delete(r)}}webglprogramloop.WebGLProgramLoop=WebGLProgramLoop;var utils={},glslfunctions={};Object.defineProperty(glslfunctions,"__esModule",{value:!0});glslfunctions.glslFuncs=void 0;glslfunctions.glslFuncs={texture2D_region:`vec4 texture2D_region(
  float r_x_min,
  float r_y_min,
  float r_x_max,
  float r_y_max,
  sampler2D sampler,
  vec2 uv
) {
  vec2 d = vec2(1., 1.) / uResolution; // pixel width
  return texture2D(sampler, clamp(uv, vec2(r_x_min + d.x, r_y_min + d.x), vec2(r_x_max - d.y, r_y_max - d.y)));
}`,random:`float random(vec2 st) {
  return fract(sin(dot(st.xy / 99., vec2(12.9898, 78.233))) * 43758.5453123);
}`,random2:`vec2 random2(vec2 st) {
  st = vec2(dot(st,vec2(127.1,311.7)), dot(st,vec2(269.5,183.3)));
  return -1.0 + 2.0*fract(sin(st)*43758.5453123);
}`,rotate2d:`vec2 rotate2d(vec2 v, float angle) {
  return mat2(cos(angle), -sin(angle), sin(angle), cos(angle)) * v;
}`,hsv2rgb:`vec4 hsv2rgb(vec4 co){
  vec3 c = co.xyz;
  vec3 rgb = clamp(abs(mod(
    c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);
  rgb = rgb * rgb * (3.0 - 2.0 * rgb);
  vec3 hsv = c.z * mix(vec3(1.0), rgb, c.y);
  return vec4(hsv.x, hsv.y, hsv.z, co.a);
}`,rgb2hsv:`vec4 rgb2hsv(vec4 co){
  vec3 c = co.rgb;
  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
  float d = q.x - min(q.w, q.y);
  float e = 1.0e-10;
  return vec4(abs(q.z + (q.w - q.y) / (6.0 * d + e)),
              d / (q.x + e),
              q.x, co.a);
}`,gauss5:`vec4 gauss5(vec2 dir) {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 col = vec4(0.0);
  vec2 off1 = vec2(1.3333333333333333) * dir;
  col += texture2D(uSampler, uv) * 0.29411764705882354;
  col += texture2D(uSampler, uv + (off1 / uResolution)) * 0.35294117647058826;
  col += texture2D(uSampler, uv - (off1 / uResolution)) * 0.35294117647058826;
  return col;
}`,gauss9:`vec4 gauss9(vec2 dir) {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 col = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * dir;
  vec2 off2 = vec2(3.2307692308) * dir;
  col += texture2D(uSampler, uv) * 0.2270270270;
  col += texture2D(uSampler, uv + (off1 / uResolution)) * 0.3162162162;
  col += texture2D(uSampler, uv - (off1 / uResolution)) * 0.3162162162;
  col += texture2D(uSampler, uv + (off2 / uResolution)) * 0.0702702703;
  col += texture2D(uSampler, uv - (off2 / uResolution)) * 0.0702702703;
  return col;
}`,gauss13:`vec4 gauss13(vec2 dir) {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 col = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * dir;
  vec2 off2 = vec2(3.2941176470588234) * dir;
  vec2 off3 = vec2(5.176470588235294) * dir;
  col += texture2D(uSampler, uv) * 0.1964825501511404;
  col += texture2D(uSampler, uv + (off1 / uResolution)) * 0.2969069646728344;
  col += texture2D(uSampler, uv - (off1 / uResolution)) * 0.2969069646728344;
  col += texture2D(uSampler, uv + (off2 / uResolution)) * 0.09447039785044732;
  col += texture2D(uSampler, uv - (off2 / uResolution)) * 0.09447039785044732;
  col += texture2D(uSampler, uv + (off3 / uResolution)) * 0.010381362401148057;
  col += texture2D(uSampler, uv - (off3 / uResolution)) * 0.010381362401148057;
  return col;
}`,contrast:`vec4 contrast(float val, vec4 col) {
  col.rgb /= col.a;
  col.rgb = ((col.rgb - 0.5) * val) + 0.5;
  col.rgb *= col.a;
  return col;
}`,brightness:`vec4 brightness(float val, vec4 col) {
  col.rgb /= col.a;
  col.rgb += val;
  col.rgb *= col.a;
  return col;
}`,fxaa:`vec4 fxaa() {
  float FXAA_SPAN_MAX = 8.0;
  float FXAA_REDUCE_MUL = 1.0 / FXAA_SPAN_MAX;
  float FXAA_REDUCE_MIN = 1.0 / 128.0;
  float FXAA_SUBPIX_SHIFT = 1.0 / 4.0;

  vec2 rcpFrame = 1. / uResolution.xy;
  vec2 t_uv = gl_FragCoord.xy / uResolution.xy; 
  vec4 uv = vec4(t_uv, t_uv - (rcpFrame * (0.5 + FXAA_SUBPIX_SHIFT)));

  vec3 rgbNW = texture2D(uSampler, uv.zw).xyz;
  vec3 rgbNE = texture2D(uSampler, uv.zw + vec2(1,0) * rcpFrame.xy).xyz;
  vec3 rgbSW = texture2D(uSampler, uv.zw + vec2(0,1) * rcpFrame.xy).xyz;
  vec3 rgbSE = texture2D(uSampler, uv.zw + vec2(1,1) * rcpFrame.xy).xyz;
  vec4 rgbMfull = texture2D(uSampler, uv.xy);
  vec3 rgbM = rgbMfull.xyz;
  float alpha = rgbMfull.a;

  vec3 luma = vec3(0.299, 0.587, 0.114);
  float lumaNW = dot(rgbNW, luma);
  float lumaNE = dot(rgbNE, luma);
  float lumaSW = dot(rgbSW, luma);
  float lumaSE = dot(rgbSE, luma);
  float lumaM = dot(rgbM,  luma);

  float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
  float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

  vec2 dir;
  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
  dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));

  float dirReduce = max(
    (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);

  dir = min(vec2(FXAA_SPAN_MAX,  FXAA_SPAN_MAX),
    max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
    dir * rcpDirMin)) * rcpFrame.xy;

  vec3 rgbA = (1.0 / 2.0) * (
    texture2D(uSampler, uv.xy + dir * (1.0 / 3.0 - 0.5)).xyz +
    texture2D(uSampler, uv.xy + dir * (2.0 / 3.0 - 0.5)).xyz);
  vec3 rgbB = rgbA * (1.0 / 2.0) + (1.0 / 4.0) * (
    texture2D(uSampler, uv.xy + dir * (0.0 / 3.0 - 0.5)).xyz +
    texture2D(uSampler, uv.xy + dir * (3.0 / 3.0 - 0.5)).xyz);

  float lumaB = dot(rgbB, luma);

  if (lumaB < lumaMin || lumaB > lumaMax) {
    return vec4(rgbA.r, rgbA.g, rgbA.b, alpha);
  }

  return vec4(rgbB.r, rgbB.g, rgbB.b, alpha);
}`,gaussian:`float gaussian(float x, float a, float b) {
  float e = 2.71828;
  return pow(e, -pow(x - a, 2.) / b);
}`,truedepth:`float truedepth(float i) {
  i = max(i, 0.00000001);
  return (1. - i) / i;
}`,godrays:`vec4 godrays(
  vec4 col,
  float exposure,
  float decay,
  float density,
  float weight,
  vec2 lightPos,
  float threshold,
  vec4 newColor
) {
  vec2 texCoord = gl_FragCoord.xy / uResolution;
  vec2 deltaTexCoord = texCoord - lightPos;

  const int NUM_SAMPLES = 100;
  deltaTexCoord *= 1. / float(NUM_SAMPLES) * density;
  float illuminationDecay = 1.0;

  for (int i=0; i < NUM_SAMPLES; i++) {
    texCoord -= deltaTexCoord;
    vec4 sample = texture2D(uSampler, texCoord);
    //uncomment sample = depth2occlusion(sample, newColor, threshold);
    sample *= illuminationDecay * weight;
    col += sample;
    illuminationDecay *= decay;
  }
  return col * exposure;
}`,depth2occlusion:`vec4 depth2occlusion(vec4 depthCol, vec4 newCol, float threshold) {
  float red = 1. - ceil(depthCol.r - threshold);
  return vec4(newCol.rgb * red, 1.0);
}`,gradientnoise:`float gradientnoise(vec2 st) {
  vec2 i = floor(st);
  vec2 f = fract(st);

  vec2 u = f * f * (3.0 - 2.0 * f);

  return mix(mix(dot(random2(i + vec2(0.0,0.0)), f - vec2(0.0, 0.0)),
                     dot(random2(i + vec2(1.0,0.0)), f - vec2(1.0, 0.0)), u.x),
             mix(dot(random2(i + vec2(0.0,1.0)), f - vec2(0.0, 1.0)),
                 dot(random2(i + vec2(1.0,1.0)), f - vec2(1.0, 1.0)), u.x), u.y);
}`,simplexnoise:`float simplexnoise(vec2 v) {
  // Precompute values for skewed triangular grid
  const vec4 C = vec4(0.211324865405187,
                      // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,
                      // 0.5*(sqrt(3.0)-1.0)
                      -0.577350269189626,
                      // -1.0 + 2.0 * C.x
                      0.024390243902439);
                      // 1.0 / 41.0

  // First corner (x0)
  vec2 i  = floor(v + dot(v, C.yy));
  vec2 x0 = v - i + dot(i, C.xx);

  // Other two corners (x1, x2)
  vec2 i1 = vec2(0.0);
  i1 = (x0.x > x0.y)? vec2(1.0, 0.0):vec2(0.0, 1.0);
  vec2 x1 = x0.xy + C.xx - i1;
  vec2 x2 = x0.xy + C.zz;

  // Do some permutations to avoid
  // truncation effects in permutation
  i = mod289_2(i);
  vec3 p = permute(
          permute( i.y + vec3(0.0, i1.y, 1.0))
              + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(
                      dot(x0,x0),
                      dot(x1,x1),
                      dot(x2,x2)
                      ), 0.0);

  m = m*m ;
  m = m*m ;

  // Gradients:
  //  41 pts uniformly over a line, mapped onto a diamond
  //  The ring size 17*17 = 289 is close to a multiple
  //      of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

  // Normalise gradients implicitly by scaling m
  // Approximation of: m *= inversesqrt(a0*a0 + h*h);
  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0+h*h);

  // Compute final noise value at P
  vec3 g = vec3(0.0);
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * vec2(x1.x,x2.x) + h.yz * vec2(x1.y,x2.y);
  return 130.0 * dot(m, g);
}`,simplexhelpers:`vec3 mod289_3(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec2 mod289_2(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec3 permute(vec3 x) { return mod289_3(((x*34.0)+1.0)*x); }`,sobel:`vec4 sobel() {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 k[8];

  float w = 1. / uResolution.x;
  float h = 1. / uResolution.y;

  k[0] = texture2D(uSampler, uv + vec2(-w, -h));
  k[1] = texture2D(uSampler, uv + vec2(0., -h));
  k[2] = texture2D(uSampler, uv + vec2(w, -h));
  k[3] = texture2D(uSampler, uv + vec2(-w, 0.));

  k[4] = texture2D(uSampler, uv + vec2(w, 0.));
  k[5] = texture2D(uSampler, uv + vec2(-w, h));
  k[6] = texture2D(uSampler, uv + vec2(0., h));
  k[7] = texture2D(uSampler, uv + vec2(w, h));

  vec4 edge_h = k[2] + (2. * k[4]) + k[7] - (k[0] + (2. * k[3]) + k[5]);
  vec4 edge_v = k[0] + (2. * k[1]) + k[2] - (k[5] + (2. * k[6]) + k[7]);
  vec4 sob = sqrt(edge_h * edge_h + edge_v * edge_v);

  return vec4(1. - sob.rgb, 1.);
}`,monochrome:`vec4 monochrome(vec4 col) {
  return vec4(vec3((col.r + col.g + col.b) / 3.), col.a);
}`,invert:`vec4 invert(vec4 col) {
  return vec4(vec3(1., 1., 1.) - col.rgb, col.a);
}`,channel:`vec4 channel(vec2 uv, sampler2D sampler) {
  return texture2D(sampler, uv);
}`};Object.defineProperty(utils,"__esModule",{value:!0});utils.brandWithRegion=utils.brandWithChannel=utils.captureAndAppend=void 0;const glslfunctions_1$i=glslfunctions;function captureAndAppend(t,r,e){const o=t.match(r);if(o===null)throw new Error("no match in the given string");return t.replace(r,o[0]+e)}utils.captureAndAppend=captureAndAppend;function nameExtractor(t,r){const e=t.sections[0],o=e[e.length-1]===")"?")":"",n=e.substr(0,e.length-1-~~(o===")"))+r+"("+o;return{origFuncName:e,newFuncName:n,ending:o}}function brandWithChannel(t,r,e,o,n){if(n===void 0||n===-1?e.neighborSample=!0:e.extraBuffers=new Set([n]),n===void 0||n===-1)return;const{origFuncName:a,newFuncName:l,ending:u}=nameExtractor(t,n!==void 0?"_"+n:"");t.sections[0]=t.sections[0].split(a).join(l),r[o]=r[o].split(a).join(l).split("uSampler").join("uBufferSampler"+n)}utils.brandWithChannel=brandWithChannel;function brandWithRegion(t,r,e){if(!Array.isArray(e))return;const o=t.sourceLists,n=t.externalFuncs,a=t.needs;if(t.regionBranded||!a.neighborSample&&a.extraBuffers.size===0)return;const{origFuncName:l,newFuncName:u,ending:p}=nameExtractor(o,"_region"),h=u.substr(0,u.length-~~(p===")"))+"float r_x_min, float r_y_min, float r_x_max, float r_y_max"+(p===")"?")":", "),E="texture2D(",F="texture2D_region(r_x_min, r_y_min, r_x_max, r_y_max, ";n[r]=n[r].split(l).join(h).split(E).join(F),o.sections.shift(),p===")"&&o.sections.unshift(")");for(let _=0;_<4-~~(p===")");_++)o.sections.unshift(", ");o.sections.unshift(u.substr(0,u.length-~~(p===")"))),o.values.unshift(...e),n.unshift(glslfunctions_1$i.glslFuncs.texture2D_region),t.regionBranded=!0}utils.brandWithRegion=brandWithRegion;var hasRequiredExpr;function requireExpr(){if(hasRequiredExpr)return expr;hasRequiredExpr=1,Object.defineProperty(expr,"__esModule",{value:!0}),expr.tag=expr.wrapInValue=expr.pfloat=expr.Operator=expr.WrappedExpr=expr.ExprVec4=expr.ExprVec3=expr.ExprVec2=expr.float=expr.ExprFloat=expr.BasicFloat=expr.ExprVec=expr.BasicVec4=expr.BasicVec3=expr.BasicVec2=expr.BasicVec=expr.PrimitiveVec4=expr.PrimitiveVec3=expr.PrimitiveVec2=expr.PrimitiveVec=expr.PrimitiveFloat=expr.Primitive=expr.mut=expr.Mutable=expr.cvec4=expr.cvec3=expr.cvec2=expr.cfloat=expr.Expr=void 0;const t=requireMergepass(),r=webglprogramloop,e=utils;function o(S){let m=""+S;return m.includes(".")||(m+="."),m}class n{constructor(m,$){if(this.needs={neighborSample:!1,centerSample:!1,sceneBuffer:!1,timeUniform:!1,mouseUniform:!1,passCount:!1,extraBuffers:new Set},this.uniformValChangeMap={},this.defaultNameMap={},this.externalFuncs=[],this.sourceCode="",this.funcIndex=0,this.regionBranded=!1,this.id="_id_"+n.count,n.count++,m.sections.length-m.values.length!==1)throw new Error("wrong lengths for source and values");if(m.values.length!==$.length)throw console.log(m),console.log($),new Error("default names list length doesn't match values list length");this.sourceLists=m,this.defaultNames=$}applyUniforms(m,$){for(const L in this.uniformValChangeMap){const G=$[L];this.uniformValChangeMap[L].changed&&this.uniformValChangeMap[L].val.applyUniform(m,G.locs[G.counter]),G.counter++,G.counter%=G.locs.length,G.counter===0&&(this.uniformValChangeMap[L].changed=!1)}}getSampleNum(m=1){return this.needs.neighborSample||this.sourceLists.values.map($=>$.getSampleNum()).reduce(($,L)=>$+L,0)>0?m:0}setUniform(m,$){var L,G;$=N($);const ie=m;if(typeof $=="number"&&($=N($)),!($ instanceof F))throw new Error("cannot set a non-primitive");((L=this.uniformValChangeMap[m])===null||L===void 0?void 0:L.val)===void 0&&(m=this.defaultNameMap[m]);const oe=(G=this.uniformValChangeMap[m])===null||G===void 0?void 0:G.val;if(oe===void 0)throw new Error("tried to set uniform "+m+" which doesn't exist. original name: "+ie);if(oe.typeString()!==$.typeString())throw new Error("tried to set uniform "+m+" to a new type");this.uniformValChangeMap[m].val=$,this.uniformValChangeMap[m].changed=!0}parse(m){this.sourceCode="",m.exprs.push(this),m.needs=r.updateNeeds(m.needs,this.needs),this.externalFuncs.forEach($=>m.externalFuncs.add($));for(let $=0;$<this.sourceLists.values.length;$++)this.sourceCode+=this.sourceLists.sections[$]+this.sourceLists.values[$].parse(m,this.defaultNames[$],this);return this.sourceCode+=this.sourceLists.sections[this.sourceLists.sections.length-1],this.sourceCode}addFuncs(m){return this.externalFuncs.push(...m),this}brandExprWithChannel(m,$){return e.brandWithChannel(this.sourceLists,this.externalFuncs,this.needs,m,$),this}brandExprWithRegion(m){e.brandWithRegion(this,this.funcIndex,m);for(const $ of this.sourceLists.values)$.brandExprWithRegion(m);return this}}expr.Expr=n,n.count=0;function a(S){const m=[];for(let $=0;$<S.values.length;$++)m.push("uCustomName"+$);return m}function l(S,m=[]){return new M(S,a(S)).addFuncs(m)}expr.cfloat=l;function u(S,m=[]){return new k(S,a(S)).addFuncs(m)}expr.cvec2=u;function p(S,m=[]){return new q(S,a(S)).addFuncs(m)}expr.cvec3=p;function f(S,m=[]){return new W(S,a(S)).addFuncs(m)}expr.cvec4=f;class h{constructor(m,$){this.primitive=m,this.name=$}parse(m,$,L){if(L===void 0)throw new Error("tried to put a mutable expression at the top level");return this.name===void 0&&(this.name=$+L.id),m.uniformTypes[this.name]=this.primitive.typeString(),L.uniformValChangeMap[this.name]={val:this.primitive,changed:!0},L.defaultNameMap[$+L.id]=this.name,this.name}applyUniform(m,$){this.primitive.applyUniform(m,$)}typeString(){return this.primitive.typeString()}getSampleNum(){return 0}brandExprWithRegion(m){return this}}expr.Mutable=h;function E(S,m){const $=typeof S=="number"?N(S):S;return new h($,m)}expr.mut=E;class F{parse(){return this.toString()}getSampleNum(){return 0}brandExprWithRegion(m){return this}}expr.Primitive=F;class _ extends F{constructor(m){if(!isFinite(m))throw new Error("number not finite");super(),this.value=m}toString(){let m=""+this.value;return m.includes(".")||(m+="."),m}typeString(){return"float"}applyUniform(m,$){m.uniform1f($,this.value)}}expr.PrimitiveFloat=_;class b extends F{constructor(m){super(),this.values=m}typeString(){return"vec"+this.values.length}toString(){return`${this.typeString()}(${this.values.map(m=>o(m)).join(", ")})`}}expr.PrimitiveVec=b;class B extends b{applyUniform(m,$){m.uniform2f($,this.values[0],this.values[1])}}expr.PrimitiveVec2=B;class U extends b{applyUniform(m,$){m.uniform3f($,this.values[0],this.values[1],this.values[2])}}expr.PrimitiveVec3=U;class I extends b{applyUniform(m,$){m.uniform4f($,this.values[0],this.values[1],this.values[2],this.values[3])}}expr.PrimitiveVec4=I;class w extends n{constructor(m,$){super(m,$);const L=m.values;this.values=L,this.defaultNames=$}typeString(){return"vec"+this.values.length}setComp(m,$){if(m<0||m>=this.values.length)throw new Error("out of bounds of setting component");this.setUniform(this.defaultNames[m]+this.id,N($))}}expr.BasicVec=w;class d extends w{constructor(){super(...arguments),this.bvec2=void 0}}expr.BasicVec2=d;class V extends w{constructor(){super(...arguments),this.bvec3=void 0}}expr.BasicVec3=V;class R extends w{constructor(){super(...arguments),this.bvec4=void 0}}expr.BasicVec4=R;class T extends n{constructor(m,$){super(m,$);const L=m.values;this.values=L,this.defaultNames=$}}expr.ExprVec=T;class C extends n{constructor(m,$){super(m,$),this.float=void 0}setVal(m){this.setUniform("uFloat"+this.id,N(m))}typeString(){return"float"}}expr.BasicFloat=C;class M extends n{constructor(m,$){super(m,$),this.float=void 0}setVal(m){this.setUniform("uFloat"+this.id,N(m))}typeString(){return"float"}}expr.ExprFloat=M;function D(S){return typeof S=="number"&&(S=N(S)),new C({sections:["",""],values:[S]},["uFloat"])}expr.float=D;class k extends T{constructor(){super(...arguments),this.vec2=void 0}typeString(){return"vec2"}}expr.ExprVec2=k;class q extends T{constructor(){super(...arguments),this.vec3=void 0}typeString(){return"vec3"}}expr.ExprVec3=q;class W extends T{constructor(){super(...arguments),this.vec4=void 0}repeat(m){return new t.EffectLoop([this],{num:m})}genPrograms(m,$,L,G){return new t.EffectLoop([this],{num:1}).genPrograms(m,$,L,G)}typeString(){return"vec4"}}expr.ExprVec4=W;class K{constructor(m){this.expr=m}typeString(){return this.expr.typeString()}parse(m,$,L){return this.expr.parse(m,$,L)}getSampleNum(){return this.expr.getSampleNum()}brandExprWithRegion(m){return this.expr.brandExprWithRegion(m)}}expr.WrappedExpr=K;class z extends n{constructor(m,$,L){super($,L),this.ret=m}typeString(){return this.ret.typeString()}}expr.Operator=z;function Z(S){return new _(S)}expr.pfloat=Z;function N(S){if(S!==void 0)return typeof S=="number"?Z(S):S}expr.wrapInValue=N;function Q(S,...m){return{sections:S.concat([]),values:m}}return expr.tag=Q,expr}var hasRequiredCodebuilder;function requireCodebuilder(){if(hasRequiredCodebuilder)return codebuilder;hasRequiredCodebuilder=1,Object.defineProperty(codebuilder,"__esModule",{value:!0}),codebuilder.CodeBuilder=codebuilder.channelSamplerName=void 0;const t=requireExpr(),r=webglprogramloop,e=settings,o=`  gl_FragColor = texture2D(uSampler, gl_FragCoord.xy / uResolution);
`,n=`uniform sampler2D uSceneSampler;
`,a=`uniform mediump float uTime;
`,l=`uniform mediump vec2 uMouse;
`,u=`uniform int uCount;
`,p=`#ifdef GL_ES
precision mediump float;
#endif

uniform sampler2D uSampler;
uniform mediump vec2 uResolution;
`;function f(F){return F===-1?"uSampler":`uBufferSampler${F}`}codebuilder.channelSamplerName=f;function h(F){return`uniform sampler2D ${f(F)};`}class E{constructor(_){this.calls=[],this.externalFuncs=new Set,this.uniformDeclarations=new Set,this.counter=0,this.baseLoop=_;const b={uniformTypes:{},externalFuncs:new Set,exprs:[],needs:{centerSample:!1,neighborSample:!1,sceneBuffer:!1,timeUniform:!1,mouseUniform:!1,passCount:!1,extraBuffers:new Set}};this.addEffectLoop(_,1,b);for(const B in b.uniformTypes){const U=b.uniformTypes[B];this.uniformDeclarations.add(`uniform mediump ${U} ${B};`)}b.externalFuncs.forEach(B=>this.externalFuncs.add(B)),this.totalNeeds=b.needs,this.exprs=b.exprs}addEffectLoop(_,b,B,U=!0){const I=!U&&_.loopInfo.num>1;if(I){const w="i"+this.counter;b++;const d="  ".repeat(b-1)+`for (int ${w} = 0; ${w} < ${_.loopInfo.num}; ${w}++) {`;this.calls.push(d)}for(const w of _.effects)w instanceof t.Expr?(w.parse(B),this.calls.push("  ".repeat(b)+"gl_FragColor = "+w.sourceCode+";"),this.counter++):this.addEffectLoop(w,b,B,!1);I&&this.calls.push("  ".repeat(b-1)+"}")}compileProgram(_,b,B,U=[]){const I=_.createShader(_.FRAGMENT_SHADER);if(I===null)throw new Error("problem creating fragment shader");const w=p+(this.totalNeeds.sceneBuffer?n:"")+(this.totalNeeds.timeUniform?a:"")+(this.totalNeeds.mouseUniform?l:"")+(this.totalNeeds.passCount?u:"")+Array.from(this.totalNeeds.extraBuffers).map(C=>h(C)).join(`
`)+`
`+[...this.uniformDeclarations].join(`
`)+`
`+[...this.externalFuncs].join(`
`)+`
void main() {
`+(this.totalNeeds.centerSample?o:"")+this.calls.join(`
`)+`
}`;e.settings.verbosity>0&&console.log(w),_.shaderSource(I,w),_.compileShader(I);const d=_.createProgram();if(d===null)throw new Error("problem creating program");_.attachShader(d,b),_.attachShader(d,I),U.push(I);const V=(C,M)=>{const D=_.getShaderInfoLog(M);D&&console.log(`${C} shader info log
${D}`)};V("vertex",b),V("fragment",I),_.linkProgram(d),_.useProgram(d);for(const C of this.exprs)for(const M in C.uniformValChangeMap){const D=_.getUniformLocation(d,M);if(D===null)throw new Error("couldn't find uniform "+M);B[M]===void 0&&(B[M]={locs:[],counter:0}),B[M].locs.push(D)}const R=_.getUniformLocation(d,"uResolution");if(_.uniform2f(R,_.drawingBufferWidth,_.drawingBufferHeight),this.totalNeeds.sceneBuffer){const C=_.getUniformLocation(d,"uSceneSampler");_.uniform1i(C,1+e.settings.offset)}for(const C of this.totalNeeds.extraBuffers){const M=_.getUniformLocation(d,f(C));_.uniform1i(M,C+2+e.settings.offset)}if(e.settings.offset!==0){const C=_.getUniformLocation(d,"uSampler");_.uniform1i(C,e.settings.offset)}const T=_.getAttribLocation(d,"aPosition");return _.enableVertexAttribArray(T),_.vertexAttribPointer(T,2,_.FLOAT,!1,0,0),new r.WebGLProgramLoop(new r.WebGLProgramLeaf(d,this.totalNeeds,this.exprs),this.baseLoop.loopInfo,_)}}return codebuilder.CodeBuilder=E,codebuilder}var fragcolorexpr={},hasRequiredFragcolorexpr;function requireFragcolorexpr(){if(hasRequiredFragcolorexpr)return fragcolorexpr;hasRequiredFragcolorexpr=1,Object.defineProperty(fragcolorexpr,"__esModule",{value:!0}),fragcolorexpr.fcolor=fragcolorexpr.FragColorExpr=void 0;const t=requireExpr();class r extends t.ExprVec4{constructor(){super(t.tag`gl_FragColor`,[]),this.needs.centerSample=!0}}fragcolorexpr.FragColorExpr=r;function e(){return new r}return fragcolorexpr.fcolor=e,fragcolorexpr}var regiondecorator={},getcompexpr={},hasRequiredGetcompexpr;function requireGetcompexpr(){if(hasRequiredGetcompexpr)return getcompexpr;hasRequiredGetcompexpr=1,Object.defineProperty(getcompexpr,"__esModule",{value:!0}),getcompexpr.get4comp=getcompexpr.get3comp=getcompexpr.get2comp=getcompexpr.getcomp=getcompexpr.Get4CompExpr=getcompexpr.Get3CompExpr=getcompexpr.Get2CompExpr=getcompexpr.GetCompExpr=getcompexpr.checkLegalComponents=getcompexpr.typeStringToLength=void 0;const t=requireExpr();function r(_){switch(_){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4}}getcompexpr.typeStringToLength=r;function e(_,b){return{sections:["","."+b],values:[_]}}function o(_,b){const B=(V,R)=>{let T=0,C=0;for(const M of V)R.includes(M)?T++:C++;return T===T&&!C},U=r(b.typeString()),I=B(_,"rgba".substr(0,U)),w=B(_,"xyzw".substr(0,U)),d=B(_,"stpq".substr(0,U));if(!(I||w||d))throw new Error("component sets are mixed or incorrect entirely")}getcompexpr.checkLegalComponents=o;function n(_,b,B){if(_.length>b)throw new Error("too many components");o(_,B)}class a extends t.ExprFloat{constructor(b,B){n(B,1,b),super(e(b,B),["uVec1Min"]),this.vec1Min=b}setVec(b){this.setUniform("uVec1Min",b),this.vec1Min=b}}getcompexpr.GetCompExpr=a;class l extends t.ExprVec2{constructor(b,B){n(B,2,b),super(e(b,B),["uVec2Min"]),this.vec2Min=b}setVec(b){this.setUniform("uVec2Min",b),this.vec2Min=b}}getcompexpr.Get2CompExpr=l;class u extends t.ExprVec3{constructor(b,B){n(B,3,b),super(e(b,B),["uVec3Min"]),this.vec3Min=b}setVec(b){this.setUniform("uVec3Min",b),this.vec3Min=b}}getcompexpr.Get3CompExpr=u;class p extends t.ExprVec4{constructor(b,B){n(B,4,b),super(e(b,B),["uVec4Min"]),this.vec4Min=b}setVec(b){this.setUniform("uVec4Min",b),this.vec4Min=b}}getcompexpr.Get4CompExpr=p;function f(_,b){return new a(_,b)}getcompexpr.getcomp=f;function h(_,b){return new l(_,b)}getcompexpr.get2comp=h;function E(_,b){return new u(_,b)}getcompexpr.get3comp=E;function F(_,b){return new p(_,b)}return getcompexpr.get4comp=F,getcompexpr}var normfragcoordexpr={},hasRequiredNormfragcoordexpr;function requireNormfragcoordexpr(){if(hasRequiredNormfragcoordexpr)return normfragcoordexpr;hasRequiredNormfragcoordexpr=1,Object.defineProperty(normfragcoordexpr,"__esModule",{value:!0}),normfragcoordexpr.pos=normfragcoordexpr.NormFragCoordExpr=void 0;const t=requireExpr();class r extends t.ExprVec2{constructor(){super(t.tag`(gl_FragCoord.xy / uResolution)`,[])}}normfragcoordexpr.NormFragCoordExpr=r;function e(){return new r}return normfragcoordexpr.pos=e,normfragcoordexpr}var opexpr={},hasRequiredOpexpr;function requireOpexpr(){if(hasRequiredOpexpr)return opexpr;hasRequiredOpexpr=1,Object.defineProperty(opexpr,"__esModule",{value:!0}),opexpr.op=opexpr.OpExpr=void 0;const t=requireExpr();function r(n,a,l){return{sections:["(",` ${a} `,")"],values:[n,l]}}class e extends t.Operator{constructor(a,l,u){super(a,r(a,l,u),["uLeft","uRight"]),this.left=a,this.right=u}setLeft(a){this.setUniform("uLeft"+this.id,a),this.left=t.wrapInValue(a)}setRight(a){this.setUniform("uRight"+this.id,a),this.right=t.wrapInValue(a)}}opexpr.OpExpr=e;function o(n,a,l){return new e(t.wrapInValue(n),a,t.wrapInValue(l))}return opexpr.op=o,opexpr}var ternaryexpr={},hasRequiredTernaryexpr;function requireTernaryexpr(){if(hasRequiredTernaryexpr)return ternaryexpr;hasRequiredTernaryexpr=1,Object.defineProperty(ternaryexpr,"__esModule",{value:!0}),ternaryexpr.ternary=ternaryexpr.TernaryExpr=void 0;const t=requireExpr();function r(n,a,l,u){const p={sections:[`(${u?"!":""}(`],values:[]};let f=0;if(n!==null)for(const h of n){f++;const E=f===n.length;p.values.push(h),p.sections.push(` > 0.${E?") ? ":" && "}`)}else p.sections[0]+="uCount == 0) ? ";return p.values.push(a),p.sections.push(" : "),p.values.push(l),p.sections.push(")"),p}class e extends t.Operator{constructor(a,l,u,p){super(l,r(a,l,u,p),[...a!==null?Array.from(a,(f,h)=>"uFloat"+h):[],"uSuccess","uFailure"]),this.success=l,this.failure=u,this.needs.passCount=a===null}}ternaryexpr.TernaryExpr=e;function o(n,a,l,u=!1){return!Array.isArray(n)&&n!==null&&(n=[n].map(p=>t.wrapInValue(p))),new e(n,t.wrapInValue(a),t.wrapInValue(l),u)}return ternaryexpr.ternary=o,ternaryexpr}var hasRequiredRegiondecorator;function requireRegiondecorator(){if(hasRequiredRegiondecorator)return regiondecorator;hasRequiredRegiondecorator=1,Object.defineProperty(regiondecorator,"__esModule",{value:!0}),regiondecorator.region=void 0;const t=requireMergepass(),r=requireExpr(),e=requireGetcompexpr(),o=requireNormfragcoordexpr(),n=requireOpexpr(),a=requireTernaryexpr(),l=requireFragcolorexpr();function u(f){const h="xy",E=[];if(f.length!==4)throw new Error("incorrect amount of points specified for region");for(let F=0;F<2;F++)E.push(n.op(e.getcomp(o.pos(),h[F]),"-",f[F]));for(let F=2;F<f.length;F++)E.push(n.op(f[F],"-",e.getcomp(o.pos(),h[F-2])));return E}function p(f,h,E,F=!1){const _=Array.isArray(f)?f.map(b=>r.wrapInValue(b)):typeof f=="number"?r.wrapInValue(f):f;return E instanceof t.EffectLoop&&(h instanceof t.EffectLoop||([h,E]=[E,h],F=!F)),h instanceof t.EffectLoop?E instanceof t.EffectLoop?t.loop([h.regionWrap(_,l.fcolor(),!1,F),E.regionWrap(_,l.fcolor(),!0,!F)]):h.regionWrap(_,E,!0,F):a.ternary(Array.isArray(_)?u(_):_,h.brandExprWithRegion(_),E.brandExprWithRegion(_),F)}return regiondecorator.region=p,regiondecorator}var scenesampleexpr={},hasRequiredScenesampleexpr;function requireScenesampleexpr(){if(hasRequiredScenesampleexpr)return scenesampleexpr;hasRequiredScenesampleexpr=1,Object.defineProperty(scenesampleexpr,"__esModule",{value:!0}),scenesampleexpr.input=scenesampleexpr.SceneSampleExpr=void 0;const t=requireExpr(),r=requireNormfragcoordexpr();class e extends t.ExprVec4{constructor(a=r.pos()){super(t.tag`texture2D(uSceneSampler, ${a})`,["uCoord"]),this.coord=a,this.needs.sceneBuffer=!0}setCoord(a){this.setUniform("uCoord",a),this.coord=a}}scenesampleexpr.SceneSampleExpr=e;function o(n){return new e(n)}return scenesampleexpr.input=o,scenesampleexpr}var setcolorexpr={},hasRequiredSetcolorexpr;function requireSetcolorexpr(){if(hasRequiredSetcolorexpr)return setcolorexpr;hasRequiredSetcolorexpr=1,Object.defineProperty(setcolorexpr,"__esModule",{value:!0}),setcolorexpr.SetColorExpr=void 0;const t=requireExpr();class r extends t.ExprVec4{constructor(o){super(t.tag`(${o})`,["uVal"]),this.vec=o}}return setcolorexpr.SetColorExpr=r,setcolorexpr}var hasRequiredMergepass;function requireMergepass(){if(hasRequiredMergepass)return mergepass;hasRequiredMergepass=1,Object.defineProperty(mergepass,"__esModule",{value:!0}),mergepass.sendTexture=mergepass.makeTexture=mergepass.Merger=mergepass.loop=mergepass.EffectLoop=mergepass.EffectDictionary=void 0;const t=requireCodebuilder(),r=requireExpr(),e=requireFragcolorexpr(),o=requireRegiondecorator(),n=requireScenesampleexpr(),a=requireSetcolorexpr(),l=requireTernaryexpr(),u=settings,p=webglprogramloop;function f(w){return w.map(d=>d instanceof r.ExprVec4||d instanceof F?d:new a.SetColorExpr(d))}function h(w){const d={};for(const V in w){const R=w[V];d[V]=f(R)}return d}class E{constructor(d){this.effectMap=h(d)}toProgramMap(d,V,R,T){const C={};let M={neighborSample:!1,centerSample:!1,sceneBuffer:!1,timeUniform:!1,mouseUniform:!1,passCount:!1,extraBuffers:new Set};for(const D in this.effectMap){const k=this.effectMap[D],q=new F(k,{num:1});if(q.effects.length===0)throw new Error("list of effects was empty");const W=q.genPrograms(d,V,R,T);let K=!1,z=W;for(;!K;)z.programElement instanceof p.WebGLProgramLeaf?(z.last=!0,K=!0):z=z.programElement[z.programElement.length-1];M=p.updateNeeds(M,W.getTotalNeeds()),C[D]=W}return{programMap:C,needs:M}}}mergepass.EffectDictionary=E;class F{constructor(d,V){this.effects=f(d),this.loopInfo=V}getSampleNum(d=1,V=0,R=this.effects.length){d*=this.loopInfo.num;let T=0;const C=this.effects.slice(V,R);for(const M of C)T+=M.getSampleNum(d);return T}regroup(){let d=0,V=0,R=[];const T=[];let C,M,D=0;const k=()=>{D--,R.length>0&&(R.length===1?T.push(R[0]):T.push(new F(R,{num:1})),d-=V,R=[])};for(const q of this.effects){const W=q.getSampleNum();V=d,d+=W,q instanceof F?(M=q.loopInfo.target,q.hasTargetSwitch()&&(D=2)):M=this.loopInfo.target,(d>0||M!==C||D>0)&&k(),R.push(q),C=M}return k(),T}genPrograms(d,V,R,T){const C=this.getSampleNum()/this.loopInfo.num,M=this.getSampleNum(void 0,0,1)/this.loopInfo.num,D=this.getSampleNum(void 0,1)/this.loopInfo.num;return!this.hasTargetSwitch()&&(C===0||M===1&&D===0)?new t.CodeBuilder(this).compileProgram(d,V,R,T):(this.effects=this.regroup(),new p.WebGLProgramLoop(this.effects.map(k=>k.genPrograms(d,V,R,T)),this.loopInfo,d))}target(d){return this.loopInfo.target=d,this}hasTargetSwitch(){for(const d of this.effects)if(d instanceof F&&(d.loopInfo.target!==this.loopInfo.target||d.hasTargetSwitch()))return!0;return!1}regionWrap(d,V,R=!0,T){return this.effects=this.effects.map((C,M)=>C instanceof F?C.regionWrap(d,V,M===this.effects.length-1,T):new a.SetColorExpr(o.region(d,C.brandExprWithRegion(d),M===this.effects.length-1&&R?V instanceof e.FragColorExpr?V:l.ternary(null,V,e.fcolor()):e.fcolor(),T))),this}}mergepass.EffectLoop=F;function _(w,d=1){return new F(w,{num:d})}mergepass.loop=_;const b=`attribute vec2 aPosition;
void main() {
  gl_Position = vec4(aPosition, 0.0, 1.0);
}
`;class B{constructor(d,V,R,T){if(this.uniformLocs={},this.channels=[],this.fShaders=[],this.textureMode=V instanceof WebGLTexture,(T==null?void 0:T.channels)!==void 0&&(this.channels=T==null?void 0:T.channels),d instanceof E||(d=new E({default:d})),this.textureMode){u.settings.verbosity>1&&console.log("we are in texture mode!");for(const N in d.effectMap)d.effectMap[N].unshift(_([n.input()]).target(-1))}this.source=V,this.gl=R,this.options=T,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const C=this.gl.createBuffer();if(C===null)throw new Error("problem creating vertex buffer");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,C);const M=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],D=new Float32Array(M);this.gl.bufferData(this.gl.ARRAY_BUFFER,D,this.gl.STATIC_DRAW),this.vertexBuffer=C;const k=this.gl.createShader(this.gl.VERTEX_SHADER);if(k===null)throw new Error("problem creating the vertex shader");this.vShader=k,this.gl.shaderSource(k,b),this.gl.compileShader(k),this.tex={back:{name:"orig_back",tex:V instanceof WebGLTexture?V:U(this.gl,this.options)},front:{name:"orig_front",tex:U(this.gl,this.options)},scene:void 0,bufTextures:[]};const q=R.createFramebuffer();if(q===null)throw new Error("problem creating the framebuffer");this.framebuffer=q;const{programMap:W,needs:K}=d.toProgramMap(this.gl,this.vShader,this.uniformLocs,this.fShaders);if(this.programMap=W,(K.sceneBuffer||this.textureMode)&&(this.tex.scene={name:"scene",tex:U(this.gl,this.options)}),W.default===void 0)throw new Error("no default program");this.programLoop=W.default;const z=Math.max(...K.extraBuffers)+1,Z=this.channels.length;if(z>Z)throw new Error("not enough channels supplied for this effect");for(let N=0;N<this.channels.length;N++){const Q=this.channels[N];if(Q instanceof WebGLTexture)this.tex.bufTextures.push({name:"img_channel_"+N,tex:Q});else{const S=U(this.gl,this.options);this.tex.bufTextures.push({name:"tex_channel_"+N,tex:S})}}u.settings.verbosity>0&&(console.log(d),console.log(this.programMap))}draw(d=0,V=0,R=0){this.gl.activeTexture(this.gl.TEXTURE0+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex.back.tex),I(this.gl,this.source),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.programLoop.getTotalNeeds().sceneBuffer&&this.tex.scene!==void 0&&(this.gl.activeTexture(this.gl.TEXTURE1+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex.scene.tex),I(this.gl,this.source),this.gl.bindTexture(this.gl.TEXTURE_2D,null));let T=0;for(const C of this.channels)this.gl.activeTexture(this.gl.TEXTURE2+T+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex.bufTextures[T].tex),I(this.gl,C),this.gl.bindTexture(this.gl.TEXTURE_2D,null),T++;this.programLoop.run(this.gl,this.tex,this.framebuffer,this.uniformLocs,this.programLoop.last,{timeVal:d,mouseX:V,mouseY:R})}delete(){for(let d=0;d<2+this.tex.bufTextures.length;d++)this.gl.activeTexture(this.gl.TEXTURE0+d+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.programLoop.delete(this.gl),this.gl.deleteTexture(this.tex.front.tex),this.gl.deleteTexture(this.tex.back.tex);for(const d of this.tex.bufTextures)this.gl.deleteTexture(d.tex);this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.vShader);for(const d of this.fShaders)this.gl.deleteShader(d)}changeProgram(d){if(this.programMap[d]===void 0)throw new Error(`program "${d}" doesn't exist on this merger`);this.programLoop=this.programMap[d]}}mergepass.Merger=B;function U(w,d){const V=w.createTexture();if(V===null)throw new Error("problem creating texture");w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0),w.bindTexture(w.TEXTURE_2D,V),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.drawingBufferWidth,w.drawingBufferHeight,0,w.RGBA,w.UNSIGNED_BYTE,null);const R=T=>T===void 0||T==="linear"?w.LINEAR:w.NEAREST;return w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,R(d==null?void 0:d.minFilterMode)),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,R(d==null?void 0:d.maxFilterMode)),(d==null?void 0:d.edgeMode)!=="wrap"&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE)),V}mergepass.makeTexture=U;function I(w,d){d instanceof WebGLTexture||d===null||w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,d)}return mergepass.sendTexture=I,mergepass}var exprtypes={};Object.defineProperty(exprtypes,"__esModule",{value:!0});var blurexpr={};Object.defineProperty(blurexpr,"__esModule",{value:!0});blurexpr.gauss=blurexpr.BlurExpr=void 0;const glslfunctions_1$h=glslfunctions,expr_1$C=requireExpr();function genBlurSource(t,r){return{sections:[`gauss${r}(`,")"],values:[t]}}function tapsToFuncSource(t){switch(t){case 5:return glslfunctions_1$h.glslFuncs.gauss5;case 9:return glslfunctions_1$h.glslFuncs.gauss9;case 13:return glslfunctions_1$h.glslFuncs.gauss13}}class BlurExpr extends expr_1$C.ExprVec4{constructor(r,e=5,o){if(![5,9,13].includes(e))throw new Error("taps for gauss blur can only be 5, 9 or 13");super(genBlurSource(r,e),["uDirection"]),this.direction=r,this.externalFuncs=[tapsToFuncSource(e)],this.brandExprWithChannel(0,o)}setDirection(r){this.setUniform("uDirection"+this.id,r),this.direction=r}}blurexpr.BlurExpr=BlurExpr;function gauss(t,r=5,e){return new BlurExpr(t,r,e)}blurexpr.gauss=gauss;var vecexprs={};Object.defineProperty(vecexprs,"__esModule",{value:!0});vecexprs.pvec4=vecexprs.pvec3=vecexprs.pvec2=vecexprs.vec4=vecexprs.vec3=vecexprs.vec2=void 0;const expr_1$B=requireExpr();function vecSourceList(...t){const r=["vec"+t.length+"("];for(let o=0;o<t.length-1;o++)r.push(", ");const e=[];for(let o=0;o<t.length;o++)e.push("uComp"+o);return r.push(")"),[{sections:r,values:t},e]}function vec2(t,r){return new expr_1$B.BasicVec2(...vecSourceList(...[t,r].map(e=>expr_1$B.wrapInValue(e))))}vecexprs.vec2=vec2;function vec3(t,r,e){return new expr_1$B.BasicVec3(...vecSourceList(...[t,r,e].map(o=>expr_1$B.wrapInValue(o))))}vecexprs.vec3=vec3;function vec4(t,r,e,o){return new expr_1$B.BasicVec4(...vecSourceList(...[t,r,e,o].map(n=>expr_1$B.wrapInValue(n))))}vecexprs.vec4=vec4;function pvec2(t,r){return new expr_1$B.PrimitiveVec2([t,r])}vecexprs.pvec2=pvec2;function pvec3(t,r,e){return new expr_1$B.PrimitiveVec3([t,r,e])}vecexprs.pvec3=pvec3;function pvec4(t,r,e,o){return new expr_1$B.PrimitiveVec4([t,r,e,o])}vecexprs.pvec4=pvec4;var powerblur={};Object.defineProperty(powerblur,"__esModule",{value:!0});powerblur.pblur=powerblur.PowerBlurLoop=void 0;const mergepass_1$4=requireMergepass(),blurexpr_1$3=blurexpr,vecexprs_1$6=vecexprs,expr_1$A=requireExpr(),baseLog=(t,r)=>Math.log(r)/Math.log(t);class PowerBlurLoop extends mergepass_1$4.EffectLoop{constructor(r){const e=blurexpr_1$3.gauss(expr_1$A.mut(vecexprs_1$6.pvec2(r,0))),o=blurexpr_1$3.gauss(expr_1$A.mut(vecexprs_1$6.pvec2(0,r))),n=Math.ceil(baseLog(2,r));super([e,o],{num:n+1}),this.size=r,this.loopInfo.func=a=>{const l=this.size/Math.pow(2,a);o.setDirection(vecexprs_1$6.pvec2(0,l)),e.setDirection(vecexprs_1$6.pvec2(l,0))}}setSize(r){this.size=r,this.loopInfo.num=Math.ceil(baseLog(2,r))}}powerblur.PowerBlurLoop=PowerBlurLoop;function pblur(t){return new PowerBlurLoop(t)}powerblur.pblur=pblur;var blur2dloop={};Object.defineProperty(blur2dloop,"__esModule",{value:!0});blur2dloop.blur2d=blur2dloop.Blur2dLoop=void 0;const mergepass_1$3=requireMergepass(),blurexpr_1$2=blurexpr,expr_1$z=requireExpr(),vecexprs_1$5=vecexprs;class Blur2dLoop extends mergepass_1$3.EffectLoop{constructor(r=expr_1$z.float(expr_1$z.mut(1)),e=expr_1$z.float(expr_1$z.mut(1)),o=2,n,a){const l=blurexpr_1$2.gauss(vecexprs_1$5.vec2(r,0),n,a),u=blurexpr_1$2.gauss(vecexprs_1$5.vec2(0,e),n,a);super([l,u],{num:o}),this.horizontal=r,this.vertical=e}setHorizontal(r){if(!(this.horizontal instanceof expr_1$z.BasicFloat))throw new Error("horizontal expression not basic float");this.horizontal.setVal(r)}setVertical(r){if(!(this.vertical instanceof expr_1$z.BasicFloat))throw new Error("vertical expression not basic float");this.vertical.setVal(r)}}blur2dloop.Blur2dLoop=Blur2dLoop;function blur2d(t,r,e,o,n){return new Blur2dLoop(expr_1$z.wrapInValue(t),expr_1$z.wrapInValue(r),e,o,n)}blur2dloop.blur2d=blur2d;var lenexpr={};Object.defineProperty(lenexpr,"__esModule",{value:!0});lenexpr.len=lenexpr.LenExpr=void 0;const expr_1$y=requireExpr();class LenExpr extends expr_1$y.ExprFloat{constructor(r){super(expr_1$y.tag`length(${r})`,["uVec"]),this.vec=r}setVec(r){this.setUniform("uVec"+this.id,r),this.vec=r}}lenexpr.LenExpr=LenExpr;function len(t){return new LenExpr(t)}lenexpr.len=len;var normexpr={};Object.defineProperty(normexpr,"__esModule",{value:!0});normexpr.norm=normexpr.NormExpr=void 0;const expr_1$x=requireExpr();class NormExpr extends expr_1$x.Operator{constructor(r){super(r,expr_1$x.tag`normalize(${r})`,["uVec"]),this.vec=r}setVec(r){this.setUniform("uVec"+this.id,r),this.vec=r}}normexpr.NormExpr=NormExpr;function norm(t){return new NormExpr(t)}normexpr.norm=norm;var fragcoordexpr={};Object.defineProperty(fragcoordexpr,"__esModule",{value:!0});fragcoordexpr.pixel=fragcoordexpr.FragCoordExpr=void 0;const expr_1$w=requireExpr();class FragCoordExpr extends expr_1$w.ExprVec2{constructor(){super(expr_1$w.tag`gl_FragCoord.xy`,[])}}fragcoordexpr.FragCoordExpr=FragCoordExpr;function pixel(){return new FragCoordExpr}fragcoordexpr.pixel=pixel;var normcenterfragcoordexpr={};Object.defineProperty(normcenterfragcoordexpr,"__esModule",{value:!0});normcenterfragcoordexpr.center=normcenterfragcoordexpr.NormCenterFragCoordExpr=void 0;const expr_1$v=requireExpr();class NormCenterFragCoordExpr extends expr_1$v.ExprVec2{constructor(){super(expr_1$v.tag`(gl_FragCoord.xy / uResolution - 0.5)`,[])}}normcenterfragcoordexpr.NormCenterFragCoordExpr=NormCenterFragCoordExpr;function center(){return new NormCenterFragCoordExpr}normcenterfragcoordexpr.center=center;var brightnessexpr={};Object.defineProperty(brightnessexpr,"__esModule",{value:!0});brightnessexpr.brightness=brightnessexpr.Brightness=void 0;const glslfunctions_1$g=glslfunctions,expr_1$u=requireExpr(),fragcolorexpr_1$5=requireFragcolorexpr();class Brightness extends expr_1$u.ExprVec4{constructor(r,e=fragcolorexpr_1$5.fcolor()){super(expr_1$u.tag`brightness(${r}, ${e})`,["uBrightness","uColor"]),this.brightness=r,this.externalFuncs=[glslfunctions_1$g.glslFuncs.brightness]}setBrightness(r){this.setUniform("uBrightness"+this.id,r),this.brightness=expr_1$u.wrapInValue(r)}}brightnessexpr.Brightness=Brightness;function brightness(t,r){return new Brightness(expr_1$u.wrapInValue(t),r)}brightnessexpr.brightness=brightness;var contrastexpr={};Object.defineProperty(contrastexpr,"__esModule",{value:!0});contrastexpr.contrast=contrastexpr.ContrastExpr=void 0;const glslfunctions_1$f=glslfunctions,expr_1$t=requireExpr(),fragcolorexpr_1$4=requireFragcolorexpr();class ContrastExpr extends expr_1$t.ExprVec4{constructor(r,e=fragcolorexpr_1$4.fcolor()){super(expr_1$t.tag`contrast(${r}, ${e})`,["uVal","uCol"]),this.contrast=r,this.externalFuncs=[glslfunctions_1$f.glslFuncs.contrast]}setContrast(r){this.setUniform("uContrast"+this.id,r),this.contrast=expr_1$t.wrapInValue(r)}}contrastexpr.ContrastExpr=ContrastExpr;function contrast(t,r){return new ContrastExpr(expr_1$t.wrapInValue(t),r)}contrastexpr.contrast=contrast;var grainexpr={};Object.defineProperty(grainexpr,"__esModule",{value:!0});grainexpr.grain=grainexpr.GrainExpr=void 0;const glslfunctions_1$e=glslfunctions,expr_1$s=requireExpr();class GrainExpr extends expr_1$s.ExprVec4{constructor(r){super(expr_1$s.tag`vec4((1.0 - ${r} * random(gl_FragCoord.xy)) * gl_FragColor.rgb, gl_FragColor.a);`,["uGrain"]),this.grain=r,this.externalFuncs=[glslfunctions_1$e.glslFuncs.random],this.needs.centerSample=!0}setGrain(r){this.setUniform("uGrain"+this.id,r),this.grain=expr_1$s.wrapInValue(r)}}grainexpr.GrainExpr=GrainExpr;function grain(t){return new GrainExpr(expr_1$s.wrapInValue(t))}grainexpr.grain=grain;var changecompexpr={};Object.defineProperty(changecompexpr,"__esModule",{value:!0});changecompexpr.changecomp=changecompexpr.ChangeCompExpr=void 0;const expr_1$r=requireExpr(),getcompexpr_1$2=requireGetcompexpr();function getChangeFunc(t,r,e,o,n=""){return`${t} changecomp_${r}(${t} col, ${e.typeString()} setter) {
  col.${o} ${n}= setter;
  return col;
}`}function checkChangeComponents(t,r,e){if(t.length!==getcompexpr_1$2.typeStringToLength(r.typeString()))throw new Error("components length must be equal to the target float/vec");if(duplicateComponents(t))throw new Error("duplicate components not allowed on left side");getcompexpr_1$2.checkLegalComponents(t,e)}function duplicateComponents(t){return new Set(t.split("")).size!==t.length}class ChangeCompExpr extends expr_1$r.Operator{constructor(r,e,o,n){checkChangeComponents(o,e,r);const a=n==="+"?"plus":n==="-"?"minus":n==="*"?"mult":n==="/"?"div":"assign",l=`${r.typeString()}_${e.typeString()}_${o}_${a}`;super(r,{sections:[`changecomp_${l}(`,", ",")"],values:[r,e]},["uOriginal","uNew"]),this.originalVec=r,this.newVal=e,this.externalFuncs=[getChangeFunc(r.typeString(),l,e,o,n)]}setOriginal(r){this.setUniform("uOriginal"+this.id,r),this.originalVec=r}setNew(r){this.setUniform("uNew"+this.id,r),this.newVal=expr_1$r.wrapInValue(r)}}changecompexpr.ChangeCompExpr=ChangeCompExpr;function changecomp(t,r,e,o){return new ChangeCompExpr(t,expr_1$r.wrapInValue(r),e,o)}changecompexpr.changecomp=changecomp;var rgbtohsvexpr={};Object.defineProperty(rgbtohsvexpr,"__esModule",{value:!0});rgbtohsvexpr.rgb2hsv=rgbtohsvexpr.RGBToHSVExpr=void 0;const expr_1$q=requireExpr(),glslfunctions_1$d=glslfunctions;class RGBToHSVExpr extends expr_1$q.ExprVec4{constructor(r){super(expr_1$q.tag`rgb2hsv(${r})`,["uRGBCol"]),this.color=r,this.externalFuncs=[glslfunctions_1$d.glslFuncs.rgb2hsv]}setColor(r){this.setUniform("uRGBCol",r),this.color=r}}rgbtohsvexpr.RGBToHSVExpr=RGBToHSVExpr;function rgb2hsv(t){return new RGBToHSVExpr(t)}rgbtohsvexpr.rgb2hsv=rgb2hsv;var hsvtorgbexpr={};Object.defineProperty(hsvtorgbexpr,"__esModule",{value:!0});hsvtorgbexpr.hsv2rgb=hsvtorgbexpr.HSVToRGBExpr=void 0;const expr_1$p=requireExpr(),glslfunctions_1$c=glslfunctions;class HSVToRGBExpr extends expr_1$p.ExprVec4{constructor(r){super(expr_1$p.tag`hsv2rgb(${r})`,["uHSVCol"]),this.color=r,this.externalFuncs=[glslfunctions_1$c.glslFuncs.hsv2rgb]}setColor(r){this.setUniform("uHSVCol",r),this.color=r}}hsvtorgbexpr.HSVToRGBExpr=HSVToRGBExpr;function hsv2rgb(t){return new HSVToRGBExpr(t)}hsvtorgbexpr.hsv2rgb=hsv2rgb;var timeexpr={};Object.defineProperty(timeexpr,"__esModule",{value:!0});timeexpr.time=timeexpr.TimeExpr=void 0;const expr_1$o=requireExpr();class TimeExpr extends expr_1$o.ExprFloat{constructor(){super(expr_1$o.tag`uTime`,[]),this.needs.timeUniform=!0}}timeexpr.TimeExpr=TimeExpr;function time$1(){return new TimeExpr}timeexpr.time=time$1;var arity1={};Object.defineProperty(arity1,"__esModule",{value:!0});arity1.a1=arity1.Arity1HomogenousExpr=void 0;const expr_1$n=requireExpr();function genArity1SourceList$1(t,r){return{sections:[t+"(",")"],values:[r]}}class Arity1HomogenousExpr extends expr_1$n.Operator{constructor(r,e){super(r,genArity1SourceList$1(e,r),["uVal"]),this.val=r}setVal(r){this.setUniform("uVal"+this.id,r),this.val=expr_1$n.wrapInValue(r)}}arity1.Arity1HomogenousExpr=Arity1HomogenousExpr;function a1(t,r){return new Arity1HomogenousExpr(expr_1$n.wrapInValue(r),t)}arity1.a1=a1;var arity2={};Object.defineProperty(arity2,"__esModule",{value:!0});arity2.a2=arity2.Arity2HomogenousExpr=void 0;const expr_1$m=requireExpr();function genArity1SourceList(t,r,e){return{sections:[t+"(",",",")"],values:[r,e]}}class Arity2HomogenousExpr extends expr_1$m.Operator{constructor(r,e,o){super(e,genArity1SourceList(r,e,o),["uVal1","uVal2"]),this.val1=e,this.val2=o}setFirstVal(r){this.setUniform("uVal1"+this.id,r),this.val1=expr_1$m.wrapInValue(r)}setSecondVal(r){this.setUniform("uVal2"+this.id,r),this.val2=expr_1$m.wrapInValue(r)}}arity2.Arity2HomogenousExpr=Arity2HomogenousExpr;function a2(t,r,e){return new Arity2HomogenousExpr(t,expr_1$m.wrapInValue(r),expr_1$m.wrapInValue(e))}arity2.a2=a2;var fxaaexpr={};Object.defineProperty(fxaaexpr,"__esModule",{value:!0});fxaaexpr.fxaa=void 0;const expr_1$l=requireExpr(),glslfunctions_1$b=glslfunctions;class FXAAExpr extends expr_1$l.ExprVec4{constructor(){super(expr_1$l.tag`fxaa()`,[]),this.externalFuncs=[glslfunctions_1$b.glslFuncs.fxaa],this.needs.neighborSample=!0}}function fxaa(){return new FXAAExpr}fxaaexpr.fxaa=fxaa;var channelsampleexpr={};Object.defineProperty(channelsampleexpr,"__esModule",{value:!0});channelsampleexpr.channel=channelsampleexpr.ChannelSampleExpr=void 0;const codebuilder_1=requireCodebuilder(),expr_1$k=requireExpr(),normfragcoordexpr_1$1=requireNormfragcoordexpr(),glslfunctions_1$a=glslfunctions;function genChannelSampleSource(t,r){return{sections:["channel(",`, ${codebuilder_1.channelSamplerName(t)})`],values:[r]}}class ChannelSampleExpr extends expr_1$k.ExprVec4{constructor(r,e=normfragcoordexpr_1$1.pos()){super(genChannelSampleSource(r,e),["uVec"]),this.coord=e,this.externalFuncs=[glslfunctions_1$a.glslFuncs.channel],r!==-1?this.needs.extraBuffers=new Set([r]):this.needs.neighborSample=!0}setCoord(r){this.setUniform("uVec",r),this.coord=r}}channelsampleexpr.ChannelSampleExpr=ChannelSampleExpr;function channel(t,r){return new ChannelSampleExpr(t,r)}channelsampleexpr.channel=channel;var dofloop={},gaussianexpr={};Object.defineProperty(gaussianexpr,"__esModule",{value:!0});gaussianexpr.gaussian=gaussianexpr.GaussianExpr=void 0;const glslfunctions_1$9=glslfunctions,expr_1$j=requireExpr();class GaussianExpr extends expr_1$j.ExprFloat{constructor(r,e,o){super(expr_1$j.tag`gaussian(${r}, ${e}, ${o})`,["uFloatX","uFloatA","uFloatB"]),this.x=r,this.a=e,this.b=o,this.externalFuncs=[glslfunctions_1$9.glslFuncs.gaussian]}setX(r){this.setUniform("uFloatX"+this.id,r),this.x=expr_1$j.wrapInValue(r)}setA(r){this.setUniform("uFloatA"+this.id,r),this.a=expr_1$j.wrapInValue(r)}setB(r){this.setUniform("uFloatB"+this.id,r),this.b=expr_1$j.wrapInValue(r)}}gaussianexpr.GaussianExpr=GaussianExpr;function gaussian(t,r=0,e=1){return new GaussianExpr(expr_1$j.wrapInValue(t),expr_1$j.wrapInValue(r),expr_1$j.wrapInValue(e))}gaussianexpr.gaussian=gaussian;Object.defineProperty(dofloop,"__esModule",{value:!0});dofloop.dof=dofloop.DoFLoop=void 0;const mergepass_1$2=requireMergepass(),arity2_1$2=arity2,blurexpr_1$1=blurexpr,channelsampleexpr_1$3=channelsampleexpr,expr_1$i=requireExpr(),gaussianexpr_1=gaussianexpr,getcompexpr_1$1=requireGetcompexpr(),opexpr_1$4=requireOpexpr(),vecexprs_1$4=vecexprs;class DoFLoop extends mergepass_1$2.EffectLoop{constructor(r=expr_1$i.mut(expr_1$i.pfloat(.3)),e=expr_1$i.mut(expr_1$i.pfloat(.01)),o=getcompexpr_1$1.getcomp(channelsampleexpr_1$3.channel(0),"r"),n=2,a=13){let l=gaussianexpr_1.gaussian(o,r,e);const u=blurexpr_1$1.gauss(vecexprs_1$4.vec2(arity2_1$2.a2("pow",opexpr_1$4.op(1,"-",l),4),0),a),p=blurexpr_1$1.gauss(vecexprs_1$4.vec2(0,arity2_1$2.a2("pow",opexpr_1$4.op(1,"-",l),4)),a);super([u,p],{num:n}),this.gaussian=l}setDepth(r){this.gaussian.setA(r)}setRadius(r){this.gaussian.setB(r)}}dofloop.DoFLoop=DoFLoop;function dof(t,r,e,o){return new DoFLoop(expr_1$i.wrapInValue(t),expr_1$i.wrapInValue(r),expr_1$i.wrapInValue(e),o)}dofloop.dof=dof;var truedepthexpr={};Object.defineProperty(truedepthexpr,"__esModule",{value:!0});truedepthexpr.truedepth=truedepthexpr.TrueDepthExpr=void 0;const expr_1$h=requireExpr(),glslfunctions_1$8=glslfunctions;class TrueDepthExpr extends expr_1$h.ExprFloat{constructor(r){super(expr_1$h.tag`truedepth(${r})`,["uDist"]),this.depth=r,this.externalFuncs=[glslfunctions_1$8.glslFuncs.truedepth]}setDist(r){this.setUniform("uDist",r),this.depth=expr_1$h.wrapInValue(r)}}truedepthexpr.TrueDepthExpr=TrueDepthExpr;function truedepth(t){return new TrueDepthExpr(expr_1$h.wrapInValue(t))}truedepthexpr.truedepth=truedepth;var godraysexpr={};Object.defineProperty(godraysexpr,"__esModule",{value:!0});godraysexpr.godrays=godraysexpr.GodRaysExpr=void 0;const glslfunctions_1$7=glslfunctions,expr_1$g=requireExpr(),fragcolorexpr_1$3=requireFragcolorexpr(),vecexprs_1$3=vecexprs,DEFAULT_SAMPLES=100;class GodRaysExpr extends expr_1$g.ExprVec4{constructor(r=fragcolorexpr_1$3.fcolor(),e=expr_1$g.mut(1),o=expr_1$g.mut(1),n=expr_1$g.mut(1),a=expr_1$g.mut(.01),l=expr_1$g.mut(vecexprs_1$3.pvec2(.5,.5)),u=0,p=DEFAULT_SAMPLES,f){const h=expr_1$g.tag`${r}, ${e}, ${o}, ${n}, ${a}, ${l}, ${f!==void 0?f.threshold:expr_1$g.float(0)}, ${f!==void 0?f.newColor:vecexprs_1$3.vec4(0,0,0,0)})`,E=`godrays${f!==void 0?"_depth":""}${p!==100?"_s"+p:""}(`;h.sections[0]=E,super(h,["uCol","uExposure","uDecay","uDensity","uWeight","uLightPos","uThreshold","uNewColor"]),this.col=r,this.exposure=e,this.decay=o,this.density=n,this.weight=a,this.lightPos=l,this.threshold=f==null?void 0:f.threshold,this.newColor=f==null?void 0:f.newColor,this.funcIndex=~~(f!==void 0);let F=glslfunctions_1$7.glslFuncs.godrays.split("godrays(").join(E).replace(`NUM_SAMPLES = ${DEFAULT_SAMPLES}`,"NUM_SAMPLES = "+p);f!==void 0&&(F=F.replace(/\/\/uncomment\s/g,""),this.externalFuncs.push(glslfunctions_1$7.glslFuncs.depth2occlusion)),this.externalFuncs.push(F),this.brandExprWithChannel(this.funcIndex,u)}setColor(r){this.setUniform("uCol"+this.id,r),this.col=r}setExposure(r){this.setUniform("uExposure"+this.id,r),this.exposure=expr_1$g.wrapInValue(r)}setDecay(r){this.setUniform("uDecay"+this.id,r),this.decay=expr_1$g.wrapInValue(r)}setDensity(r){this.setUniform("uDensity"+this.id,r),this.density=expr_1$g.wrapInValue(r)}setWeight(r){this.setUniform("uWeight"+this.id,r),this.weight=expr_1$g.wrapInValue(r)}setLightPos(r){this.setUniform("uLightPos"+this.id,r),this.lightPos=r}setThreshold(r){this.setUniform("uThreshold"+this.id,r),this.threshold=expr_1$g.wrapInValue(r)}setNewColor(r){this.setUniform("uNewColor"+this.id,r),this.newColor=r}}godraysexpr.GodRaysExpr=GodRaysExpr;function godrays(t={}){return new GodRaysExpr(t.color,expr_1$g.wrapInValue(t.exposure),expr_1$g.wrapInValue(t.decay),expr_1$g.wrapInValue(t.density),expr_1$g.wrapInValue(t.weight),t.lightPos,t.samplerNum,t.numSamples,t.convertDepth===void 0?void 0:{threshold:expr_1$g.wrapInValue(t.convertDepth.threshold),newColor:t.convertDepth.newColor})}godraysexpr.godrays=godrays;var depthtoocclusionexpr={};Object.defineProperty(depthtoocclusionexpr,"__esModule",{value:!0});depthtoocclusionexpr.depth2occlusion=depthtoocclusionexpr.DepthToOcclusionExpr=void 0;const channelsampleexpr_1$2=channelsampleexpr,expr_1$f=requireExpr(),vecexprs_1$2=vecexprs;class DepthToOcclusionExpr extends expr_1$f.ExprVec4{constructor(r=channelsampleexpr_1$2.channel(0),e=expr_1$f.mut(vecexprs_1$2.pvec4(1,1,1,1)),o=expr_1$f.mut(expr_1$f.pfloat(.01))){super(expr_1$f.tag`depth2occlusion(${r}, ${e}, ${o})`,["uDepth","uNewCol","uThreshold"]),this.depthCol=r,this.newCol=e,this.threshold=o}setDepthColor(r){this.setUniform("uDepth"+this.id,r),this.depthCol=r}setNewColor(r){this.setUniform("uNewCol"+this.id,r),this.newCol=r}setThreshold(r){this.setUniform("uThreshold"+this.id,r),this.threshold=expr_1$f.wrapInValue(r)}}depthtoocclusionexpr.DepthToOcclusionExpr=DepthToOcclusionExpr;function depth2occlusion(t,r,e){return new DepthToOcclusionExpr(t,r,expr_1$f.wrapInValue(e))}depthtoocclusionexpr.depth2occlusion=depth2occlusion;var resolutionexpr={};Object.defineProperty(resolutionexpr,"__esModule",{value:!0});resolutionexpr.resolution=resolutionexpr.ResolutionExpr=void 0;const expr_1$e=requireExpr();class ResolutionExpr extends expr_1$e.ExprVec2{constructor(){super(expr_1$e.tag`uResolution`,[])}}resolutionexpr.ResolutionExpr=ResolutionExpr;function resolution(){return new ResolutionExpr}resolutionexpr.resolution=resolution;var mouseexpr={};Object.defineProperty(mouseexpr,"__esModule",{value:!0});mouseexpr.mouse=mouseexpr.MouseExpr=void 0;const expr_1$d=requireExpr();class MouseExpr extends expr_1$d.ExprVec2{constructor(){super(expr_1$d.tag`uMouse`,[]),this.needs.mouseUniform=!0}}mouseexpr.MouseExpr=MouseExpr;function mouse(){return new MouseExpr}mouseexpr.mouse=mouse;var rotateexpr={};Object.defineProperty(rotateexpr,"__esModule",{value:!0});rotateexpr.rotate=rotateexpr.RotateExpr=void 0;const glslfunctions_1$6=glslfunctions,expr_1$c=requireExpr();class RotateExpr extends expr_1$c.ExprVec2{constructor(r,e){super(expr_1$c.tag`rotate2d(${r}, ${e})`,["uVec","uAngle"]),this.vec=r,this.angle=e,this.externalFuncs=[glslfunctions_1$6.glslFuncs.rotate2d]}setVec(r){this.setUniform("uVec"+this.id,r),this.vec=r}setAngle(r){this.setUniform("uAngle"+this.id,r),this.angle=expr_1$c.wrapInValue(r)}}rotateexpr.RotateExpr=RotateExpr;function rotate(t,r){return new RotateExpr(t,expr_1$c.wrapInValue(r))}rotateexpr.rotate=rotate;var translateexpr={};Object.defineProperty(translateexpr,"__esModule",{value:!0});translateexpr.translate=translateexpr.TranslateExpr=void 0;const expr_1$b=requireExpr();class TranslateExpr extends expr_1$b.ExprVec2{constructor(r,e){super(expr_1$b.tag`(${r} + ${e})`,["uVec","uPos"]),this.vec=r,this.pos=e}setVec(r){this.setUniform("uVec"+this.id,r),this.vec=r}setPos(r){this.setUniform("uPos"+this.id,r),this.pos=r}}translateexpr.TranslateExpr=TranslateExpr;function translate(t,r){return new TranslateExpr(t,r)}translateexpr.translate=translate;var normmouseexpr={};Object.defineProperty(normmouseexpr,"__esModule",{value:!0});normmouseexpr.nmouse=normmouseexpr.NormMouseExpr=void 0;const expr_1$a=requireExpr();class NormMouseExpr extends expr_1$a.ExprVec2{constructor(){super(expr_1$a.tag`(uMouse / uResolution.xy)`,[]),this.needs.mouseUniform=!0}}normmouseexpr.NormMouseExpr=NormMouseExpr;function nmouse(){return new NormMouseExpr}normmouseexpr.nmouse=nmouse;var perlinexpr={};Object.defineProperty(perlinexpr,"__esModule",{value:!0});perlinexpr.fractalize=perlinexpr.perlin=perlinexpr.PerlinExpr=void 0;const glslfunctions_1$5=glslfunctions,expr_1$9=requireExpr(),opexpr_1$3=requireOpexpr();class PerlinExpr extends expr_1$9.ExprFloat{constructor(r){super(expr_1$9.tag`gradientnoise(${r})`,["uPos"]),this.pos=r,this.externalFuncs=[glslfunctions_1$5.glslFuncs.random2,glslfunctions_1$5.glslFuncs.gradientnoise]}setPos(r){this.setUniform("uPos",r),this.pos=r}}perlinexpr.PerlinExpr=PerlinExpr;function perlin(t){return new PerlinExpr(t)}perlinexpr.perlin=perlin;function fractalize(t,r,e){if(r<0)throw new Error("octaves can't be < 0");const o=(n,a,l)=>l<=0?expr_1$9.pfloat(0):opexpr_1$3.op(e(opexpr_1$3.op(n,"/",a*2)),"+",o(n,a/2,l-1));return o(t,.5,r)}perlinexpr.fractalize=fractalize;var simplexexpr={};Object.defineProperty(simplexexpr,"__esModule",{value:!0});simplexexpr.simplex=simplexexpr.SimplexNoise=void 0;const glslfunctions_1$4=glslfunctions,expr_1$8=requireExpr();class SimplexNoise extends expr_1$8.ExprFloat{constructor(r){super(expr_1$8.tag`simplexnoise(${r})`,["uPos"]),this.pos=r,this.externalFuncs=[glslfunctions_1$4.glslFuncs.simplexhelpers,glslfunctions_1$4.glslFuncs.simplexnoise]}setPos(r){this.setUniform("uPos",r),this.pos=r}}simplexexpr.SimplexNoise=SimplexNoise;function simplex(t){return new SimplexNoise(t)}simplexexpr.simplex=simplex;var motionblurloop={};Object.defineProperty(motionblurloop,"__esModule",{value:!0});motionblurloop.motionblur=motionblurloop.MotionBlurLoop=void 0;const mergepass_1$1=requireMergepass(),channelsampleexpr_1$1=channelsampleexpr,expr_1$7=requireExpr(),fragcolorexpr_1$2=requireFragcolorexpr(),opexpr_1$2=requireOpexpr();class MotionBlurLoop extends mergepass_1$1.EffectLoop{constructor(r=0,e=expr_1$7.float(expr_1$7.mut(.3))){const o=opexpr_1$2.op(channelsampleexpr_1$1.channel(r),"*",e),n=opexpr_1$2.op(fragcolorexpr_1$2.fcolor(),"*",opexpr_1$2.op(1,"-",e)),a=[mergepass_1$1.loop([opexpr_1$2.op(o,"+",n)]).target(r),channelsampleexpr_1$1.channel(r)];super(a,{num:1}),this.persistence=e}setPersistence(r){if(!(this.persistence instanceof expr_1$7.BasicFloat))throw new Error("persistence expression not basic float");this.persistence.setVal(r)}}motionblurloop.MotionBlurLoop=MotionBlurLoop;function motionblur(t,r){return new MotionBlurLoop(t,expr_1$7.wrapInValue(r))}motionblurloop.motionblur=motionblur;var randomexpr={};Object.defineProperty(randomexpr,"__esModule",{value:!0});randomexpr.random=randomexpr.RandomExpr=void 0;const glslfunctions_1$3=glslfunctions,expr_1$6=requireExpr(),normfragcoordexpr_1=requireNormfragcoordexpr();class RandomExpr extends expr_1$6.ExprFloat{constructor(r=normfragcoordexpr_1.pos()){super(expr_1$6.tag`random(${r})`,["uSeed"]),this.seed=r,this.externalFuncs=[glslfunctions_1$3.glslFuncs.random]}setSeed(r){this.setUniform("uSeed",r),this.seed=r}}randomexpr.RandomExpr=RandomExpr;function random(t){return new RandomExpr(t)}randomexpr.random=random;var sobelexpr={};Object.defineProperty(sobelexpr,"__esModule",{value:!0});sobelexpr.sobel=sobelexpr.SobelExpr=void 0;const glslfunctions_1$2=glslfunctions,expr_1$5=requireExpr();class SobelExpr extends expr_1$5.ExprVec4{constructor(r){super(expr_1$5.tag`sobel()`,[]),this.externalFuncs=[glslfunctions_1$2.glslFuncs.sobel],this.brandExprWithChannel(0,r)}}sobelexpr.SobelExpr=SobelExpr;function sobel(t){return new SobelExpr(t)}sobelexpr.sobel=sobel;var bloomloop={};Object.defineProperty(bloomloop,"__esModule",{value:!0});bloomloop.bloom=bloomloop.BloomLoop=void 0;const mergepass_1=requireMergepass(),arity2_1$1=arity2,blurexpr_1=blurexpr,brightnessexpr_1$1=brightnessexpr,channelsampleexpr_1=channelsampleexpr,contrastexpr_1=contrastexpr,expr_1$4=requireExpr(),fragcolorexpr_1$1=requireFragcolorexpr(),opexpr_1$1=requireOpexpr(),vecexprs_1$1=vecexprs;class BloomLoop extends mergepass_1.EffectLoop{constructor(r=expr_1$4.float(expr_1$4.mut(.4)),e=expr_1$4.float(expr_1$4.mut(1)),o=expr_1$4.float(expr_1$4.mut(1)),n=expr_1$4.float(expr_1$4.mut(1.3)),a=1,l=9,u=3){const p=expr_1$4.cfloat(expr_1$4.tag`((${channelsampleexpr_1.channel(a)}.r + ${channelsampleexpr_1.channel(a)}.g + ${channelsampleexpr_1.channel(a)}.b) / 3.)`),f=arity2_1$1.a2("step",p,r),h=expr_1$4.cvec4(expr_1$4.tag`vec4(${channelsampleexpr_1.channel(a)}.rgb * (1. - ${f}), 1.)`),E=[mergepass_1.loop([h]).target(a),mergepass_1.loop([blurexpr_1.gauss(vecexprs_1$1.vec2(e,0),l),blurexpr_1.gauss(vecexprs_1$1.vec2(0,o),l),brightnessexpr_1$1.brightness(.1),contrastexpr_1.contrast(n)],u).target(a),opexpr_1$1.op(fragcolorexpr_1$1.fcolor(),"+",channelsampleexpr_1.channel(a))];super(E,{num:1}),this.threshold=r,this.horizontal=e,this.vertical=o,this.boost=n}setHorizontal(r){if(!(this.horizontal instanceof expr_1$4.BasicFloat))throw new Error("horizontal expression not basic float");this.horizontal.setVal(r)}setVertical(r){if(!(this.vertical instanceof expr_1$4.BasicFloat))throw new Error("vertical expression not basic float");this.vertical.setVal(r)}setThreshold(r){if(!(this.threshold instanceof expr_1$4.BasicFloat))throw new Error("threshold expression not basic float");this.threshold.setVal(r)}setBoost(r){if(!(this.boost instanceof expr_1$4.BasicFloat))throw new Error("boost expression not basic float");this.boost.setVal(r)}}bloomloop.BloomLoop=BloomLoop;function bloom(t,r,e,o,n,a,l){return new BloomLoop(expr_1$4.wrapInValue(t),expr_1$4.wrapInValue(r),expr_1$4.wrapInValue(e),expr_1$4.wrapInValue(o),n,a,l)}bloomloop.bloom=bloom;var monochromeexpr={};Object.defineProperty(monochromeexpr,"__esModule",{value:!0});monochromeexpr.monochrome=monochromeexpr.MonochromeExpr=void 0;const expr_1$3=requireExpr(),glslfunctions_1$1=glslfunctions;class MonochromeExpr extends expr_1$3.ExprVec4{constructor(r){super(expr_1$3.tag`monochrome(${r})`,["uColor"]),this.externalFuncs=[glslfunctions_1$1.glslFuncs.monochrome],this.color=r}setColor(r){this.setUniform("uColor",r),this.color=r}}monochromeexpr.MonochromeExpr=MonochromeExpr;function monochrome(t){return new MonochromeExpr(t)}monochromeexpr.monochrome=monochrome;var invertexpr={};Object.defineProperty(invertexpr,"__esModule",{value:!0});invertexpr.invert=invertexpr.InvertExpr=void 0;const expr_1$2=requireExpr(),glslfunctions_1=glslfunctions;class InvertExpr extends expr_1$2.ExprVec4{constructor(r){super(expr_1$2.tag`invert(${r})`,["uColor"]),this.externalFuncs=[glslfunctions_1.glslFuncs.invert],this.color=r}setColor(r){this.setUniform("uColor",r),this.color=r}}invertexpr.InvertExpr=InvertExpr;function invert(t){return new InvertExpr(t)}invertexpr.invert=invert;var edgeexpr={};Object.defineProperty(edgeexpr,"__esModule",{value:!0});edgeexpr.edge=edgeexpr.EdgeExpr=void 0;const brightnessexpr_1=brightnessexpr,expr_1$1=requireExpr(),getcompexpr_1=requireGetcompexpr(),invertexpr_1=invertexpr,monochromeexpr_1$1=monochromeexpr,opexpr_1=requireOpexpr(),sobelexpr_1$1=sobelexpr;class EdgeExpr extends expr_1$1.WrappedExpr{constructor(r=expr_1$1.mut(-1),e){const o=opexpr_1.op(getcompexpr_1.getcomp(invertexpr_1.invert(monochromeexpr_1$1.monochrome(sobelexpr_1$1.sobel(e))),"r"),"*",r);super(brightnessexpr_1.brightness(o)),this.mult=r,this.operator=o}setMult(r){this.operator.setRight(r),this.mult=expr_1$1.wrapInValue(r)}}edgeexpr.EdgeExpr=EdgeExpr;function edge(t,r){const e=t==="dark"?-1:t==="light"?1:t;return new EdgeExpr(expr_1$1.wrapInValue(e),r)}edgeexpr.edge=edge;var edgecolorexpr={};Object.defineProperty(edgecolorexpr,"__esModule",{value:!0});edgecolorexpr.edgecolor=edgecolorexpr.EdgeColorExpr=void 0;const arity2_1=arity2,expr_1=requireExpr(),fragcolorexpr_1=requireFragcolorexpr(),monochromeexpr_1=monochromeexpr,sobelexpr_1=sobelexpr,vecexprs_1=vecexprs;class EdgeColorExpr extends expr_1.WrappedExpr{constructor(r,e,o=!0){const n=o?expr_1.cvec4(expr_1.tag`mix(${r}, ${fragcolorexpr_1.fcolor()}, ${monochromeexpr_1.monochrome(arity2_1.a2("step",vecexprs_1.vec4(.5,.5,.5,0),sobelexpr_1.sobel(e)))})`):expr_1.cvec4(expr_1.tag`mix(${r}, ${fragcolorexpr_1.fcolor()}, ${monochromeexpr_1.monochrome(sobelexpr_1.sobel(e))})`);super(n),this.color=r,this.expr=n}setColor(r){this.expr.setUniform("uCustomName0"+this.expr.id,r),this.color=r}}edgecolorexpr.EdgeColorExpr=EdgeColorExpr;function edgecolor(t,r,e){return new EdgeColorExpr(t,r,e)}edgecolorexpr.edgecolor=edgecolor;(function(t){var r=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,n,a,l){l===void 0&&(l=a),Object.defineProperty(o,l,{enumerable:!0,get:function(){return n[a]}})}:function(o,n,a,l){l===void 0&&(l=a),o[l]=n[a]}),e=commonjsGlobal&&commonjsGlobal.__exportStar||function(o,n){for(var a in o)a!=="default"&&!n.hasOwnProperty(a)&&r(n,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),e(requireMergepass(),t),e(exprtypes,t),e(glslfunctions,t),e(settings,t),e(blurexpr,t),e(requireFragcolorexpr(),t),e(vecexprs,t),e(requireOpexpr(),t),e(powerblur,t),e(blur2dloop,t),e(lenexpr,t),e(normexpr,t),e(fragcoordexpr,t),e(requireNormfragcoordexpr(),t),e(normcenterfragcoordexpr,t),e(requireScenesampleexpr(),t),e(brightnessexpr,t),e(contrastexpr,t),e(grainexpr,t),e(requireGetcompexpr(),t),e(changecompexpr,t),e(rgbtohsvexpr,t),e(hsvtorgbexpr,t),e(timeexpr,t),e(arity1,t),e(arity2,t),e(fxaaexpr,t),e(channelsampleexpr,t),e(dofloop,t),e(truedepthexpr,t),e(godraysexpr,t),e(depthtoocclusionexpr,t),e(resolutionexpr,t),e(mouseexpr,t),e(rotateexpr,t),e(translateexpr,t),e(normmouseexpr,t),e(perlinexpr,t),e(simplexexpr,t),e(motionblurloop,t),e(randomexpr,t),e(sobelexpr,t),e(bloomloop,t),e(monochromeexpr,t),e(invertexpr,t),e(edgeexpr,t),e(edgecolorexpr,t),e(requireTernaryexpr(),t),e(requireRegiondecorator(),t),e(requireExpr(),t)})(dist);Object.defineProperty(foggyrays$1,"__esModule",{value:!0});foggyrays$1.foggyrays=foggyrays$1.FoggyRaysExpr=void 0;const merge_pass_1$7=dist;class FoggyRaysExpr extends merge_pass_1$7.WrappedExpr{constructor(r,e,o,n,a,l){const u=merge_pass_1$7.float(r),p=merge_pass_1$7.float(e),f=merge_pass_1$7.float(o),h=merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.simplex(merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.pos(),"+",merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.time(),"*",p),"/",u)),"*",merge_pass_1$7.op(merge_pass_1$7.resolution(),"/",merge_pass_1$7.op(u,"*",2)))),"*",merge_pass_1$7.simplex(merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.pos(),"+",merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.time(),"*",p),"/",merge_pass_1$7.op(u,"*",-2))),"*",merge_pass_1$7.op(merge_pass_1$7.resolution(),"/",merge_pass_1$7.op(u,"*",4))))),"*",.5),E=merge_pass_1$7.godrays({weight:.009,density:merge_pass_1$7.op(f,"+",merge_pass_1$7.op(h,"*",.5)),convertDepth:l!==void 0?{threshold:.01,newColor:l}:void 0,samplerNum:a,numSamples:n});super(E),this.periodFloat=u,this.speedFloat=p,this.throwDistanceFloat=f,this.godraysExpr=E,this.convertsDepth=l!==void 0,this.period=r,this.speed=e,this.throwDistance=o}setPeriod(r){this.periodFloat.setVal(merge_pass_1$7.wrapInValue(r)),this.period=merge_pass_1$7.wrapInValue(r)}setSpeed(r){this.speedFloat.setVal(merge_pass_1$7.wrapInValue(r)),this.speed=merge_pass_1$7.wrapInValue(r)}setThrowDistance(r){this.throwDistanceFloat.setVal(merge_pass_1$7.wrapInValue(r)),this.throwDistance=merge_pass_1$7.wrapInValue(r)}setNewColor(r){if(this.convertsDepth===void 0)throw new Error("can only set new color if you are converting from a depth buffer");this.godraysExpr.setNewColor(r)}}foggyrays$1.FoggyRaysExpr=FoggyRaysExpr;function foggyrays(t=merge_pass_1$7.mut(100),r=merge_pass_1$7.mut(1),e=merge_pass_1$7.mut(.3),o=100,n,a){return new FoggyRaysExpr(merge_pass_1$7.wrapInValue(t),merge_pass_1$7.wrapInValue(r),merge_pass_1$7.wrapInValue(e),o,n,a)}foggyrays$1.foggyrays=foggyrays;var vignette$1={};Object.defineProperty(vignette$1,"__esModule",{value:!0});vignette$1.vignette=vignette$1.Vignette=void 0;const merge_pass_1$6=dist;class Vignette extends merge_pass_1$6.EffectLoop{constructor(r,e,o){const n=merge_pass_1$6.float(r),a=merge_pass_1$6.float(e),l=merge_pass_1$6.float(o),u=merge_pass_1$6.op(merge_pass_1$6.len(merge_pass_1$6.center()),"*",n),p=merge_pass_1$6.blur2d(u,u),f=merge_pass_1$6.a2("pow",merge_pass_1$6.len(merge_pass_1$6.center()),l),h=merge_pass_1$6.brightness(merge_pass_1$6.op(f,"*",merge_pass_1$6.op(a,"*",-1)));super([p,h],{num:1}),this.blurScalarFloat=n,this.brightnessScalarFloat=a,this.brightnessExponentFloat=l,this.blurScalar=r,this.brightnessScalar=e,this.brightnessExponent=o}setBlurScalar(r){this.blurScalarFloat.setVal(merge_pass_1$6.wrapInValue(r)),this.blurScalar=merge_pass_1$6.wrapInValue(r)}setBrightnessScalar(r){this.brightnessScalarFloat.setVal(merge_pass_1$6.wrapInValue(r)),this.brightnessScalar=merge_pass_1$6.wrapInValue(r)}setBrightnessExponent(r){this.brightnessExponentFloat.setVal(merge_pass_1$6.wrapInValue(r)),this.brightnessExponent=merge_pass_1$6.wrapInValue(r)}}vignette$1.Vignette=Vignette;function vignette(t=merge_pass_1$6.mut(3),r=merge_pass_1$6.mut(1.8),e=merge_pass_1$6.mut(1.8)){return new Vignette(merge_pass_1$6.wrapInValue(t),merge_pass_1$6.wrapInValue(r),merge_pass_1$6.wrapInValue(e))}vignette$1.vignette=vignette;var blurandtrace$1={};Object.defineProperty(blurandtrace$1,"__esModule",{value:!0});blurandtrace$1.blurandtrace=blurandtrace$1.BlurAndTrace=void 0;const merge_pass_1$5=dist;class BlurAndTrace extends merge_pass_1$5.EffectLoop{constructor(r,e,o,n,a,l){const u=merge_pass_1$5.float(r),p=merge_pass_1$5.float(e);super([...l?[]:[merge_pass_1$5.loop([merge_pass_1$5.channel(a)]).target(a)],merge_pass_1$5.blur2d(p,p,o,n),merge_pass_1$5.edge(u,a)],{num:1}),this.brightnessFloat=u,this.blurSizeFloat=p,this.brightness=r,this.blurSize=e}setBrightness(r){this.brightnessFloat.setVal(merge_pass_1$5.wrapInValue(r)),this.brightness=merge_pass_1$5.wrapInValue(r)}setBlurSize(r){this.blurSizeFloat.setVal(merge_pass_1$5.wrapInValue(r)),this.blurSize=merge_pass_1$5.wrapInValue(r)}}blurandtrace$1.BlurAndTrace=BlurAndTrace;function blurandtrace(t=merge_pass_1$5.mut(1),r=merge_pass_1$5.mut(1),e=4,o=9,n=0,a=!1){return new BlurAndTrace(merge_pass_1$5.wrapInValue(t),merge_pass_1$5.wrapInValue(r),e,o,n,a)}blurandtrace$1.blurandtrace=blurandtrace;var lightbands$1={};Object.defineProperty(lightbands$1,"__esModule",{value:!0});lightbands$1.lightbands=lightbands$1.LightBands=void 0;const merge_pass_1$4=dist;class LightBands extends merge_pass_1$4.WrappedExpr{constructor(r,e,o,n){const a=merge_pass_1$4.float(r),l=merge_pass_1$4.float(e),u=merge_pass_1$4.float(o),p=merge_pass_1$4.brightness(merge_pass_1$4.ternary(merge_pass_1$4.op(merge_pass_1$4.getcomp(merge_pass_1$4.channel(0),"r"),"-",u),merge_pass_1$4.op(merge_pass_1$4.a1("sin",merge_pass_1$4.op(merge_pass_1$4.op(merge_pass_1$4.time(),"*",a),"+",merge_pass_1$4.truedepth(merge_pass_1$4.getcomp(merge_pass_1$4.channel(n),"r")))),"*",l),0));super(p),this.speedFloat=a,this.intensityFloat=l,this.thresholdFloat=u,this.speed=r,this.intensity=e,this.threshold=o}setSpeed(r){this.speedFloat.setVal(merge_pass_1$4.wrapInValue(r)),this.speed=merge_pass_1$4.wrapInValue(r)}setIntensity(r){this.intensityFloat.setVal(merge_pass_1$4.wrapInValue(r)),this.intensity=merge_pass_1$4.wrapInValue(r)}setThreshold(r){this.thresholdFloat.setVal(merge_pass_1$4.wrapInValue(r)),this.threshold=merge_pass_1$4.wrapInValue(r)}}lightbands$1.LightBands=LightBands;function lightbands(t=merge_pass_1$4.mut(4),r=merge_pass_1$4.mut(.3),e=merge_pass_1$4.mut(.01),o=0){return new LightBands(merge_pass_1$4.wrapInValue(t),merge_pass_1$4.wrapInValue(r),merge_pass_1$4.wrapInValue(e),o)}lightbands$1.lightbands=lightbands;var noisedisplacement$1={};Object.defineProperty(noisedisplacement$1,"__esModule",{value:!0});noisedisplacement$1.noisedisplacement=noisedisplacement$1.NoiseDisplacement=void 0;const merge_pass_1$3=dist,X_OFF=1234,Y_OFF=5678;class NoiseDisplacement extends merge_pass_1$3.WrappedExpr{constructor(r,e,o){const n=merge_pass_1$3.float(r),a=merge_pass_1$3.float(e),l=merge_pass_1$3.float(o),u=p=>merge_pass_1$3.simplex(merge_pass_1$3.op(merge_pass_1$3.op(merge_pass_1$3.changecomp(merge_pass_1$3.op(merge_pass_1$3.pos(),"/",n),merge_pass_1$3.op(merge_pass_1$3.time(),"*",a),p,"+"),"*",merge_pass_1$3.op(merge_pass_1$3.resolution(),"/",merge_pass_1$3.getcomp(merge_pass_1$3.resolution(),"y"))),"+",p==="x"?X_OFF:Y_OFF));super(merge_pass_1$3.channel(-1,merge_pass_1$3.op(merge_pass_1$3.op(merge_pass_1$3.op(merge_pass_1$3.vec2(u("x"),u("y")),"*",l),"*",merge_pass_1$3.op(merge_pass_1$3.get2comp(merge_pass_1$3.resolution(),"yx"),"/",merge_pass_1$3.getcomp(merge_pass_1$3.resolution(),"y"))),"+",merge_pass_1$3.pos()))),this.periodFloat=n,this.speedFloat=a,this.intensityFloat=l,this.period=r,this.speed=e,this.intensity=o}setPeriod(r){this.periodFloat.setVal(merge_pass_1$3.wrapInValue(r)),this.period=merge_pass_1$3.wrapInValue(r)}setSpeed(r){this.speedFloat.setVal(merge_pass_1$3.wrapInValue(r)),this.speed=merge_pass_1$3.wrapInValue(r)}setIntensity(r){this.intensityFloat.setVal(merge_pass_1$3.wrapInValue(r)),this.speed=merge_pass_1$3.wrapInValue(r)}}noisedisplacement$1.NoiseDisplacement=NoiseDisplacement;function noisedisplacement(t=merge_pass_1$3.mut(.1),r=merge_pass_1$3.mut(1),e=merge_pass_1$3.mut(.005)){return new NoiseDisplacement(merge_pass_1$3.wrapInValue(t),merge_pass_1$3.wrapInValue(r),merge_pass_1$3.wrapInValue(e))}noisedisplacement$1.noisedisplacement=noisedisplacement;var oldfilm$1={};Object.defineProperty(oldfilm$1,"__esModule",{value:!0});oldfilm$1.oldfilm=oldfilm$1.OldFilm=void 0;const merge_pass_1$2=dist;class OldFilm extends merge_pass_1$2.WrappedExpr{constructor(r,e,o){const n=merge_pass_1$2.float(r),a=merge_pass_1$2.float(e),l=merge_pass_1$2.float(o),u=merge_pass_1$2.a1("floor",merge_pass_1$2.op(merge_pass_1$2.time(),"*",24)),p=merge_pass_1$2.op(merge_pass_1$2.random(merge_pass_1$2.op(merge_pass_1$2.pixel(),"+",merge_pass_1$2.a2("mod",merge_pass_1$2.op(u,"*",99),3e3))),"*",l),f=10,h=merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.a1("abs",merge_pass_1$2.op(merge_pass_1$2.op(2,"*",merge_pass_1$2.a1("fract",merge_pass_1$2.op(f,"*",merge_pass_1$2.getcomp(merge_pass_1$2.pos(),"x")))),"-",1)),"-",.5),"*",2),"*",a),E=merge_pass_1$2.a2("step",merge_pass_1$2.op(1,"-",merge_pass_1$2.op(1,"/",f*12)),merge_pass_1$2.a2("mod",merge_pass_1$2.op(merge_pass_1$2.getcomp(merge_pass_1$2.pos(),"x"),"+",merge_pass_1$2.random(merge_pass_1$2.op(merge_pass_1$2.vec2(50,50),"*",merge_pass_1$2.time()))),1)),F=merge_pass_1$2.op(h,"*",E),_=merge_pass_1$2.a2("mod",merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.pos(),"*",merge_pass_1$2.op(merge_pass_1$2.resolution(),"/",merge_pass_1$2.getcomp(merge_pass_1$2.resolution(),"y"))),"+",u),merge_pass_1$2.vec2(100,100)),b=merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.simplex(merge_pass_1$2.op(_,"*",7)),"*",.44),"+",.5),B=merge_pass_1$2.op(merge_pass_1$2.a2("step",b,.08),"*",n);super(merge_pass_1$2.monochrome(merge_pass_1$2.brightness(B,merge_pass_1$2.brightness(F,merge_pass_1$2.brightness(p))))),this.speckIntensityFloat=n,this.lineIntensityFloat=a,this.grainIntensityFloat=l,this.speckIntensity=r,this.lineIntensity=e,this.grainIntensity=o}setSpeckIntensity(r){this.speckIntensityFloat.setVal(merge_pass_1$2.wrapInValue(r)),this.speckIntensity=merge_pass_1$2.wrapInValue(r)}setLineIntensity(r){this.lineIntensityFloat.setVal(merge_pass_1$2.wrapInValue(r)),this.lineIntensity=merge_pass_1$2.wrapInValue(r)}setGrainIntensity(r){this.grainIntensityFloat.setVal(merge_pass_1$2.wrapInValue(r)),this.grainIntensity=merge_pass_1$2.wrapInValue(r)}}oldfilm$1.OldFilm=OldFilm;function oldfilm(t=merge_pass_1$2.mut(.4),r=merge_pass_1$2.mut(.12),e=merge_pass_1$2.mut(.11)){return new OldFilm(merge_pass_1$2.wrapInValue(t),merge_pass_1$2.wrapInValue(r),merge_pass_1$2.wrapInValue(e))}oldfilm$1.oldfilm=oldfilm;var kaleidoscope$1={};Object.defineProperty(kaleidoscope$1,"__esModule",{value:!0});kaleidoscope$1.kaleidoscope=kaleidoscope$1.Kaleidoscope=void 0;const merge_pass_1$1=dist;class Kaleidoscope extends merge_pass_1$1.WrappedExpr{constructor(r,e){const o=merge_pass_1$1.float(r),n=merge_pass_1$1.float(e),a=merge_pass_1$1.op(merge_pass_1$1.translate(merge_pass_1$1.pos(),merge_pass_1$1.vec2(-.5,-.5)),"/",n),l=merge_pass_1$1.a2("atan",merge_pass_1$1.getcomp(a,"y"),merge_pass_1$1.getcomp(a,"x")),u=merge_pass_1$1.op(2*Math.PI,"*",merge_pass_1$1.op(1,"/",o)),p=merge_pass_1$1.op(merge_pass_1$1.a1("floor",merge_pass_1$1.op(l,"/",u)),"*",u),f=merge_pass_1$1.op(l,"-",p),h=merge_pass_1$1.op(u,"-",merge_pass_1$1.op(2,"*",f)),E=merge_pass_1$1.a1("floor",merge_pass_1$1.op(merge_pass_1$1.a2("mod",merge_pass_1$1.op(p,"+",.1),merge_pass_1$1.op(u,"*",2)),"/",u)),F=merge_pass_1$1.translate(merge_pass_1$1.rotate(a,merge_pass_1$1.op(p,"-",merge_pass_1$1.op(h,"*",E))),merge_pass_1$1.vec2(.5,.5));super(merge_pass_1$1.channel(-1,F)),this.sidesFloat=o,this.scaleFloat=n,this.sides=r,this.scale=e}setSides(r){this.sidesFloat.setVal(merge_pass_1$1.wrapInValue(r)),this.sides=merge_pass_1$1.wrapInValue(r)}setScale(r){this.scaleFloat.setVal(merge_pass_1$1.wrapInValue(r)),this.scale=merge_pass_1$1.wrapInValue(r)}}kaleidoscope$1.Kaleidoscope=Kaleidoscope;function kaleidoscope(t=merge_pass_1$1.mut(8),r=merge_pass_1$1.mut(1)){return new Kaleidoscope(merge_pass_1$1.wrapInValue(t),merge_pass_1$1.wrapInValue(r))}kaleidoscope$1.kaleidoscope=kaleidoscope;var celshade$1={};Object.defineProperty(celshade$1,"__esModule",{value:!0});celshade$1.celshade=celshade$1.CelShade=void 0;const merge_pass_1=dist;class CelShade extends merge_pass_1.WrappedExpr{constructor(r,e,o,n){const a=merge_pass_1.float(r),l=merge_pass_1.float(e),u=merge_pass_1.float(o),p=merge_pass_1.float(n),f=merge_pass_1.cfloat(merge_pass_1.tag`(smoothstep(-${p} + ${u}, ${p} + ${u}, ${merge_pass_1.rgb2hsv(merge_pass_1.fcolor())}.z) * ${a} + ${l})`),h=merge_pass_1.hsv2rgb(merge_pass_1.changecomp(merge_pass_1.rgb2hsv(merge_pass_1.fcolor()),f,"z"));super(h),this.multFloat=a,this.bumpFloat=l,this.centerFloat=u,this.edgeFloat=p,this.mult=r,this.bump=e,this.center=o,this.edge=n}setMult(r){this.multFloat.setVal(merge_pass_1.wrapInValue(r)),this.mult=merge_pass_1.wrapInValue(r)}setBump(r){this.bumpFloat.setVal(merge_pass_1.wrapInValue(r)),this.bump=merge_pass_1.wrapInValue(r)}setCenter(r){this.centerFloat.setVal(merge_pass_1.wrapInValue(r)),this.center=merge_pass_1.wrapInValue(r)}setEdge(r){this.edgeFloat.setVal(merge_pass_1.wrapInValue(r)),this.edge=merge_pass_1.wrapInValue(r)}}celshade$1.CelShade=CelShade;function celshade(t=merge_pass_1.mut(.8),r=merge_pass_1.mut(.3),e=merge_pass_1.mut(.3),o=merge_pass_1.mut(.03)){return new CelShade(merge_pass_1.wrapInValue(t),merge_pass_1.wrapInValue(r),merge_pass_1.wrapInValue(e),merge_pass_1.wrapInValue(o))}celshade$1.celshade=celshade;(function(t){var r=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,n,a,l){l===void 0&&(l=a),Object.defineProperty(o,l,{enumerable:!0,get:function(){return n[a]}})}:function(o,n,a,l){l===void 0&&(l=a),o[l]=n[a]}),e=commonjsGlobal&&commonjsGlobal.__exportStar||function(o,n){for(var a in o)a!=="default"&&!n.hasOwnProperty(a)&&r(n,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),e(foggyrays$1,t),e(vignette$1,t),e(blurandtrace$1,t),e(lightbands$1,t),e(noisedisplacement$1,t),e(oldfilm$1,t),e(kaleidoscope$1,t),e(celshade$1,t)})(dist$1);document.getElementById("gl");const processed=document.getElementById("processed");processed.getContext("webgl");let gl,framebuffer,simulationProgram,drawProgram,uTime,uSimulationState,uRes,uAudio,uDA,uDB,uFeed,uKill,uDiffuse,uColA,uColB,uAutomata,textureBack,textureFront,dimensions={width:null,height:null},diffuse=!1,automata=!1,colA=getColor("A"),colB=getColor("B"),audio,audioData,bufferLength,analyser,audioContext,audioElement,uVar={dA:[1,!1,0,1],dB:[.5,!1,0,1],f:[.055,!1,0,.1],k:[.062,!1,0,.1]},mic=!1,width,height;const presets=[{dA:1,dB:.2,f:.029,k:.057},{dA:.21,dB:.105,f:.022,k:.049},{dA:.21,dB:.13,f:.041,k:.059},{dA:.21,dB:.105,f:.015,k:.049},{dA:.21,dB:.105,f:.049,k:.061}];let prevShuffle=-1;window.onload=function(){document.getElementById("infoContainer").style.visibility="visible",document.getElementById("paramContainer").style.visibility="visible",document.getElementById("paramB").style.visibility="visible",document.getElementById("loading").style.display="none",navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){audioContext=new(window.AudioContext||window.webkitAudioContext),audioElement=document.querySelector("audio");const r=audioContext.createMediaElementSource(audioElement);analyser=audioContext.createAnalyser(),analyser.fftSize=256,bufferLength=analyser.frequencyBinCount,audio=new Uint8Array(bufferLength),r.connect(analyser),analyser.connect(audioContext.destination),analyser.getByteFrequencyData(audio),mic=!0,audioElement.addEventListener("ended",()=>{},!1)});const canvas=document.getElementById("gl"),processed=document.getElementById("processed");gl=canvas.getContext("webgl"),width=canvas.width=processed.width=dimensions.width=document.body.clientWidth,height=canvas.height=processed.height=dimensions.height=document.body.clientHeight,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),makeBuffer(),makeShaders(),makeTextures(),setInitialState();const cm=CodeMirror(document.getElementById("editor"),{value:`feed(0.029)
kill(audio)
rateA(1)
rateB(0.2)
diffuse(true)
            
playMusic(1)`,mode:"javascript",lineNumbers:!0,colorpicker:{mode:"edit",type:"mini",outputFormat:"hex"}});cm.setOption("extraKeys",{"Ctrl-Enter":function(cm){var code=cm.getValue(),parsedCode=peg$parse(code);console.log(parsedCode),eval("("+parsedCode+")")},"Shift-Enter":function(t){runSelected(t)}});var helpIcon=document.getElementById("helpIcon"),overlay=document.getElementById("popupContainer"),shuffleIcon=document.getElementById("shuffleIcon"),tabHeader=document.getElementsByClassName("tab-header")[0],tabIndicator=document.getElementsByClassName("tab-indicator")[0],tabBody=document.getElementsByClassName("tab-body")[0],tabs=tabHeader.getElementsByTagName("div"),paramB=document.getElementById("paramB");helpIcon.addEventListener("click",t=>{document.getElementById("helpPopup").classList.add("open-popup"),overlay.style.visibility="visible",console.log("click")}),overlay.addEventListener("click",t=>{let r=document.getElementsByClassName("popup");overlay.style.visibility="hidden";for(let e of r)e.classList.remove("open-popup")}),shuffleIcon.addEventListener("click",t=>{let r=Math.floor(Math.random()*(presets.length-1));for(;r===prevShuffle;)r=Math.floor(Math.random()*(presets.length-1));console.log(r),uVar.dA[0]=presets[r].dA,uVar.dB[0]=presets[r].dB,uVar.f[0]=presets[r].f,uVar.k[0]=presets[r].k,uVar.dA[1]=!1,uVar.dB[1]=!1,uVar.f[1]=!1,uVar.k[1]=!1,prevShuffle=r});for(let t=0;t<tabs.length;t++)tabs[t].addEventListener("click",r=>{tabHeader.getElementsByClassName("active-tab")[0].classList.remove("active-tab"),tabs[t].classList.add("active-tab"),tabBody.getElementsByClassName("active-tab")[0].classList.remove("active-tab"),tabBody.getElementsByTagName("div")[t].classList.add("active-tab"),tabIndicator.style.left=`calc(calc(100% / 3) * ${t})`});paramB.addEventListener("click",t=>{var r=document.getElementsByClassName("paramContent");console.log("click");for(var e=0;e<r.length;e++)r[e].style.display==="none"?r[e].style.display="block":r[e].style.display="none"}),paramInfo()};function paramInfo(){for(var t=document.getElementById("textParams");t.firstChild;)t.removeChild(t.firstChild);for(let r in uVar){let e=document.createElement("p"),o=parseFloat(uVar[r][0]).toFixed(4);e.textContent=r+": "+o+`
`,t.append(e)}}function poke(t,r,e,o,n,a){gl.bindTexture(gl.TEXTURE_2D,a),gl.texSubImage2D(gl.TEXTURE_2D,0,t,r,1,1,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([e,o,n,255]))}var poking=function t(r,e,o,n,a){poke(r,e,o,n,a,textureBack)};function setInitialState(){gl.uniform1f(uDA,uVar.dA[0]),gl.uniform1f(uDB,uVar.dB[0]),gl.uniform1f(uFeed,uVar.f[0]),gl.uniform1f(uKill,uVar.k[0]);var t=width/2,r=height/2;rect(t,r,100,100)}function makeBuffer(){const t=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,t);const r=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);gl.bufferData(gl.ARRAY_BUFFER,r,gl.STATIC_DRAW)}function makeShaders(){let t=document.getElementById("vertex"),r=t.text;const e=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(e,r),gl.compileShader(e),t=document.getElementById("render"),r=t.text;const o=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(o,r),gl.compileShader(o),console.log(gl.getShaderInfoLog(o)),drawProgram=gl.createProgram(),gl.attachShader(drawProgram,e),gl.attachShader(drawProgram,o),gl.linkProgram(drawProgram),gl.useProgram(drawProgram),uRes=gl.getUniformLocation(drawProgram,"resolution"),uColA=gl.getUniformLocation(drawProgram,"colA"),uColB=gl.getUniformLocation(drawProgram,"colB"),gl.uniform2f(uRes,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.uniform3f(uColA,colA[0],colA[1],colA[2]),gl.uniform3f(uColB,colB[0],colB[1],colB[2]);let n=gl.getAttribLocation(drawProgram,"a_position");gl.enableVertexAttribArray(n),gl.vertexAttribPointer(n,2,gl.FLOAT,!1,0,0),t=document.getElementById("simulation"),r=t.text;const a=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(a,r),gl.compileShader(a),console.log(gl.getShaderInfoLog(a)),simulationProgram=gl.createProgram(),gl.attachShader(simulationProgram,e),gl.attachShader(simulationProgram,a),gl.linkProgram(simulationProgram),gl.useProgram(simulationProgram),uRes=gl.getUniformLocation(simulationProgram,"resolution"),gl.uniform2f(uRes,gl.drawingBufferWidth,gl.drawingBufferHeight),uTime=gl.getUniformLocation(simulationProgram,"time"),uDA=gl.getUniformLocation(simulationProgram,"dA"),uDB=gl.getUniformLocation(simulationProgram,"dB"),uFeed=gl.getUniformLocation(simulationProgram,"feed"),uKill=gl.getUniformLocation(simulationProgram,"kill"),gl.getUniformLocation(simulationProgram,"size"),uDiffuse=gl.getUniformLocation(simulationProgram,"diffuse"),uAutomata=gl.getUniformLocation(simulationProgram,"automata"),uAudio=gl.getUniformLocation(simulationProgram,"audioData"),uSimulationState=gl.getUniformLocation(simulationProgram,"state"),n=gl.getAttribLocation(simulationProgram,"a_position"),gl.enableVertexAttribArray(simulationProgram),gl.vertexAttribPointer(n,2,gl.FLOAT,!1,0,0)}function makeTextures(){gl.getExtension("EXT_color_buffer_float"),textureBack=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,textureBack),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,dimensions.width,dimensions.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),textureFront=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,textureFront),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,dimensions.width,dimensions.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),framebuffer=gl.createFramebuffer(),render()}let time=0;function render(){if(window.requestAnimationFrame(render),gl.useProgram(simulationProgram),mic===!0){analyser.getByteFrequencyData(audio);let e=0;for(var t=0;t<bufferLength;t++)e+=audio[t];audioData=e/bufferLength;for(let o in uVar)if(uVar[o][1]===!0){let n=uVar[o][2],a=uVar[o][3];audioData=map(audioData,0,200,n,a),uVar[o][0]=audioData}}time++,colA=getColor("A"),colB=getColor("B"),gl.uniform1f(uTime,time),gl.uniform1f(uDA,uVar.dA[0]),gl.uniform1f(uDB,uVar.dB[0]),gl.uniform1f(uFeed,uVar.f[0]),gl.uniform1f(uKill,uVar.k[0]),gl.uniform1f(uDiffuse,diffuse),gl.uniform1f(uAutomata,automata),gl.uniform1f(uAudio,audioData),gl.uniform3f(uColA,colA[0],colA[1],colA[2]),gl.uniform3f(uColB,colB[0],colB[1],colB[2]),time%100===0&&(paramInfo(),update(uVar,time)),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,textureFront,0),gl.viewport(0,0,dimensions.width,dimensions.height),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,textureBack),gl.uniform1i(uSimulationState,0),gl.drawArrays(gl.TRIANGLES,0,6);let r=textureFront;textureFront=textureBack,textureBack=r,gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,dimensions.width,dimensions.height),gl.bindTexture(gl.TEXTURE_2D,textureFront),gl.useProgram(drawProgram),gl.drawArrays(gl.TRIANGLES,0,6)}function map(t,r,e,o,n){return o+(t-r)*(n-o)/(e-r)}function runSelected(cm){let pos=cm.getCursor(),text=null;if(text=cm.getDoc().getSelection(),text===""?text=cm.getLine(pos.line):pos={start:cm.getCursor("start"),end:cm.getCursor("end")},pos.start===void 0){let t=pos.line,r=0,e=text.length;pos={start:{line:t,ch:r},end:{line:t,ch:e}}}console.log(text);var parsedCode=peg$parse(text);console.log(parsedCode),flash(cm,pos),eval("("+parsedCode+")")}function flash(t,r){let e,o=function(){e.clear()};r!==null?r.start?e=t.markText(r.start,r.end,{className:"CodeMirror-highlight"}):e=t.markText({line:r.line,ch:0},{line:r.line,ch:null},{className:"CodeMirror-highlight"}):(self=t.markText(t.getCursor(!0,t.getCursor(!1,{className:"CodeMirror-highlight"}))),window.setTimeout(o,250)),console.log("highlighted")}
