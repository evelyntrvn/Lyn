(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const style="";function peg$subclass(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function peg$SyntaxError(t,e,r,o){var n=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(n,peg$SyntaxError.prototype),n.expected=e,n.found=r,n.location=o,n.name="SyntaxError",n}peg$subclass(peg$SyntaxError,Error);function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,r+=r.repeat(e),t+r.slice(0,e))}peg$SyntaxError.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r=null,o;for(o=0;o<t.length;o++)if(t[o].source===this.location.source){r=t[o].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,a=this.location.source+":"+n.line+":"+n.column;if(r){var l=this.location.end,u=peg$padEnd("",n.line.toString().length," "),p=r[n.line-1],f=n.line===l.line?l.column:p.length+1,h=f-n.column||1;e+=`
 --> `+a+`
`+u+` |
`+n.line+" | "+p+`
`+u+" | "+peg$padEnd("",n.column-1," ")+peg$padEnd("",h,"^")}else e+=`
 at `+a}return e};peg$SyntaxError.buildMessage=function(t,e){var r={literal:function(f){return'"'+n(f.text)+'"'},class:function(f){var h=f.parts.map(function(E){return Array.isArray(E)?a(E[0])+"-"+a(E[1]):a(E)});return"["+(f.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function o(f){return f.charCodeAt(0).toString(16).toUpperCase()}function n(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+o(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+o(h)})}function a(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+o(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+o(h)})}function l(f){return r[f.type](f)}function u(f){var h=f.map(l),E,F;if(h.sort(),h.length>0){for(E=1,F=1;E<h.length;E++)h[E-1]!==h[E]&&(h[F]=h[E],F++);h.length=F}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function p(f){return f?'"'+n(f)+'"':"end of input"}return"Expected "+u(t)+" but "+p(e)+" found."};function peg$parse(t,e){e=e!==void 0?e:{};var r={},o=e.grammarSource,n={start:Se},a=Se,l=".",u="true",p="True",f="false",h="False",E="{",F="}",x="audio",b="time",M="rect",U="#",I=")",y="diffuse(",d="rateA(",C="rateB(",B="feed(",T="kill(",V="size(",R="wait(",D="reset",k="automata(",q="playMusic(",O="pauseMusic",H="colorA(",W="colorB(",Q="kal",N="blur",Y="celShade",S="foggy",m="light",v="noise",L="oldFilm",G="vignette",ae="size",se="side",he="noEffect",Le="(",De=/^[0-9]/,Ue=/^[1-9]/,xe=/^[^{}]/,_e=/^[ \t\n\r]/,ve=/^[^{} \t\n\r]/,Ne=/^[0-9A-Fa-f]/,ke=oe("start"),qe=oe("term"),Oe=A(".",!1),Ge=re([["0","9"]],!1,!1),je=re([["1","9"]],!1,!1),We=A("true",!1),Xe=A("True",!1),ze=A("false",!1),He=A("False",!1),Ke=oe("primary"),$e=re(["{","}"],!0,!1),Ye=A("{",!1),Je=A("}",!1),Qe=oe("whitespace"),be=re([" ","	",`
`,"\r"],!1,!1),Ze=oe("keyword"),Ee=re(["{","}"," ","	",`
`,"\r"],!0,!1),er=A("audio",!1),rr=A("time",!1),tr=A("rect",!1),sr=re([["0","9"],["A","F"],["a","f"]],!1,!1),or=A("#",!1),X=A(")",!1),nr=A("diffuse(",!1),ar=A("rateA(",!1),ir=A("rateB(",!1),lr=A("feed(",!1),cr=A("kill(",!1),ur=A("size(",!1),pr=A("wait(",!1),fr=A("reset",!1),gr=A("automata(",!1),mr=A("playMusic(",!1),dr=A("pauseMusic",!1),hr=A("colorA(",!1),xr=A("colorB(",!1),_r=A("kal",!1),vr=A("blur",!1),$r=A("celShade",!1),br=A("foggy",!1),Er=A("light",!1),yr=A("noise",!1),wr=A("oldFilm",!1),Fr=A("vignette",!1),Sr=A("size",!1),Tr=A("side",!1),Vr=A("noEffect",!1),Cr=A("(",!1),Mr=function(s){return s},Ar=function(){return"true"},Rr=function(){return"false"},Br=function(s,c){return parseFloat(`${s}`)+parseFloat(`${c}`)},Ir=function(s,c){return parseFloat(`.${c}`)},Pr=function(s,c){return parseInt(`${ye()}`)},Lr=function(){return ye()},Dr=function(s){return s.join("")},Ur=function(){return"'audio'"},Nr=function(){return Date.getTime},kr=function(s,c,g,_){var j=`shape.rect( ${s}, ${c}, ${g}, ${_} )`;return j},qr=function(s){return`${s}`},Or=function(s){return`"#${s.join("")}"`},Gr=function(s){return`setDiffuse(${s})`},jr=function(s){return`rateA(${s})`},Wr=function(s){return`rateB(${s})`},Xr=function(s){return`feed(${s})`},zr=function(s){return`kill(${s})`},Hr=function(s){return`size(${s})`},Kr=function(s){return`wait(${s}*1000)`},Yr=function(){return"reset()"},Jr=function(s){return`setAutomata(${s})`},Qr=function(s){return`playMusic(${s})`},Zr=function(){return"pauseMusic()"},et=function(s){return`col.setColor("A", "${s}")`},rt=function(s){return`col.setColor("B", "${s}")`},tt=function(){return"noEffect()"},st=function(s){return`postEffect("${s}")`},ot=function(s){return`${s}`},nt=function(s,c,g){return`setEffect('${s}', '${c}', ${g})`},i=0,P=0,ie=[{line:1,column:1}],K=0,ue=[],$=0,le;if("startRule"in e){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');a=n[e.startRule]}function ye(){return t.substring(P,i)}function A(s,c){return{type:"literal",text:s,ignoreCase:c}}function re(s,c,g){return{type:"class",parts:s,inverted:c,ignoreCase:g}}function at(){return{type:"end"}}function oe(s){return{type:"other",description:s}}function we(s){var c=ie[s],g;if(c)return c;for(g=s-1;!ie[g];)g--;for(c=ie[g],c={line:c.line,column:c.column};g<s;)t.charCodeAt(g)===10?(c.line++,c.column=1):c.column++,g++;return ie[s]=c,c}function Fe(s,c){var g=we(s),_=we(c);return{source:o,start:{offset:s,line:g.line,column:g.column},end:{offset:c,line:_.line,column:_.column}}}function w(s){i<K||(i>K&&(K=i,ue=[]),ue.push(s))}function it(s,c,g){return new peg$SyntaxError(peg$SyntaxError.buildMessage(s,c),s,c,g)}function Se(){var s,c;if($++,s=[],c=Te(),c!==r)for(;c!==r;)s.push(c),c=Te();else s=r;return $--,s===r&&(c=r,$===0&&w(ke)),s}function Te(){var s,c;return $++,s=i,Z(),c=mt(),c===r&&(c=gt()),c!==r?(Z(),P=s,s=Mr(c)):(i=s,s=r),$--,s===r&&$===0&&w(qe),s}function Ve(){var s;return t.charCodeAt(i)===46?(s=l,i++):(s=r,$===0&&w(Oe)),s}function ce(){var s;return De.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,$===0&&w(Ge)),s}function lt(){var s;return Ue.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,$===0&&w(je)),s}function ct(){var s,c;return t.substr(i,4)===u?(s=u,i+=4):(s=r,$===0&&w(We)),s===r&&(s=i,t.substr(i,4)===p?(c=p,i+=4):(c=r,$===0&&w(Xe)),c!==r&&(P=s,c=Ar()),s=c),s}function ut(){var s,c;return t.substr(i,5)===f?(s=f,i+=5):(s=r,$===0&&w(ze)),s===r&&(s=i,t.substr(i,5)===h?(c=h,i+=5):(c=r,$===0&&w(He)),c!==r&&(P=s,c=Rr()),s=c),s}function J(){var s;return $++,s=pt(),s===r&&(s=pe()),$--,s===r&&$===0&&w(Ke),s}function pt(){var s,c,g;return s=i,c=pe(),c!==r?(g=ft(),g!==r?(P=s,s=Br(c,g)):(i=s,s=r)):(i=s,s=r),s}function ft(){var s,c,g,_;if(s=i,c=Ve(),c!==r){if(g=[],_=ce(),_!==r)for(;_!==r;)g.push(_),_=ce();else g=r;g!==r?(P=s,s=Ir(c,g)):(i=s,s=r)}else i=s,s=r;return s}function pe(){var s,c,g,_;if(s=i,c=lt(),c!==r){for(g=[],_=ce();_!==r;)g.push(_),_=ce();P=s,s=Pr()}else i=s,s=r;return s}function Ce(){var s;return s=ct(),s===r&&(s=ut()),s}function fe(){var s,c,g;if(s=i,c=[],xe.test(t.charAt(i))?(g=t.charAt(i),i++):(g=r,$===0&&w($e)),g!==r)for(;g!==r;)c.push(g),xe.test(t.charAt(i))?(g=t.charAt(i),i++):(g=r,$===0&&w($e));else c=r;return c!==r&&(P=s,c=Lr()),s=c,s}function ge(){var s,c;for(s=[],c=fe();c!==r;)s.push(c),c=fe();return s}function gt(){var s,c,g,_;return s=i,t.charCodeAt(i)===123?(c=E,i++):(c=r,$===0&&w(Ye)),c!==r?(g=ge(),t.charCodeAt(i)===125?(_=F,i++):(_=r,$===0&&w(Je)),_!==r?(P=s,s=Dr(g)):(i=s,s=r)):(i=s,s=r),s===r&&(s=fe()),s}function Z(){var s,c;for($++,s=[],_e.test(t.charAt(i))?(c=t.charAt(i),i++):(c=r,$===0&&w(be));c!==r;)s.push(c),_e.test(t.charAt(i))?(c=t.charAt(i),i++):(c=r,$===0&&w(be));return $--,c=r,$===0&&w(Qe),s}function mt(){var s,c,g;if($++,s=_t(),s===r&&(s=yt(),s===r&&(s=Mt(),s===r&&(s=Tt(),s===r&&(s=Et(),s===r&&(s=wt(),s===r&&(s=Me(),s===r&&(s=dt(),s===r&&(s=ht(),s===r&&(s=Ae(),s===r&&(s=Re(),s===r&&(s=Be(),s===r&&(s=Ie(),s===r&&(s=bt(),s===r&&(s=J(),s===r&&(s=xt(),s===r)))))))))))))))){if(s=i,c=[],ve.test(t.charAt(i))?(g=t.charAt(i),i++):(g=r,$===0&&w(Ee)),g!==r)for(;g!==r;)c.push(g),ve.test(t.charAt(i))?(g=t.charAt(i),i++):(g=r,$===0&&w(Ee));else c=r;c!==r?s=t.substring(s,i):s=c}return $--,s===r&&(c=r,$===0&&w(Ze)),s}function Me(){var s,c;return s=i,t.substr(i,5)===x?(c=x,i+=5):(c=r,$===0&&w(er)),c!==r&&(P=s,c=Ur()),s=c,s}function dt(){var s,c;return s=i,t.substr(i,4)===b?(c=b,i+=4):(c=r,$===0&&w(rr)),c!==r&&(P=s,c=Nr()),s=c,s}function ht(){var s,c,g,_,j,z;return s=i,t.substr(i,4)===M?(c=M,i+=4):(c=r,$===0&&w(tr)),c!==r?(Z(),g=J(),g!==r?(Z(),_=J(),_!==r?(Z(),j=J(),j!==r?(Z(),z=J(),z!==r?(P=s,s=kr(g,_,j,z)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function te(){var s,c;return s=i,Ne.test(t.charAt(i))?(c=t.charAt(i),i++):(c=r,$===0&&w(sr)),c!==r&&(P=s,c=qr(c)),s=c,s}function xt(){var s,c,g,_,j,z,ee,me,de;return s=i,t.charCodeAt(i)===35?(c=U,i++):(c=r,$===0&&w(or)),c!==r?(g=i,_=te(),_!==r?(j=te(),j!==r?(z=te(),z!==r?(ee=te(),ee!==r?(me=te(),me!==r?(de=te(),de!==r?(_=[_,j,z,ee,me,de],g=_):(i=g,g=r)):(i=g,g=r)):(i=g,g=r)):(i=g,g=r)):(i=g,g=r)):(i=g,g=r),g!==r?(P=s,s=Or(g)):(i=s,s=r)):(i=s,s=r),s}function _t(){var s;return s=vt(),s===r&&(s=Ae(),s===r&&(s=Re(),s===r&&(s=Be(),s===r&&(s=Ie(),s===r&&(s=$t()))))),s}function ne(){var s;return s=J(),s===r&&(s=Me()),s}function vt(){var s,c,g,_;return s=i,t.substr(i,8)===y?(c=y,i+=8):(c=r,$===0&&w(nr)),c!==r?(g=Ce(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Gr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function Ae(){var s,c,g,_;return s=i,t.substr(i,6)===d?(c=d,i+=6):(c=r,$===0&&w(ar)),c!==r?(g=ne(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=jr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function Re(){var s,c,g,_;return s=i,t.substr(i,6)===C?(c=C,i+=6):(c=r,$===0&&w(ir)),c!==r?(g=ne(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Wr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function Be(){var s,c,g,_;return s=i,t.substr(i,5)===B?(c=B,i+=5):(c=r,$===0&&w(lr)),c!==r?(g=ne(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Xr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function Ie(){var s,c,g,_;return s=i,t.substr(i,5)===T?(c=T,i+=5):(c=r,$===0&&w(cr)),c!==r?(g=ne(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=zr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function $t(){var s,c,g,_;return s=i,t.substr(i,5)===V?(c=V,i+=5):(c=r,$===0&&w(ur)),c!==r?(g=ne(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Hr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function bt(){var s,c,g,_;return s=i,t.substr(i,5)===R?(c=R,i+=5):(c=r,$===0&&w(pr)),c!==r?(g=J(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Kr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function Et(){var s,c;return s=i,t.substr(i,5)===D?(c=D,i+=5):(c=r,$===0&&w(fr)),c!==r&&(P=s,c=Yr()),s=c,s}function yt(){var s,c,g,_;return s=i,t.substr(i,9)===k?(c=k,i+=9):(c=r,$===0&&w(gr)),c!==r?(g=Ce(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Jr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function wt(){var s;return s=Ft(),s===r&&(s=St()),s}function Ft(){var s,c,g,_;return s=i,t.substr(i,10)===q?(c=q,i+=10):(c=r,$===0&&w(mr)),c!==r?(g=pe(),g!==r?(t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=Qr(g)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}function St(){var s,c;return s=i,t.substr(i,10)===O?(c=O,i+=10):(c=r,$===0&&w(dr)),c!==r&&(P=s,c=Zr()),s=c,s}function Tt(){var s;return s=Vt(),s===r&&(s=Ct()),s}function Vt(){var s,c,g,_;return s=i,t.substr(i,7)===H?(c=H,i+=7):(c=r,$===0&&w(hr)),c!==r?(g=ge(),t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=et(g)):(i=s,s=r)):(i=s,s=r),s}function Ct(){var s,c,g,_;return s=i,t.substr(i,7)===W?(c=W,i+=7):(c=r,$===0&&w(xr)),c!==r?(g=ge(),t.charCodeAt(i)===41?(_=I,i++):(_=r,$===0&&w(X)),_!==r?(P=s,s=rt(g)):(i=s,s=r)):(i=s,s=r),s}function Mt(){var s;return s=Pt(),s===r&&(s=Rt(),s===r&&(s=Bt())),s}function Pe(){var s;return t.substr(i,3)===Q?(s=Q,i+=3):(s=r,$===0&&w(_r)),s===r&&(t.substr(i,4)===N?(s=N,i+=4):(s=r,$===0&&w(vr)),s===r&&(t.substr(i,8)===Y?(s=Y,i+=8):(s=r,$===0&&w($r)),s===r&&(t.substr(i,5)===S?(s=S,i+=5):(s=r,$===0&&w(br)),s===r&&(t.substr(i,5)===m?(s=m,i+=5):(s=r,$===0&&w(Er)),s===r&&(t.substr(i,5)===v?(s=v,i+=5):(s=r,$===0&&w(yr)),s===r&&(t.substr(i,7)===L?(s=L,i+=7):(s=r,$===0&&w(wr)),s===r&&(t.substr(i,8)===G?(s=G,i+=8):(s=r,$===0&&w(Fr))))))))),s}function At(){var s;return t.substr(i,4)===ae?(s=ae,i+=4):(s=r,$===0&&w(Sr)),s===r&&(t.substr(i,4)===se?(s=se,i+=4):(s=r,$===0&&w(Tr))),s}function Rt(){var s,c;return s=i,t.substr(i,8)===he?(c=he,i+=8):(c=r,$===0&&w(Vr)),c!==r&&(P=s,c=tt()),s=c,s}function Bt(){var s,c;return s=i,c=Pe(),c!==r?(Z(),P=s,s=st(c)):(i=s,s=r),s}function It(){var s,c;return s=i,c=At(),c!==r&&(P=s,c=ot(c)),s=c,s}function Pt(){var s,c,g,_,j,z,ee;return s=i,c=Pe(),c!==r?(g=Ve(),g!==r?(_=It(),_!==r?(t.charCodeAt(i)===40?(j=Le,i++):(j=r,$===0&&w(Cr)),j!==r?(z=J(),z!==r?(t.charCodeAt(i)===41?(ee=I,i++):(ee=r,$===0&&w(X)),ee!==r?(P=s,s=nt(c,_,z)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r)):(i=s,s=r),s}if(le=a(),le!==r&&i===t.length)return le;throw le!==r&&i<t.length&&w(at()),it(ue,K<t.length?t.charAt(K):null,K<t.length?Fe(K,K+1):Fe(K,K))}function rect(t,e,r,o){for(var n=0;n<window.innerWidth;n++)for(var a=0;a<window.innerHeight;a++)n>=t&&n<=t+r&&a<=e+o&&a>=e?poking(n,a,0,255,0):poking(n,a,255,0,0);console.log("rect")}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const cssKeywords=colorName,reverseKeywords={};for(const t of Object.keys(cssKeywords))reverseKeywords[cssKeywords[t]]=t;const convert$1={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};var conversions$2=convert$1;for(const t of Object.keys(convert$1)){if(!("channels"in convert$1[t]))throw new Error("missing channels property: "+t);if(!("labels"in convert$1[t]))throw new Error("missing channel labels property: "+t);if(convert$1[t].labels.length!==convert$1[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:e,labels:r}=convert$1[t];delete convert$1[t].channels,delete convert$1[t].labels,Object.defineProperty(convert$1[t],"channels",{value:e}),Object.defineProperty(convert$1[t],"labels",{value:r})}convert$1.rgb.hsl=function(t){const e=t[0]/255,r=t[1]/255,o=t[2]/255,n=Math.min(e,r,o),a=Math.max(e,r,o),l=a-n;let u,p;a===n?u=0:e===a?u=(r-o)/l:r===a?u=2+(o-e)/l:o===a&&(u=4+(e-r)/l),u=Math.min(u*60,360),u<0&&(u+=360);const f=(n+a)/2;return a===n?p=0:f<=.5?p=l/(a+n):p=l/(2-a-n),[u,p*100,f*100]};convert$1.rgb.hsv=function(t){let e,r,o,n,a;const l=t[0]/255,u=t[1]/255,p=t[2]/255,f=Math.max(l,u,p),h=f-Math.min(l,u,p),E=function(F){return(f-F)/6/h+1/2};return h===0?(n=0,a=0):(a=h/f,e=E(l),r=E(u),o=E(p),l===f?n=o-r:u===f?n=1/3+e-o:p===f&&(n=2/3+r-e),n<0?n+=1:n>1&&(n-=1)),[n*360,a*100,f*100]};convert$1.rgb.hwb=function(t){const e=t[0],r=t[1];let o=t[2];const n=convert$1.rgb.hsl(t)[0],a=1/255*Math.min(e,Math.min(r,o));return o=1-1/255*Math.max(e,Math.max(r,o)),[n,a*100,o*100]};convert$1.rgb.cmyk=function(t){const e=t[0]/255,r=t[1]/255,o=t[2]/255,n=Math.min(1-e,1-r,1-o),a=(1-e-n)/(1-n)||0,l=(1-r-n)/(1-n)||0,u=(1-o-n)/(1-n)||0;return[a*100,l*100,u*100,n*100]};function comparativeDistance(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2}convert$1.rgb.keyword=function(t){const e=reverseKeywords[t];if(e)return e;let r=1/0,o;for(const n of Object.keys(cssKeywords)){const a=cssKeywords[n],l=comparativeDistance(t,a);l<r&&(r=l,o=n)}return o};convert$1.keyword.rgb=function(t){return cssKeywords[t]};convert$1.rgb.xyz=function(t){let e=t[0]/255,r=t[1]/255,o=t[2]/255;e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92;const n=e*.4124+r*.3576+o*.1805,a=e*.2126+r*.7152+o*.0722,l=e*.0193+r*.1192+o*.9505;return[n*100,a*100,l*100]};convert$1.rgb.lab=function(t){const e=convert$1.rgb.xyz(t);let r=e[0],o=e[1],n=e[2];r/=95.047,o/=100,n/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;const a=116*o-16,l=500*(r-o),u=200*(o-n);return[a,l,u]};convert$1.hsl.rgb=function(t){const e=t[0]/360,r=t[1]/100,o=t[2]/100;let n,a,l;if(r===0)return l=o*255,[l,l,l];o<.5?n=o*(1+r):n=o+r-o*r;const u=2*o-n,p=[0,0,0];for(let f=0;f<3;f++)a=e+1/3*-(f-1),a<0&&a++,a>1&&a--,6*a<1?l=u+(n-u)*6*a:2*a<1?l=n:3*a<2?l=u+(n-u)*(2/3-a)*6:l=u,p[f]=l*255;return p};convert$1.hsl.hsv=function(t){const e=t[0];let r=t[1]/100,o=t[2]/100,n=r;const a=Math.max(o,.01);o*=2,r*=o<=1?o:2-o,n*=a<=1?a:2-a;const l=(o+r)/2,u=o===0?2*n/(a+n):2*r/(o+r);return[e,u*100,l*100]};convert$1.hsv.rgb=function(t){const e=t[0]/60,r=t[1]/100;let o=t[2]/100;const n=Math.floor(e)%6,a=e-Math.floor(e),l=255*o*(1-r),u=255*o*(1-r*a),p=255*o*(1-r*(1-a));switch(o*=255,n){case 0:return[o,p,l];case 1:return[u,o,l];case 2:return[l,o,p];case 3:return[l,u,o];case 4:return[p,l,o];case 5:return[o,l,u]}};convert$1.hsv.hsl=function(t){const e=t[0],r=t[1]/100,o=t[2]/100,n=Math.max(o,.01);let a,l;l=(2-r)*o;const u=(2-r)*n;return a=r*n,a/=u<=1?u:2-u,a=a||0,l/=2,[e,a*100,l*100]};convert$1.hwb.rgb=function(t){const e=t[0]/360;let r=t[1]/100,o=t[2]/100;const n=r+o;let a;n>1&&(r/=n,o/=n);const l=Math.floor(6*e),u=1-o;a=6*e-l,l&1&&(a=1-a);const p=r+a*(u-r);let f,h,E;switch(l){default:case 6:case 0:f=u,h=p,E=r;break;case 1:f=p,h=u,E=r;break;case 2:f=r,h=u,E=p;break;case 3:f=r,h=p,E=u;break;case 4:f=p,h=r,E=u;break;case 5:f=u,h=r,E=p;break}return[f*255,h*255,E*255]};convert$1.cmyk.rgb=function(t){const e=t[0]/100,r=t[1]/100,o=t[2]/100,n=t[3]/100,a=1-Math.min(1,e*(1-n)+n),l=1-Math.min(1,r*(1-n)+n),u=1-Math.min(1,o*(1-n)+n);return[a*255,l*255,u*255]};convert$1.xyz.rgb=function(t){const e=t[0]/100,r=t[1]/100,o=t[2]/100;let n,a,l;return n=e*3.2406+r*-1.5372+o*-.4986,a=e*-.9689+r*1.8758+o*.0415,l=e*.0557+r*-.204+o*1.057,n=n>.0031308?1.055*n**(1/2.4)-.055:n*12.92,a=a>.0031308?1.055*a**(1/2.4)-.055:a*12.92,l=l>.0031308?1.055*l**(1/2.4)-.055:l*12.92,n=Math.min(Math.max(0,n),1),a=Math.min(Math.max(0,a),1),l=Math.min(Math.max(0,l),1),[n*255,a*255,l*255]};convert$1.xyz.lab=function(t){let e=t[0],r=t[1],o=t[2];e/=95.047,r/=100,o/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;const n=116*r-16,a=500*(e-r),l=200*(r-o);return[n,a,l]};convert$1.lab.xyz=function(t){const e=t[0],r=t[1],o=t[2];let n,a,l;a=(e+16)/116,n=r/500+a,l=a-o/200;const u=a**3,p=n**3,f=l**3;return a=u>.008856?u:(a-16/116)/7.787,n=p>.008856?p:(n-16/116)/7.787,l=f>.008856?f:(l-16/116)/7.787,n*=95.047,a*=100,l*=108.883,[n,a,l]};convert$1.lab.lch=function(t){const e=t[0],r=t[1],o=t[2];let n;n=Math.atan2(o,r)*360/2/Math.PI,n<0&&(n+=360);const l=Math.sqrt(r*r+o*o);return[e,l,n]};convert$1.lch.lab=function(t){const e=t[0],r=t[1],n=t[2]/360*2*Math.PI,a=r*Math.cos(n),l=r*Math.sin(n);return[e,a,l]};convert$1.rgb.ansi16=function(t,e=null){const[r,o,n]=t;let a=e===null?convert$1.rgb.hsv(t)[2]:e;if(a=Math.round(a/50),a===0)return 30;let l=30+(Math.round(n/255)<<2|Math.round(o/255)<<1|Math.round(r/255));return a===2&&(l+=60),l};convert$1.hsv.ansi16=function(t){return convert$1.rgb.ansi16(convert$1.hsv.rgb(t),t[2])};convert$1.rgb.ansi256=function(t){const e=t[0],r=t[1],o=t[2];return e===r&&r===o?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(o/255*5)};convert$1.ansi16.rgb=function(t){let e=t%10;if(e===0||e===7)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const r=(~~(t>50)+1)*.5,o=(e&1)*r*255,n=(e>>1&1)*r*255,a=(e>>2&1)*r*255;return[o,n,a]};convert$1.ansi256.rgb=function(t){if(t>=232){const a=(t-232)*10+8;return[a,a,a]}t-=16;let e;const r=Math.floor(t/36)/5*255,o=Math.floor((e=t%36)/6)/5*255,n=e%6/5*255;return[r,o,n]};convert$1.rgb.hex=function(t){const r=(((Math.round(t[0])&255)<<16)+((Math.round(t[1])&255)<<8)+(Math.round(t[2])&255)).toString(16).toUpperCase();return"000000".substring(r.length)+r};convert$1.hex.rgb=function(t){const e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];let r=e[0];e[0].length===3&&(r=r.split("").map(u=>u+u).join(""));const o=parseInt(r,16),n=o>>16&255,a=o>>8&255,l=o&255;return[n,a,l]};convert$1.rgb.hcg=function(t){const e=t[0]/255,r=t[1]/255,o=t[2]/255,n=Math.max(Math.max(e,r),o),a=Math.min(Math.min(e,r),o),l=n-a;let u,p;return l<1?u=a/(1-l):u=0,l<=0?p=0:n===e?p=(r-o)/l%6:n===r?p=2+(o-e)/l:p=4+(e-r)/l,p/=6,p%=1,[p*360,l*100,u*100]};convert$1.hsl.hcg=function(t){const e=t[1]/100,r=t[2]/100,o=r<.5?2*e*r:2*e*(1-r);let n=0;return o<1&&(n=(r-.5*o)/(1-o)),[t[0],o*100,n*100]};convert$1.hsv.hcg=function(t){const e=t[1]/100,r=t[2]/100,o=e*r;let n=0;return o<1&&(n=(r-o)/(1-o)),[t[0],o*100,n*100]};convert$1.hcg.rgb=function(t){const e=t[0]/360,r=t[1]/100,o=t[2]/100;if(r===0)return[o*255,o*255,o*255];const n=[0,0,0],a=e%1*6,l=a%1,u=1-l;let p=0;switch(Math.floor(a)){case 0:n[0]=1,n[1]=l,n[2]=0;break;case 1:n[0]=u,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=l;break;case 3:n[0]=0,n[1]=u,n[2]=1;break;case 4:n[0]=l,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=u}return p=(1-r)*o,[(r*n[0]+p)*255,(r*n[1]+p)*255,(r*n[2]+p)*255]};convert$1.hcg.hsv=function(t){const e=t[1]/100,r=t[2]/100,o=e+r*(1-e);let n=0;return o>0&&(n=e/o),[t[0],n*100,o*100]};convert$1.hcg.hsl=function(t){const e=t[1]/100,o=t[2]/100*(1-e)+.5*e;let n=0;return o>0&&o<.5?n=e/(2*o):o>=.5&&o<1&&(n=e/(2*(1-o))),[t[0],n*100,o*100]};convert$1.hcg.hwb=function(t){const e=t[1]/100,r=t[2]/100,o=e+r*(1-e);return[t[0],(o-e)*100,(1-o)*100]};convert$1.hwb.hcg=function(t){const e=t[1]/100,o=1-t[2]/100,n=o-e;let a=0;return n<1&&(a=(o-n)/(1-n)),[t[0],n*100,a*100]};convert$1.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]};convert$1.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]};convert$1.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]};convert$1.gray.hsl=function(t){return[0,0,t[0]]};convert$1.gray.hsv=convert$1.gray.hsl;convert$1.gray.hwb=function(t){return[0,100,t[0]]};convert$1.gray.cmyk=function(t){return[0,0,0,t[0]]};convert$1.gray.lab=function(t){return[t[0],0,0]};convert$1.gray.hex=function(t){const e=Math.round(t[0]/100*255)&255,o=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(o.length)+o};convert$1.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};const conversions$1=conversions$2;function buildGraph(){const t={},e=Object.keys(conversions$1);for(let r=e.length,o=0;o<r;o++)t[e[o]]={distance:-1,parent:null};return t}function deriveBFS(t){const e=buildGraph(),r=[t];for(e[t].distance=0;r.length;){const o=r.pop(),n=Object.keys(conversions$1[o]);for(let a=n.length,l=0;l<a;l++){const u=n[l],p=e[u];p.distance===-1&&(p.distance=e[o].distance+1,p.parent=o,r.unshift(u))}}return e}function link(t,e){return function(r){return e(t(r))}}function wrapConversion(t,e){const r=[e[t].parent,t];let o=conversions$1[e[t].parent][t],n=e[t].parent;for(;e[n].parent;)r.unshift(e[n].parent),o=link(conversions$1[e[n].parent][n],o),n=e[n].parent;return o.conversion=r,o}var route$1=function(t){const e=deriveBFS(t),r={},o=Object.keys(e);for(let n=o.length,a=0;a<n;a++){const l=o[a];e[l].parent!==null&&(r[l]=wrapConversion(l,e))}return r};const conversions=conversions$2,route=route$1,convert={},models=Object.keys(conversions);function wrapRaw(t){const e=function(...r){const o=r[0];return o==null?o:(o.length>1&&(r=o),t(r))};return"conversion"in t&&(e.conversion=t.conversion),e}function wrapRounded(t){const e=function(...r){const o=r[0];if(o==null)return o;o.length>1&&(r=o);const n=t(r);if(typeof n=="object")for(let a=n.length,l=0;l<a;l++)n[l]=Math.round(n[l]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}models.forEach(t=>{convert[t]={},Object.defineProperty(convert[t],"channels",{value:conversions[t].channels}),Object.defineProperty(convert[t],"labels",{value:conversions[t].labels});const e=route(t);Object.keys(e).forEach(o=>{const n=e[o];convert[t][o]=wrapRounded(n),convert[t][o].raw=wrapRaw(n)})});var colors={A:color("#e6c457"),B:color("#9257e6")};function getColor(t){return colors[t]}function color(t){var e=hexToRgb(t);return e}function hexToRgb(t){var e=t.substring(1),r=parseInt(e.slice(0,2),16),o=parseInt(e.slice(2,4),16),n=parseInt(e.slice(4,6),16),a=[r/255,o/255,n/255];return a}var margin={top:5,right:5,bottom:5,left:5},width$1=125-margin.left-margin.right,height$1=50-margin.top-margin.bottom,svg=d3.select("#graphParams").append("svg").attr("width",width$1+margin.left+margin.right).attr("height",height$1+margin.left+margin.right).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),xMin=0,xMax=10,data=[];function update(t,e){for(let n in t){var r={time:e/100,type:n,val:t[n][0]};data.push(r)}let o=4;for(;data.length>10*o;)data.shift();data.length===10*o&&(xMax++,xMin++),makeGraph()}function makeGraph(){document.querySelector("audio").duration;var t=d3.nest().key(function(a){return a.type}).entries(data),e=t.map(function(a){return a.type}),r=d3.scaleOrdinal().domain(e).range(["#e41a1c","#377eb8","#4daf4a","#984ea3"]),o=d3.scaleTime().domain([xMin,xMax]).range([0,width$1]);svg.append("g").attr("transform","translate(0,"+height$1+")").call(d3.axisBottom(o).ticks(10));var n=d3.scaleLinear().domain([0,1]).range([height$1,0]);svg.append("g").call(d3.axisLeft(n)),d3.selectAll("path.line").remove(),svg.selectAll(".line").data(t).enter().append("path").attr("class","line").attr("fill","none").attr("stroke",function(a){return r(a.key)}).attr("stroke-width",1).attr("d",function(a){return d3.line().x(function(l){return o(l.time)}).y(function(l){return n(l.val)})(a.values)})}var dist$1={},foggyrays$1={},dist={},mergepass={},codebuilder={},expr={},webglprogramloop={},settings={};Object.defineProperty(settings,"__esModule",{value:!0});settings.settings=void 0;settings.settings={verbosity:0,offset:0};Object.defineProperty(webglprogramloop,"__esModule",{value:!0});webglprogramloop.WebGLProgramLoop=webglprogramloop.WebGLProgramLeaf=webglprogramloop.updateNeeds=void 0;const settings_1=settings;function updateNeeds(t,e){return{neighborSample:t.neighborSample||e.neighborSample,centerSample:t.centerSample||e.centerSample,sceneBuffer:t.sceneBuffer||e.sceneBuffer,timeUniform:t.timeUniform||e.timeUniform,mouseUniform:t.mouseUniform||e.mouseUniform,passCount:t.passCount||e.passCount,extraBuffers:new Set([...t.extraBuffers,...e.extraBuffers])}}webglprogramloop.updateNeeds=updateNeeds;class WebGLProgramLeaf{constructor(e,r,o){this.program=e,this.totalNeeds=r,this.effects=o}}webglprogramloop.WebGLProgramLeaf=WebGLProgramLeaf;function getLoc(t,e,r){e.useProgram(t.program);const o=e.getUniformLocation(t.program,r);if(o===null)throw new Error("could not get the "+r+" uniform location");return o}class WebGLProgramLoop{constructor(e,r,o){if(this.last=!1,this.counter=0,this.programElement=e,this.loopInfo=r,this.programElement instanceof WebGLProgramLeaf){if(o===void 0)throw new Error("program element is a program but context is undefined");this.programElement.totalNeeds.timeUniform&&(this.timeLoc=getLoc(this.programElement,o,"uTime")),this.programElement.totalNeeds.mouseUniform&&(this.mouseLoc=getLoc(this.programElement,o,"uMouse")),this.programElement.totalNeeds.passCount&&(this.countLoc=getLoc(this.programElement,o,"uCount"))}}getTotalNeeds(){if(!(this.programElement instanceof WebGLProgramLeaf)){const e=[];for(const r of this.programElement)e.push(r.getTotalNeeds());return e.reduce(updateNeeds)}return this.programElement.totalNeeds}run(e,r,o,n,a,l,u){let p;if(this.loopInfo.target!==void 0&&(u==null?void 0:u.loopInfo.target)!==this.loopInfo.target){if(p=r.back,this.loopInfo.target!==-1)r.back=r.bufTextures[this.loopInfo.target];else{if(r.scene===void 0)throw new Error("tried to target -1 but scene texture was undefined");r.back=r.scene}r.bufTextures[this.loopInfo.target]=p,settings_1.settings.verbosity>99&&console.log("saved texture: "+p.name)}if(this.programElement instanceof WebGLProgramLeaf){if(this.programElement.totalNeeds.sceneBuffer){if(r.scene===void 0)throw new Error("needs scene buffer, but scene texture is somehow undefined");e.activeTexture(e.TEXTURE1+settings_1.settings.offset),this.loopInfo.target===-1?e.bindTexture(e.TEXTURE_2D,p.tex):e.bindTexture(e.TEXTURE_2D,r.scene.tex)}for(const f of this.programElement.totalNeeds.extraBuffers)e.activeTexture(e.TEXTURE2+f+settings_1.settings.offset),e.bindTexture(e.TEXTURE_2D,r.bufTextures[f].tex);e.useProgram(this.programElement.program);for(const f of this.programElement.effects)f.applyUniforms(e,n);if(this.programElement.totalNeeds.timeUniform){if(this.timeLoc===void 0||l.timeVal===void 0)throw new Error("time or location is undefined");e.uniform1f(this.timeLoc,l.timeVal)}if(this.programElement.totalNeeds.mouseUniform){if(this.mouseLoc===void 0||l.mouseX===void 0||l.mouseY===void 0)throw new Error("mouse uniform or location is undefined");e.uniform2f(this.mouseLoc,l.mouseX,l.mouseY)}if(this.programElement.totalNeeds.passCount&&u!==void 0){if(this.countLoc===void 0)throw new Error("count location is undefined");u!==void 0&&e.uniform1i(this.countLoc,u.counter),this.counter++;const f=u===void 0?1:u.loopInfo.num;this.counter%=f}}for(let f=0;f<this.loopInfo.num;f++){const h=f===this.loopInfo.num-1;if(this.programElement instanceof WebGLProgramLeaf){h&&a&&this.last?e.bindFramebuffer(e.FRAMEBUFFER,null):(e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.front.tex,0)),e.activeTexture(e.TEXTURE0+settings_1.settings.offset),e.bindTexture(e.TEXTURE_2D,r.back.tex),e.drawArrays(e.TRIANGLES,0,6),settings_1.settings.verbosity>99&&(console.log("intermediate back",r.back.name),console.log("intermediate front",r.front.name)),[r.back,r.front]=[r.front,r.back];for(const E of this.programElement.totalNeeds.extraBuffers)e.activeTexture(e.TEXTURE2+E+settings_1.settings.offset),e.bindTexture(e.TEXTURE_2D,null);e.activeTexture(e.TEXTURE1+settings_1.settings.offset),e.bindTexture(e.TEXTURE_2D,null)}else{this.loopInfo.func!==void 0&&this.loopInfo.func(f);for(const E of this.programElement)E.run(e,r,o,n,h,l,this)}}if(p!==void 0){const f=this.loopInfo.target;if(settings_1.settings.verbosity>99&&(console.log("pre final back",r.back.name),console.log("pre final front",r.front.name)),this.loopInfo.target!==-1)r.bufTextures[f]=r.back;else{if(r.scene===void 0)throw new Error("tried to replace -1 but scene texture was undefined");r.scene=r.back}r.back=p,settings_1.settings.verbosity>99&&(console.log("post final back",r.back.name),console.log("post final front",r.front.name),console.log("channel texture",r.bufTextures[f].name))}}delete(e){if(this.programElement instanceof WebGLProgramLeaf)e.deleteProgram(this.programElement.program);else for(const r of this.programElement)r.delete(e)}}webglprogramloop.WebGLProgramLoop=WebGLProgramLoop;var utils={},glslfunctions={};Object.defineProperty(glslfunctions,"__esModule",{value:!0});glslfunctions.glslFuncs=void 0;glslfunctions.glslFuncs={texture2D_region:`vec4 texture2D_region(
  float r_x_min,
  float r_y_min,
  float r_x_max,
  float r_y_max,
  sampler2D sampler,
  vec2 uv
) {
  vec2 d = vec2(1., 1.) / uResolution; // pixel width
  return texture2D(sampler, clamp(uv, vec2(r_x_min + d.x, r_y_min + d.x), vec2(r_x_max - d.y, r_y_max - d.y)));
}`,random:`float random(vec2 st) {
  return fract(sin(dot(st.xy / 99., vec2(12.9898, 78.233))) * 43758.5453123);
}`,random2:`vec2 random2(vec2 st) {
  st = vec2(dot(st,vec2(127.1,311.7)), dot(st,vec2(269.5,183.3)));
  return -1.0 + 2.0*fract(sin(st)*43758.5453123);
}`,rotate2d:`vec2 rotate2d(vec2 v, float angle) {
  return mat2(cos(angle), -sin(angle), sin(angle), cos(angle)) * v;
}`,hsv2rgb:`vec4 hsv2rgb(vec4 co){
  vec3 c = co.xyz;
  vec3 rgb = clamp(abs(mod(
    c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);
  rgb = rgb * rgb * (3.0 - 2.0 * rgb);
  vec3 hsv = c.z * mix(vec3(1.0), rgb, c.y);
  return vec4(hsv.x, hsv.y, hsv.z, co.a);
}`,rgb2hsv:`vec4 rgb2hsv(vec4 co){
  vec3 c = co.rgb;
  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
  float d = q.x - min(q.w, q.y);
  float e = 1.0e-10;
  return vec4(abs(q.z + (q.w - q.y) / (6.0 * d + e)),
              d / (q.x + e),
              q.x, co.a);
}`,gauss5:`vec4 gauss5(vec2 dir) {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 col = vec4(0.0);
  vec2 off1 = vec2(1.3333333333333333) * dir;
  col += texture2D(uSampler, uv) * 0.29411764705882354;
  col += texture2D(uSampler, uv + (off1 / uResolution)) * 0.35294117647058826;
  col += texture2D(uSampler, uv - (off1 / uResolution)) * 0.35294117647058826;
  return col;
}`,gauss9:`vec4 gauss9(vec2 dir) {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 col = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * dir;
  vec2 off2 = vec2(3.2307692308) * dir;
  col += texture2D(uSampler, uv) * 0.2270270270;
  col += texture2D(uSampler, uv + (off1 / uResolution)) * 0.3162162162;
  col += texture2D(uSampler, uv - (off1 / uResolution)) * 0.3162162162;
  col += texture2D(uSampler, uv + (off2 / uResolution)) * 0.0702702703;
  col += texture2D(uSampler, uv - (off2 / uResolution)) * 0.0702702703;
  return col;
}`,gauss13:`vec4 gauss13(vec2 dir) {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 col = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * dir;
  vec2 off2 = vec2(3.2941176470588234) * dir;
  vec2 off3 = vec2(5.176470588235294) * dir;
  col += texture2D(uSampler, uv) * 0.1964825501511404;
  col += texture2D(uSampler, uv + (off1 / uResolution)) * 0.2969069646728344;
  col += texture2D(uSampler, uv - (off1 / uResolution)) * 0.2969069646728344;
  col += texture2D(uSampler, uv + (off2 / uResolution)) * 0.09447039785044732;
  col += texture2D(uSampler, uv - (off2 / uResolution)) * 0.09447039785044732;
  col += texture2D(uSampler, uv + (off3 / uResolution)) * 0.010381362401148057;
  col += texture2D(uSampler, uv - (off3 / uResolution)) * 0.010381362401148057;
  return col;
}`,contrast:`vec4 contrast(float val, vec4 col) {
  col.rgb /= col.a;
  col.rgb = ((col.rgb - 0.5) * val) + 0.5;
  col.rgb *= col.a;
  return col;
}`,brightness:`vec4 brightness(float val, vec4 col) {
  col.rgb /= col.a;
  col.rgb += val;
  col.rgb *= col.a;
  return col;
}`,fxaa:`vec4 fxaa() {
  float FXAA_SPAN_MAX = 8.0;
  float FXAA_REDUCE_MUL = 1.0 / FXAA_SPAN_MAX;
  float FXAA_REDUCE_MIN = 1.0 / 128.0;
  float FXAA_SUBPIX_SHIFT = 1.0 / 4.0;

  vec2 rcpFrame = 1. / uResolution.xy;
  vec2 t_uv = gl_FragCoord.xy / uResolution.xy; 
  vec4 uv = vec4(t_uv, t_uv - (rcpFrame * (0.5 + FXAA_SUBPIX_SHIFT)));

  vec3 rgbNW = texture2D(uSampler, uv.zw).xyz;
  vec3 rgbNE = texture2D(uSampler, uv.zw + vec2(1,0) * rcpFrame.xy).xyz;
  vec3 rgbSW = texture2D(uSampler, uv.zw + vec2(0,1) * rcpFrame.xy).xyz;
  vec3 rgbSE = texture2D(uSampler, uv.zw + vec2(1,1) * rcpFrame.xy).xyz;
  vec4 rgbMfull = texture2D(uSampler, uv.xy);
  vec3 rgbM = rgbMfull.xyz;
  float alpha = rgbMfull.a;

  vec3 luma = vec3(0.299, 0.587, 0.114);
  float lumaNW = dot(rgbNW, luma);
  float lumaNE = dot(rgbNE, luma);
  float lumaSW = dot(rgbSW, luma);
  float lumaSE = dot(rgbSE, luma);
  float lumaM = dot(rgbM,  luma);

  float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
  float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

  vec2 dir;
  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
  dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));

  float dirReduce = max(
    (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);

  dir = min(vec2(FXAA_SPAN_MAX,  FXAA_SPAN_MAX),
    max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
    dir * rcpDirMin)) * rcpFrame.xy;

  vec3 rgbA = (1.0 / 2.0) * (
    texture2D(uSampler, uv.xy + dir * (1.0 / 3.0 - 0.5)).xyz +
    texture2D(uSampler, uv.xy + dir * (2.0 / 3.0 - 0.5)).xyz);
  vec3 rgbB = rgbA * (1.0 / 2.0) + (1.0 / 4.0) * (
    texture2D(uSampler, uv.xy + dir * (0.0 / 3.0 - 0.5)).xyz +
    texture2D(uSampler, uv.xy + dir * (3.0 / 3.0 - 0.5)).xyz);

  float lumaB = dot(rgbB, luma);

  if (lumaB < lumaMin || lumaB > lumaMax) {
    return vec4(rgbA.r, rgbA.g, rgbA.b, alpha);
  }

  return vec4(rgbB.r, rgbB.g, rgbB.b, alpha);
}`,gaussian:`float gaussian(float x, float a, float b) {
  float e = 2.71828;
  return pow(e, -pow(x - a, 2.) / b);
}`,truedepth:`float truedepth(float i) {
  i = max(i, 0.00000001);
  return (1. - i) / i;
}`,godrays:`vec4 godrays(
  vec4 col,
  float exposure,
  float decay,
  float density,
  float weight,
  vec2 lightPos,
  float threshold,
  vec4 newColor
) {
  vec2 texCoord = gl_FragCoord.xy / uResolution;
  vec2 deltaTexCoord = texCoord - lightPos;

  const int NUM_SAMPLES = 100;
  deltaTexCoord *= 1. / float(NUM_SAMPLES) * density;
  float illuminationDecay = 1.0;

  for (int i=0; i < NUM_SAMPLES; i++) {
    texCoord -= deltaTexCoord;
    vec4 sample = texture2D(uSampler, texCoord);
    //uncomment sample = depth2occlusion(sample, newColor, threshold);
    sample *= illuminationDecay * weight;
    col += sample;
    illuminationDecay *= decay;
  }
  return col * exposure;
}`,depth2occlusion:`vec4 depth2occlusion(vec4 depthCol, vec4 newCol, float threshold) {
  float red = 1. - ceil(depthCol.r - threshold);
  return vec4(newCol.rgb * red, 1.0);
}`,gradientnoise:`float gradientnoise(vec2 st) {
  vec2 i = floor(st);
  vec2 f = fract(st);

  vec2 u = f * f * (3.0 - 2.0 * f);

  return mix(mix(dot(random2(i + vec2(0.0,0.0)), f - vec2(0.0, 0.0)),
                     dot(random2(i + vec2(1.0,0.0)), f - vec2(1.0, 0.0)), u.x),
             mix(dot(random2(i + vec2(0.0,1.0)), f - vec2(0.0, 1.0)),
                 dot(random2(i + vec2(1.0,1.0)), f - vec2(1.0, 1.0)), u.x), u.y);
}`,simplexnoise:`float simplexnoise(vec2 v) {
  // Precompute values for skewed triangular grid
  const vec4 C = vec4(0.211324865405187,
                      // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,
                      // 0.5*(sqrt(3.0)-1.0)
                      -0.577350269189626,
                      // -1.0 + 2.0 * C.x
                      0.024390243902439);
                      // 1.0 / 41.0

  // First corner (x0)
  vec2 i  = floor(v + dot(v, C.yy));
  vec2 x0 = v - i + dot(i, C.xx);

  // Other two corners (x1, x2)
  vec2 i1 = vec2(0.0);
  i1 = (x0.x > x0.y)? vec2(1.0, 0.0):vec2(0.0, 1.0);
  vec2 x1 = x0.xy + C.xx - i1;
  vec2 x2 = x0.xy + C.zz;

  // Do some permutations to avoid
  // truncation effects in permutation
  i = mod289_2(i);
  vec3 p = permute(
          permute( i.y + vec3(0.0, i1.y, 1.0))
              + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(
                      dot(x0,x0),
                      dot(x1,x1),
                      dot(x2,x2)
                      ), 0.0);

  m = m*m ;
  m = m*m ;

  // Gradients:
  //  41 pts uniformly over a line, mapped onto a diamond
  //  The ring size 17*17 = 289 is close to a multiple
  //      of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

  // Normalise gradients implicitly by scaling m
  // Approximation of: m *= inversesqrt(a0*a0 + h*h);
  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0+h*h);

  // Compute final noise value at P
  vec3 g = vec3(0.0);
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * vec2(x1.x,x2.x) + h.yz * vec2(x1.y,x2.y);
  return 130.0 * dot(m, g);
}`,simplexhelpers:`vec3 mod289_3(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec2 mod289_2(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec3 permute(vec3 x) { return mod289_3(((x*34.0)+1.0)*x); }`,sobel:`vec4 sobel() {
  vec2 uv = gl_FragCoord.xy / uResolution;
  vec4 k[8];

  float w = 1. / uResolution.x;
  float h = 1. / uResolution.y;

  k[0] = texture2D(uSampler, uv + vec2(-w, -h));
  k[1] = texture2D(uSampler, uv + vec2(0., -h));
  k[2] = texture2D(uSampler, uv + vec2(w, -h));
  k[3] = texture2D(uSampler, uv + vec2(-w, 0.));

  k[4] = texture2D(uSampler, uv + vec2(w, 0.));
  k[5] = texture2D(uSampler, uv + vec2(-w, h));
  k[6] = texture2D(uSampler, uv + vec2(0., h));
  k[7] = texture2D(uSampler, uv + vec2(w, h));

  vec4 edge_h = k[2] + (2. * k[4]) + k[7] - (k[0] + (2. * k[3]) + k[5]);
  vec4 edge_v = k[0] + (2. * k[1]) + k[2] - (k[5] + (2. * k[6]) + k[7]);
  vec4 sob = sqrt(edge_h * edge_h + edge_v * edge_v);

  return vec4(1. - sob.rgb, 1.);
}`,monochrome:`vec4 monochrome(vec4 col) {
  return vec4(vec3((col.r + col.g + col.b) / 3.), col.a);
}`,invert:`vec4 invert(vec4 col) {
  return vec4(vec3(1., 1., 1.) - col.rgb, col.a);
}`,channel:`vec4 channel(vec2 uv, sampler2D sampler) {
  return texture2D(sampler, uv);
}`};Object.defineProperty(utils,"__esModule",{value:!0});utils.brandWithRegion=utils.brandWithChannel=utils.captureAndAppend=void 0;const glslfunctions_1$i=glslfunctions;function captureAndAppend(t,e,r){const o=t.match(e);if(o===null)throw new Error("no match in the given string");return t.replace(e,o[0]+r)}utils.captureAndAppend=captureAndAppend;function nameExtractor(t,e){const r=t.sections[0],o=r[r.length-1]===")"?")":"",n=r.substr(0,r.length-1-~~(o===")"))+e+"("+o;return{origFuncName:r,newFuncName:n,ending:o}}function brandWithChannel(t,e,r,o,n){if(n===void 0||n===-1?r.neighborSample=!0:r.extraBuffers=new Set([n]),n===void 0||n===-1)return;const{origFuncName:a,newFuncName:l,ending:u}=nameExtractor(t,n!==void 0?"_"+n:"");t.sections[0]=t.sections[0].split(a).join(l),e[o]=e[o].split(a).join(l).split("uSampler").join("uBufferSampler"+n)}utils.brandWithChannel=brandWithChannel;function brandWithRegion(t,e,r){if(!Array.isArray(r))return;const o=t.sourceLists,n=t.externalFuncs,a=t.needs;if(t.regionBranded||!a.neighborSample&&a.extraBuffers.size===0)return;const{origFuncName:l,newFuncName:u,ending:p}=nameExtractor(o,"_region"),h=u.substr(0,u.length-~~(p===")"))+"float r_x_min, float r_y_min, float r_x_max, float r_y_max"+(p===")"?")":", "),E="texture2D(",F="texture2D_region(r_x_min, r_y_min, r_x_max, r_y_max, ";n[e]=n[e].split(l).join(h).split(E).join(F),o.sections.shift(),p===")"&&o.sections.unshift(")");for(let x=0;x<4-~~(p===")");x++)o.sections.unshift(", ");o.sections.unshift(u.substr(0,u.length-~~(p===")"))),o.values.unshift(...r),n.unshift(glslfunctions_1$i.glslFuncs.texture2D_region),t.regionBranded=!0}utils.brandWithRegion=brandWithRegion;var hasRequiredExpr;function requireExpr(){if(hasRequiredExpr)return expr;hasRequiredExpr=1,Object.defineProperty(expr,"__esModule",{value:!0}),expr.tag=expr.wrapInValue=expr.pfloat=expr.Operator=expr.WrappedExpr=expr.ExprVec4=expr.ExprVec3=expr.ExprVec2=expr.float=expr.ExprFloat=expr.BasicFloat=expr.ExprVec=expr.BasicVec4=expr.BasicVec3=expr.BasicVec2=expr.BasicVec=expr.PrimitiveVec4=expr.PrimitiveVec3=expr.PrimitiveVec2=expr.PrimitiveVec=expr.PrimitiveFloat=expr.Primitive=expr.mut=expr.Mutable=expr.cvec4=expr.cvec3=expr.cvec2=expr.cfloat=expr.Expr=void 0;const t=requireMergepass(),e=webglprogramloop,r=utils;function o(S){let m=""+S;return m.includes(".")||(m+="."),m}class n{constructor(m,v){if(this.needs={neighborSample:!1,centerSample:!1,sceneBuffer:!1,timeUniform:!1,mouseUniform:!1,passCount:!1,extraBuffers:new Set},this.uniformValChangeMap={},this.defaultNameMap={},this.externalFuncs=[],this.sourceCode="",this.funcIndex=0,this.regionBranded=!1,this.id="_id_"+n.count,n.count++,m.sections.length-m.values.length!==1)throw new Error("wrong lengths for source and values");if(m.values.length!==v.length)throw console.log(m),console.log(v),new Error("default names list length doesn't match values list length");this.sourceLists=m,this.defaultNames=v}applyUniforms(m,v){for(const L in this.uniformValChangeMap){const G=v[L];this.uniformValChangeMap[L].changed&&this.uniformValChangeMap[L].val.applyUniform(m,G.locs[G.counter]),G.counter++,G.counter%=G.locs.length,G.counter===0&&(this.uniformValChangeMap[L].changed=!1)}}getSampleNum(m=1){return this.needs.neighborSample||this.sourceLists.values.map(v=>v.getSampleNum()).reduce((v,L)=>v+L,0)>0?m:0}setUniform(m,v){var L,G;v=N(v);const ae=m;if(typeof v=="number"&&(v=N(v)),!(v instanceof F))throw new Error("cannot set a non-primitive");((L=this.uniformValChangeMap[m])===null||L===void 0?void 0:L.val)===void 0&&(m=this.defaultNameMap[m]);const se=(G=this.uniformValChangeMap[m])===null||G===void 0?void 0:G.val;if(se===void 0)throw new Error("tried to set uniform "+m+" which doesn't exist. original name: "+ae);if(se.typeString()!==v.typeString())throw new Error("tried to set uniform "+m+" to a new type");this.uniformValChangeMap[m].val=v,this.uniformValChangeMap[m].changed=!0}parse(m){this.sourceCode="",m.exprs.push(this),m.needs=e.updateNeeds(m.needs,this.needs),this.externalFuncs.forEach(v=>m.externalFuncs.add(v));for(let v=0;v<this.sourceLists.values.length;v++)this.sourceCode+=this.sourceLists.sections[v]+this.sourceLists.values[v].parse(m,this.defaultNames[v],this);return this.sourceCode+=this.sourceLists.sections[this.sourceLists.sections.length-1],this.sourceCode}addFuncs(m){return this.externalFuncs.push(...m),this}brandExprWithChannel(m,v){return r.brandWithChannel(this.sourceLists,this.externalFuncs,this.needs,m,v),this}brandExprWithRegion(m){r.brandWithRegion(this,this.funcIndex,m);for(const v of this.sourceLists.values)v.brandExprWithRegion(m);return this}}expr.Expr=n,n.count=0;function a(S){const m=[];for(let v=0;v<S.values.length;v++)m.push("uCustomName"+v);return m}function l(S,m=[]){return new R(S,a(S)).addFuncs(m)}expr.cfloat=l;function u(S,m=[]){return new k(S,a(S)).addFuncs(m)}expr.cvec2=u;function p(S,m=[]){return new q(S,a(S)).addFuncs(m)}expr.cvec3=p;function f(S,m=[]){return new O(S,a(S)).addFuncs(m)}expr.cvec4=f;class h{constructor(m,v){this.primitive=m,this.name=v}parse(m,v,L){if(L===void 0)throw new Error("tried to put a mutable expression at the top level");return this.name===void 0&&(this.name=v+L.id),m.uniformTypes[this.name]=this.primitive.typeString(),L.uniformValChangeMap[this.name]={val:this.primitive,changed:!0},L.defaultNameMap[v+L.id]=this.name,this.name}applyUniform(m,v){this.primitive.applyUniform(m,v)}typeString(){return this.primitive.typeString()}getSampleNum(){return 0}brandExprWithRegion(m){return this}}expr.Mutable=h;function E(S,m){const v=typeof S=="number"?N(S):S;return new h(v,m)}expr.mut=E;class F{parse(){return this.toString()}getSampleNum(){return 0}brandExprWithRegion(m){return this}}expr.Primitive=F;class x extends F{constructor(m){if(!isFinite(m))throw new Error("number not finite");super(),this.value=m}toString(){let m=""+this.value;return m.includes(".")||(m+="."),m}typeString(){return"float"}applyUniform(m,v){m.uniform1f(v,this.value)}}expr.PrimitiveFloat=x;class b extends F{constructor(m){super(),this.values=m}typeString(){return"vec"+this.values.length}toString(){return`${this.typeString()}(${this.values.map(m=>o(m)).join(", ")})`}}expr.PrimitiveVec=b;class M extends b{applyUniform(m,v){m.uniform2f(v,this.values[0],this.values[1])}}expr.PrimitiveVec2=M;class U extends b{applyUniform(m,v){m.uniform3f(v,this.values[0],this.values[1],this.values[2])}}expr.PrimitiveVec3=U;class I extends b{applyUniform(m,v){m.uniform4f(v,this.values[0],this.values[1],this.values[2],this.values[3])}}expr.PrimitiveVec4=I;class y extends n{constructor(m,v){super(m,v);const L=m.values;this.values=L,this.defaultNames=v}typeString(){return"vec"+this.values.length}setComp(m,v){if(m<0||m>=this.values.length)throw new Error("out of bounds of setting component");this.setUniform(this.defaultNames[m]+this.id,N(v))}}expr.BasicVec=y;class d extends y{constructor(){super(...arguments),this.bvec2=void 0}}expr.BasicVec2=d;class C extends y{constructor(){super(...arguments),this.bvec3=void 0}}expr.BasicVec3=C;class B extends y{constructor(){super(...arguments),this.bvec4=void 0}}expr.BasicVec4=B;class T extends n{constructor(m,v){super(m,v);const L=m.values;this.values=L,this.defaultNames=v}}expr.ExprVec=T;class V extends n{constructor(m,v){super(m,v),this.float=void 0}setVal(m){this.setUniform("uFloat"+this.id,N(m))}typeString(){return"float"}}expr.BasicFloat=V;class R extends n{constructor(m,v){super(m,v),this.float=void 0}setVal(m){this.setUniform("uFloat"+this.id,N(m))}typeString(){return"float"}}expr.ExprFloat=R;function D(S){return typeof S=="number"&&(S=N(S)),new V({sections:["",""],values:[S]},["uFloat"])}expr.float=D;class k extends T{constructor(){super(...arguments),this.vec2=void 0}typeString(){return"vec2"}}expr.ExprVec2=k;class q extends T{constructor(){super(...arguments),this.vec3=void 0}typeString(){return"vec3"}}expr.ExprVec3=q;class O extends T{constructor(){super(...arguments),this.vec4=void 0}repeat(m){return new t.EffectLoop([this],{num:m})}genPrograms(m,v,L,G){return new t.EffectLoop([this],{num:1}).genPrograms(m,v,L,G)}typeString(){return"vec4"}}expr.ExprVec4=O;class H{constructor(m){this.expr=m}typeString(){return this.expr.typeString()}parse(m,v,L){return this.expr.parse(m,v,L)}getSampleNum(){return this.expr.getSampleNum()}brandExprWithRegion(m){return this.expr.brandExprWithRegion(m)}}expr.WrappedExpr=H;class W extends n{constructor(m,v,L){super(v,L),this.ret=m}typeString(){return this.ret.typeString()}}expr.Operator=W;function Q(S){return new x(S)}expr.pfloat=Q;function N(S){if(S!==void 0)return typeof S=="number"?Q(S):S}expr.wrapInValue=N;function Y(S,...m){return{sections:S.concat([]),values:m}}return expr.tag=Y,expr}var hasRequiredCodebuilder;function requireCodebuilder(){if(hasRequiredCodebuilder)return codebuilder;hasRequiredCodebuilder=1,Object.defineProperty(codebuilder,"__esModule",{value:!0}),codebuilder.CodeBuilder=codebuilder.channelSamplerName=void 0;const t=requireExpr(),e=webglprogramloop,r=settings,o=`  gl_FragColor = texture2D(uSampler, gl_FragCoord.xy / uResolution);
`,n=`uniform sampler2D uSceneSampler;
`,a=`uniform mediump float uTime;
`,l=`uniform mediump vec2 uMouse;
`,u=`uniform int uCount;
`,p=`#ifdef GL_ES
precision mediump float;
#endif

uniform sampler2D uSampler;
uniform mediump vec2 uResolution;
`;function f(F){return F===-1?"uSampler":`uBufferSampler${F}`}codebuilder.channelSamplerName=f;function h(F){return`uniform sampler2D ${f(F)};`}class E{constructor(x){this.calls=[],this.externalFuncs=new Set,this.uniformDeclarations=new Set,this.counter=0,this.baseLoop=x;const b={uniformTypes:{},externalFuncs:new Set,exprs:[],needs:{centerSample:!1,neighborSample:!1,sceneBuffer:!1,timeUniform:!1,mouseUniform:!1,passCount:!1,extraBuffers:new Set}};this.addEffectLoop(x,1,b);for(const M in b.uniformTypes){const U=b.uniformTypes[M];this.uniformDeclarations.add(`uniform mediump ${U} ${M};`)}b.externalFuncs.forEach(M=>this.externalFuncs.add(M)),this.totalNeeds=b.needs,this.exprs=b.exprs}addEffectLoop(x,b,M,U=!0){const I=!U&&x.loopInfo.num>1;if(I){const y="i"+this.counter;b++;const d="  ".repeat(b-1)+`for (int ${y} = 0; ${y} < ${x.loopInfo.num}; ${y}++) {`;this.calls.push(d)}for(const y of x.effects)y instanceof t.Expr?(y.parse(M),this.calls.push("  ".repeat(b)+"gl_FragColor = "+y.sourceCode+";"),this.counter++):this.addEffectLoop(y,b,M,!1);I&&this.calls.push("  ".repeat(b-1)+"}")}compileProgram(x,b,M,U=[]){const I=x.createShader(x.FRAGMENT_SHADER);if(I===null)throw new Error("problem creating fragment shader");const y=p+(this.totalNeeds.sceneBuffer?n:"")+(this.totalNeeds.timeUniform?a:"")+(this.totalNeeds.mouseUniform?l:"")+(this.totalNeeds.passCount?u:"")+Array.from(this.totalNeeds.extraBuffers).map(V=>h(V)).join(`
`)+`
`+[...this.uniformDeclarations].join(`
`)+`
`+[...this.externalFuncs].join(`
`)+`
void main() {
`+(this.totalNeeds.centerSample?o:"")+this.calls.join(`
`)+`
}`;r.settings.verbosity>0&&console.log(y),x.shaderSource(I,y),x.compileShader(I);const d=x.createProgram();if(d===null)throw new Error("problem creating program");x.attachShader(d,b),x.attachShader(d,I),U.push(I);const C=(V,R)=>{const D=x.getShaderInfoLog(R);D&&console.log(`${V} shader info log
${D}`)};C("vertex",b),C("fragment",I),x.linkProgram(d),x.useProgram(d);for(const V of this.exprs)for(const R in V.uniformValChangeMap){const D=x.getUniformLocation(d,R);if(D===null)throw new Error("couldn't find uniform "+R);M[R]===void 0&&(M[R]={locs:[],counter:0}),M[R].locs.push(D)}const B=x.getUniformLocation(d,"uResolution");if(x.uniform2f(B,x.drawingBufferWidth,x.drawingBufferHeight),this.totalNeeds.sceneBuffer){const V=x.getUniformLocation(d,"uSceneSampler");x.uniform1i(V,1+r.settings.offset)}for(const V of this.totalNeeds.extraBuffers){const R=x.getUniformLocation(d,f(V));x.uniform1i(R,V+2+r.settings.offset)}if(r.settings.offset!==0){const V=x.getUniformLocation(d,"uSampler");x.uniform1i(V,r.settings.offset)}const T=x.getAttribLocation(d,"aPosition");return x.enableVertexAttribArray(T),x.vertexAttribPointer(T,2,x.FLOAT,!1,0,0),new e.WebGLProgramLoop(new e.WebGLProgramLeaf(d,this.totalNeeds,this.exprs),this.baseLoop.loopInfo,x)}}return codebuilder.CodeBuilder=E,codebuilder}var fragcolorexpr={},hasRequiredFragcolorexpr;function requireFragcolorexpr(){if(hasRequiredFragcolorexpr)return fragcolorexpr;hasRequiredFragcolorexpr=1,Object.defineProperty(fragcolorexpr,"__esModule",{value:!0}),fragcolorexpr.fcolor=fragcolorexpr.FragColorExpr=void 0;const t=requireExpr();class e extends t.ExprVec4{constructor(){super(t.tag`gl_FragColor`,[]),this.needs.centerSample=!0}}fragcolorexpr.FragColorExpr=e;function r(){return new e}return fragcolorexpr.fcolor=r,fragcolorexpr}var regiondecorator={},getcompexpr={},hasRequiredGetcompexpr;function requireGetcompexpr(){if(hasRequiredGetcompexpr)return getcompexpr;hasRequiredGetcompexpr=1,Object.defineProperty(getcompexpr,"__esModule",{value:!0}),getcompexpr.get4comp=getcompexpr.get3comp=getcompexpr.get2comp=getcompexpr.getcomp=getcompexpr.Get4CompExpr=getcompexpr.Get3CompExpr=getcompexpr.Get2CompExpr=getcompexpr.GetCompExpr=getcompexpr.checkLegalComponents=getcompexpr.typeStringToLength=void 0;const t=requireExpr();function e(x){switch(x){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4}}getcompexpr.typeStringToLength=e;function r(x,b){return{sections:["","."+b],values:[x]}}function o(x,b){const M=(C,B)=>{let T=0,V=0;for(const R of C)B.includes(R)?T++:V++;return T===T&&!V},U=e(b.typeString()),I=M(x,"rgba".substr(0,U)),y=M(x,"xyzw".substr(0,U)),d=M(x,"stpq".substr(0,U));if(!(I||y||d))throw new Error("component sets are mixed or incorrect entirely")}getcompexpr.checkLegalComponents=o;function n(x,b,M){if(x.length>b)throw new Error("too many components");o(x,M)}class a extends t.ExprFloat{constructor(b,M){n(M,1,b),super(r(b,M),["uVec1Min"]),this.vec1Min=b}setVec(b){this.setUniform("uVec1Min",b),this.vec1Min=b}}getcompexpr.GetCompExpr=a;class l extends t.ExprVec2{constructor(b,M){n(M,2,b),super(r(b,M),["uVec2Min"]),this.vec2Min=b}setVec(b){this.setUniform("uVec2Min",b),this.vec2Min=b}}getcompexpr.Get2CompExpr=l;class u extends t.ExprVec3{constructor(b,M){n(M,3,b),super(r(b,M),["uVec3Min"]),this.vec3Min=b}setVec(b){this.setUniform("uVec3Min",b),this.vec3Min=b}}getcompexpr.Get3CompExpr=u;class p extends t.ExprVec4{constructor(b,M){n(M,4,b),super(r(b,M),["uVec4Min"]),this.vec4Min=b}setVec(b){this.setUniform("uVec4Min",b),this.vec4Min=b}}getcompexpr.Get4CompExpr=p;function f(x,b){return new a(x,b)}getcompexpr.getcomp=f;function h(x,b){return new l(x,b)}getcompexpr.get2comp=h;function E(x,b){return new u(x,b)}getcompexpr.get3comp=E;function F(x,b){return new p(x,b)}return getcompexpr.get4comp=F,getcompexpr}var normfragcoordexpr={},hasRequiredNormfragcoordexpr;function requireNormfragcoordexpr(){if(hasRequiredNormfragcoordexpr)return normfragcoordexpr;hasRequiredNormfragcoordexpr=1,Object.defineProperty(normfragcoordexpr,"__esModule",{value:!0}),normfragcoordexpr.pos=normfragcoordexpr.NormFragCoordExpr=void 0;const t=requireExpr();class e extends t.ExprVec2{constructor(){super(t.tag`(gl_FragCoord.xy / uResolution)`,[])}}normfragcoordexpr.NormFragCoordExpr=e;function r(){return new e}return normfragcoordexpr.pos=r,normfragcoordexpr}var opexpr={},hasRequiredOpexpr;function requireOpexpr(){if(hasRequiredOpexpr)return opexpr;hasRequiredOpexpr=1,Object.defineProperty(opexpr,"__esModule",{value:!0}),opexpr.op=opexpr.OpExpr=void 0;const t=requireExpr();function e(n,a,l){return{sections:["(",` ${a} `,")"],values:[n,l]}}class r extends t.Operator{constructor(a,l,u){super(a,e(a,l,u),["uLeft","uRight"]),this.left=a,this.right=u}setLeft(a){this.setUniform("uLeft"+this.id,a),this.left=t.wrapInValue(a)}setRight(a){this.setUniform("uRight"+this.id,a),this.right=t.wrapInValue(a)}}opexpr.OpExpr=r;function o(n,a,l){return new r(t.wrapInValue(n),a,t.wrapInValue(l))}return opexpr.op=o,opexpr}var ternaryexpr={},hasRequiredTernaryexpr;function requireTernaryexpr(){if(hasRequiredTernaryexpr)return ternaryexpr;hasRequiredTernaryexpr=1,Object.defineProperty(ternaryexpr,"__esModule",{value:!0}),ternaryexpr.ternary=ternaryexpr.TernaryExpr=void 0;const t=requireExpr();function e(n,a,l,u){const p={sections:[`(${u?"!":""}(`],values:[]};let f=0;if(n!==null)for(const h of n){f++;const E=f===n.length;p.values.push(h),p.sections.push(` > 0.${E?") ? ":" && "}`)}else p.sections[0]+="uCount == 0) ? ";return p.values.push(a),p.sections.push(" : "),p.values.push(l),p.sections.push(")"),p}class r extends t.Operator{constructor(a,l,u,p){super(l,e(a,l,u,p),[...a!==null?Array.from(a,(f,h)=>"uFloat"+h):[],"uSuccess","uFailure"]),this.success=l,this.failure=u,this.needs.passCount=a===null}}ternaryexpr.TernaryExpr=r;function o(n,a,l,u=!1){return!Array.isArray(n)&&n!==null&&(n=[n].map(p=>t.wrapInValue(p))),new r(n,t.wrapInValue(a),t.wrapInValue(l),u)}return ternaryexpr.ternary=o,ternaryexpr}var hasRequiredRegiondecorator;function requireRegiondecorator(){if(hasRequiredRegiondecorator)return regiondecorator;hasRequiredRegiondecorator=1,Object.defineProperty(regiondecorator,"__esModule",{value:!0}),regiondecorator.region=void 0;const t=requireMergepass(),e=requireExpr(),r=requireGetcompexpr(),o=requireNormfragcoordexpr(),n=requireOpexpr(),a=requireTernaryexpr(),l=requireFragcolorexpr();function u(f){const h="xy",E=[];if(f.length!==4)throw new Error("incorrect amount of points specified for region");for(let F=0;F<2;F++)E.push(n.op(r.getcomp(o.pos(),h[F]),"-",f[F]));for(let F=2;F<f.length;F++)E.push(n.op(f[F],"-",r.getcomp(o.pos(),h[F-2])));return E}function p(f,h,E,F=!1){const x=Array.isArray(f)?f.map(b=>e.wrapInValue(b)):typeof f=="number"?e.wrapInValue(f):f;return E instanceof t.EffectLoop&&(h instanceof t.EffectLoop||([h,E]=[E,h],F=!F)),h instanceof t.EffectLoop?E instanceof t.EffectLoop?t.loop([h.regionWrap(x,l.fcolor(),!1,F),E.regionWrap(x,l.fcolor(),!0,!F)]):h.regionWrap(x,E,!0,F):a.ternary(Array.isArray(x)?u(x):x,h.brandExprWithRegion(x),E.brandExprWithRegion(x),F)}return regiondecorator.region=p,regiondecorator}var scenesampleexpr={},hasRequiredScenesampleexpr;function requireScenesampleexpr(){if(hasRequiredScenesampleexpr)return scenesampleexpr;hasRequiredScenesampleexpr=1,Object.defineProperty(scenesampleexpr,"__esModule",{value:!0}),scenesampleexpr.input=scenesampleexpr.SceneSampleExpr=void 0;const t=requireExpr(),e=requireNormfragcoordexpr();class r extends t.ExprVec4{constructor(a=e.pos()){super(t.tag`texture2D(uSceneSampler, ${a})`,["uCoord"]),this.coord=a,this.needs.sceneBuffer=!0}setCoord(a){this.setUniform("uCoord",a),this.coord=a}}scenesampleexpr.SceneSampleExpr=r;function o(n){return new r(n)}return scenesampleexpr.input=o,scenesampleexpr}var setcolorexpr={},hasRequiredSetcolorexpr;function requireSetcolorexpr(){if(hasRequiredSetcolorexpr)return setcolorexpr;hasRequiredSetcolorexpr=1,Object.defineProperty(setcolorexpr,"__esModule",{value:!0}),setcolorexpr.SetColorExpr=void 0;const t=requireExpr();class e extends t.ExprVec4{constructor(o){super(t.tag`(${o})`,["uVal"]),this.vec=o}}return setcolorexpr.SetColorExpr=e,setcolorexpr}var hasRequiredMergepass;function requireMergepass(){if(hasRequiredMergepass)return mergepass;hasRequiredMergepass=1,Object.defineProperty(mergepass,"__esModule",{value:!0}),mergepass.sendTexture=mergepass.makeTexture=mergepass.Merger=mergepass.loop=mergepass.EffectLoop=mergepass.EffectDictionary=void 0;const t=requireCodebuilder(),e=requireExpr(),r=requireFragcolorexpr(),o=requireRegiondecorator(),n=requireScenesampleexpr(),a=requireSetcolorexpr(),l=requireTernaryexpr(),u=settings,p=webglprogramloop;function f(y){return y.map(d=>d instanceof e.ExprVec4||d instanceof F?d:new a.SetColorExpr(d))}function h(y){const d={};for(const C in y){const B=y[C];d[C]=f(B)}return d}class E{constructor(d){this.effectMap=h(d)}toProgramMap(d,C,B,T){const V={};let R={neighborSample:!1,centerSample:!1,sceneBuffer:!1,timeUniform:!1,mouseUniform:!1,passCount:!1,extraBuffers:new Set};for(const D in this.effectMap){const k=this.effectMap[D],q=new F(k,{num:1});if(q.effects.length===0)throw new Error("list of effects was empty");const O=q.genPrograms(d,C,B,T);let H=!1,W=O;for(;!H;)W.programElement instanceof p.WebGLProgramLeaf?(W.last=!0,H=!0):W=W.programElement[W.programElement.length-1];R=p.updateNeeds(R,O.getTotalNeeds()),V[D]=O}return{programMap:V,needs:R}}}mergepass.EffectDictionary=E;class F{constructor(d,C){this.effects=f(d),this.loopInfo=C}getSampleNum(d=1,C=0,B=this.effects.length){d*=this.loopInfo.num;let T=0;const V=this.effects.slice(C,B);for(const R of V)T+=R.getSampleNum(d);return T}regroup(){let d=0,C=0,B=[];const T=[];let V,R,D=0;const k=()=>{D--,B.length>0&&(B.length===1?T.push(B[0]):T.push(new F(B,{num:1})),d-=C,B=[])};for(const q of this.effects){const O=q.getSampleNum();C=d,d+=O,q instanceof F?(R=q.loopInfo.target,q.hasTargetSwitch()&&(D=2)):R=this.loopInfo.target,(d>0||R!==V||D>0)&&k(),B.push(q),V=R}return k(),T}genPrograms(d,C,B,T){const V=this.getSampleNum()/this.loopInfo.num,R=this.getSampleNum(void 0,0,1)/this.loopInfo.num,D=this.getSampleNum(void 0,1)/this.loopInfo.num;return!this.hasTargetSwitch()&&(V===0||R===1&&D===0)?new t.CodeBuilder(this).compileProgram(d,C,B,T):(this.effects=this.regroup(),new p.WebGLProgramLoop(this.effects.map(k=>k.genPrograms(d,C,B,T)),this.loopInfo,d))}target(d){return this.loopInfo.target=d,this}hasTargetSwitch(){for(const d of this.effects)if(d instanceof F&&(d.loopInfo.target!==this.loopInfo.target||d.hasTargetSwitch()))return!0;return!1}regionWrap(d,C,B=!0,T){return this.effects=this.effects.map((V,R)=>V instanceof F?V.regionWrap(d,C,R===this.effects.length-1,T):new a.SetColorExpr(o.region(d,V.brandExprWithRegion(d),R===this.effects.length-1&&B?C instanceof r.FragColorExpr?C:l.ternary(null,C,r.fcolor()):r.fcolor(),T))),this}}mergepass.EffectLoop=F;function x(y,d=1){return new F(y,{num:d})}mergepass.loop=x;const b=`attribute vec2 aPosition;
void main() {
  gl_Position = vec4(aPosition, 0.0, 1.0);
}
`;class M{constructor(d,C,B,T){if(this.uniformLocs={},this.channels=[],this.fShaders=[],this.textureMode=C instanceof WebGLTexture,(T==null?void 0:T.channels)!==void 0&&(this.channels=T==null?void 0:T.channels),d instanceof E||(d=new E({default:d})),this.textureMode){u.settings.verbosity>1&&console.log("we are in texture mode!");for(const N in d.effectMap)d.effectMap[N].unshift(x([n.input()]).target(-1))}this.source=C,this.gl=B,this.options=T,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const V=this.gl.createBuffer();if(V===null)throw new Error("problem creating vertex buffer");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,V);const R=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],D=new Float32Array(R);this.gl.bufferData(this.gl.ARRAY_BUFFER,D,this.gl.STATIC_DRAW),this.vertexBuffer=V;const k=this.gl.createShader(this.gl.VERTEX_SHADER);if(k===null)throw new Error("problem creating the vertex shader");this.vShader=k,this.gl.shaderSource(k,b),this.gl.compileShader(k),this.tex={back:{name:"orig_back",tex:C instanceof WebGLTexture?C:U(this.gl,this.options)},front:{name:"orig_front",tex:U(this.gl,this.options)},scene:void 0,bufTextures:[]};const q=B.createFramebuffer();if(q===null)throw new Error("problem creating the framebuffer");this.framebuffer=q;const{programMap:O,needs:H}=d.toProgramMap(this.gl,this.vShader,this.uniformLocs,this.fShaders);if(this.programMap=O,(H.sceneBuffer||this.textureMode)&&(this.tex.scene={name:"scene",tex:U(this.gl,this.options)}),O.default===void 0)throw new Error("no default program");this.programLoop=O.default;const W=Math.max(...H.extraBuffers)+1,Q=this.channels.length;if(W>Q)throw new Error("not enough channels supplied for this effect");for(let N=0;N<this.channels.length;N++){const Y=this.channels[N];if(Y instanceof WebGLTexture)this.tex.bufTextures.push({name:"img_channel_"+N,tex:Y});else{const S=U(this.gl,this.options);this.tex.bufTextures.push({name:"tex_channel_"+N,tex:S})}}u.settings.verbosity>0&&(console.log(d),console.log(this.programMap))}draw(d=0,C=0,B=0){this.gl.activeTexture(this.gl.TEXTURE0+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex.back.tex),I(this.gl,this.source),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.programLoop.getTotalNeeds().sceneBuffer&&this.tex.scene!==void 0&&(this.gl.activeTexture(this.gl.TEXTURE1+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex.scene.tex),I(this.gl,this.source),this.gl.bindTexture(this.gl.TEXTURE_2D,null));let T=0;for(const V of this.channels)this.gl.activeTexture(this.gl.TEXTURE2+T+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex.bufTextures[T].tex),I(this.gl,V),this.gl.bindTexture(this.gl.TEXTURE_2D,null),T++;this.programLoop.run(this.gl,this.tex,this.framebuffer,this.uniformLocs,this.programLoop.last,{timeVal:d,mouseX:C,mouseY:B})}delete(){for(let d=0;d<2+this.tex.bufTextures.length;d++)this.gl.activeTexture(this.gl.TEXTURE0+d+u.settings.offset),this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.programLoop.delete(this.gl),this.gl.deleteTexture(this.tex.front.tex),this.gl.deleteTexture(this.tex.back.tex);for(const d of this.tex.bufTextures)this.gl.deleteTexture(d.tex);this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.vShader);for(const d of this.fShaders)this.gl.deleteShader(d)}changeProgram(d){if(this.programMap[d]===void 0)throw new Error(`program "${d}" doesn't exist on this merger`);this.programLoop=this.programMap[d]}}mergepass.Merger=M;function U(y,d){const C=y.createTexture();if(C===null)throw new Error("problem creating texture");y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0),y.bindTexture(y.TEXTURE_2D,C),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.drawingBufferWidth,y.drawingBufferHeight,0,y.RGBA,y.UNSIGNED_BYTE,null);const B=T=>T===void 0||T==="linear"?y.LINEAR:y.NEAREST;return y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,B(d==null?void 0:d.minFilterMode)),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,B(d==null?void 0:d.maxFilterMode)),(d==null?void 0:d.edgeMode)!=="wrap"&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE)),C}mergepass.makeTexture=U;function I(y,d){d instanceof WebGLTexture||d===null||y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,d)}return mergepass.sendTexture=I,mergepass}var exprtypes={};Object.defineProperty(exprtypes,"__esModule",{value:!0});var blurexpr={};Object.defineProperty(blurexpr,"__esModule",{value:!0});blurexpr.gauss=blurexpr.BlurExpr=void 0;const glslfunctions_1$h=glslfunctions,expr_1$C=requireExpr();function genBlurSource(t,e){return{sections:[`gauss${e}(`,")"],values:[t]}}function tapsToFuncSource(t){switch(t){case 5:return glslfunctions_1$h.glslFuncs.gauss5;case 9:return glslfunctions_1$h.glslFuncs.gauss9;case 13:return glslfunctions_1$h.glslFuncs.gauss13}}class BlurExpr extends expr_1$C.ExprVec4{constructor(e,r=5,o){if(![5,9,13].includes(r))throw new Error("taps for gauss blur can only be 5, 9 or 13");super(genBlurSource(e,r),["uDirection"]),this.direction=e,this.externalFuncs=[tapsToFuncSource(r)],this.brandExprWithChannel(0,o)}setDirection(e){this.setUniform("uDirection"+this.id,e),this.direction=e}}blurexpr.BlurExpr=BlurExpr;function gauss(t,e=5,r){return new BlurExpr(t,e,r)}blurexpr.gauss=gauss;var vecexprs={};Object.defineProperty(vecexprs,"__esModule",{value:!0});vecexprs.pvec4=vecexprs.pvec3=vecexprs.pvec2=vecexprs.vec4=vecexprs.vec3=vecexprs.vec2=void 0;const expr_1$B=requireExpr();function vecSourceList(...t){const e=["vec"+t.length+"("];for(let o=0;o<t.length-1;o++)e.push(", ");const r=[];for(let o=0;o<t.length;o++)r.push("uComp"+o);return e.push(")"),[{sections:e,values:t},r]}function vec2(t,e){return new expr_1$B.BasicVec2(...vecSourceList(...[t,e].map(r=>expr_1$B.wrapInValue(r))))}vecexprs.vec2=vec2;function vec3(t,e,r){return new expr_1$B.BasicVec3(...vecSourceList(...[t,e,r].map(o=>expr_1$B.wrapInValue(o))))}vecexprs.vec3=vec3;function vec4(t,e,r,o){return new expr_1$B.BasicVec4(...vecSourceList(...[t,e,r,o].map(n=>expr_1$B.wrapInValue(n))))}vecexprs.vec4=vec4;function pvec2(t,e){return new expr_1$B.PrimitiveVec2([t,e])}vecexprs.pvec2=pvec2;function pvec3(t,e,r){return new expr_1$B.PrimitiveVec3([t,e,r])}vecexprs.pvec3=pvec3;function pvec4(t,e,r,o){return new expr_1$B.PrimitiveVec4([t,e,r,o])}vecexprs.pvec4=pvec4;var powerblur={};Object.defineProperty(powerblur,"__esModule",{value:!0});powerblur.pblur=powerblur.PowerBlurLoop=void 0;const mergepass_1$4=requireMergepass(),blurexpr_1$3=blurexpr,vecexprs_1$6=vecexprs,expr_1$A=requireExpr(),baseLog=(t,e)=>Math.log(e)/Math.log(t);class PowerBlurLoop extends mergepass_1$4.EffectLoop{constructor(e){const r=blurexpr_1$3.gauss(expr_1$A.mut(vecexprs_1$6.pvec2(e,0))),o=blurexpr_1$3.gauss(expr_1$A.mut(vecexprs_1$6.pvec2(0,e))),n=Math.ceil(baseLog(2,e));super([r,o],{num:n+1}),this.size=e,this.loopInfo.func=a=>{const l=this.size/Math.pow(2,a);o.setDirection(vecexprs_1$6.pvec2(0,l)),r.setDirection(vecexprs_1$6.pvec2(l,0))}}setSize(e){this.size=e,this.loopInfo.num=Math.ceil(baseLog(2,e))}}powerblur.PowerBlurLoop=PowerBlurLoop;function pblur(t){return new PowerBlurLoop(t)}powerblur.pblur=pblur;var blur2dloop={};Object.defineProperty(blur2dloop,"__esModule",{value:!0});blur2dloop.blur2d=blur2dloop.Blur2dLoop=void 0;const mergepass_1$3=requireMergepass(),blurexpr_1$2=blurexpr,expr_1$z=requireExpr(),vecexprs_1$5=vecexprs;class Blur2dLoop extends mergepass_1$3.EffectLoop{constructor(e=expr_1$z.float(expr_1$z.mut(1)),r=expr_1$z.float(expr_1$z.mut(1)),o=2,n,a){const l=blurexpr_1$2.gauss(vecexprs_1$5.vec2(e,0),n,a),u=blurexpr_1$2.gauss(vecexprs_1$5.vec2(0,r),n,a);super([l,u],{num:o}),this.horizontal=e,this.vertical=r}setHorizontal(e){if(!(this.horizontal instanceof expr_1$z.BasicFloat))throw new Error("horizontal expression not basic float");this.horizontal.setVal(e)}setVertical(e){if(!(this.vertical instanceof expr_1$z.BasicFloat))throw new Error("vertical expression not basic float");this.vertical.setVal(e)}}blur2dloop.Blur2dLoop=Blur2dLoop;function blur2d(t,e,r,o,n){return new Blur2dLoop(expr_1$z.wrapInValue(t),expr_1$z.wrapInValue(e),r,o,n)}blur2dloop.blur2d=blur2d;var lenexpr={};Object.defineProperty(lenexpr,"__esModule",{value:!0});lenexpr.len=lenexpr.LenExpr=void 0;const expr_1$y=requireExpr();class LenExpr extends expr_1$y.ExprFloat{constructor(e){super(expr_1$y.tag`length(${e})`,["uVec"]),this.vec=e}setVec(e){this.setUniform("uVec"+this.id,e),this.vec=e}}lenexpr.LenExpr=LenExpr;function len(t){return new LenExpr(t)}lenexpr.len=len;var normexpr={};Object.defineProperty(normexpr,"__esModule",{value:!0});normexpr.norm=normexpr.NormExpr=void 0;const expr_1$x=requireExpr();class NormExpr extends expr_1$x.Operator{constructor(e){super(e,expr_1$x.tag`normalize(${e})`,["uVec"]),this.vec=e}setVec(e){this.setUniform("uVec"+this.id,e),this.vec=e}}normexpr.NormExpr=NormExpr;function norm(t){return new NormExpr(t)}normexpr.norm=norm;var fragcoordexpr={};Object.defineProperty(fragcoordexpr,"__esModule",{value:!0});fragcoordexpr.pixel=fragcoordexpr.FragCoordExpr=void 0;const expr_1$w=requireExpr();class FragCoordExpr extends expr_1$w.ExprVec2{constructor(){super(expr_1$w.tag`gl_FragCoord.xy`,[])}}fragcoordexpr.FragCoordExpr=FragCoordExpr;function pixel(){return new FragCoordExpr}fragcoordexpr.pixel=pixel;var normcenterfragcoordexpr={};Object.defineProperty(normcenterfragcoordexpr,"__esModule",{value:!0});normcenterfragcoordexpr.center=normcenterfragcoordexpr.NormCenterFragCoordExpr=void 0;const expr_1$v=requireExpr();class NormCenterFragCoordExpr extends expr_1$v.ExprVec2{constructor(){super(expr_1$v.tag`(gl_FragCoord.xy / uResolution - 0.5)`,[])}}normcenterfragcoordexpr.NormCenterFragCoordExpr=NormCenterFragCoordExpr;function center(){return new NormCenterFragCoordExpr}normcenterfragcoordexpr.center=center;var brightnessexpr={};Object.defineProperty(brightnessexpr,"__esModule",{value:!0});brightnessexpr.brightness=brightnessexpr.Brightness=void 0;const glslfunctions_1$g=glslfunctions,expr_1$u=requireExpr(),fragcolorexpr_1$5=requireFragcolorexpr();class Brightness extends expr_1$u.ExprVec4{constructor(e,r=fragcolorexpr_1$5.fcolor()){super(expr_1$u.tag`brightness(${e}, ${r})`,["uBrightness","uColor"]),this.brightness=e,this.externalFuncs=[glslfunctions_1$g.glslFuncs.brightness]}setBrightness(e){this.setUniform("uBrightness"+this.id,e),this.brightness=expr_1$u.wrapInValue(e)}}brightnessexpr.Brightness=Brightness;function brightness(t,e){return new Brightness(expr_1$u.wrapInValue(t),e)}brightnessexpr.brightness=brightness;var contrastexpr={};Object.defineProperty(contrastexpr,"__esModule",{value:!0});contrastexpr.contrast=contrastexpr.ContrastExpr=void 0;const glslfunctions_1$f=glslfunctions,expr_1$t=requireExpr(),fragcolorexpr_1$4=requireFragcolorexpr();class ContrastExpr extends expr_1$t.ExprVec4{constructor(e,r=fragcolorexpr_1$4.fcolor()){super(expr_1$t.tag`contrast(${e}, ${r})`,["uVal","uCol"]),this.contrast=e,this.externalFuncs=[glslfunctions_1$f.glslFuncs.contrast]}setContrast(e){this.setUniform("uContrast"+this.id,e),this.contrast=expr_1$t.wrapInValue(e)}}contrastexpr.ContrastExpr=ContrastExpr;function contrast(t,e){return new ContrastExpr(expr_1$t.wrapInValue(t),e)}contrastexpr.contrast=contrast;var grainexpr={};Object.defineProperty(grainexpr,"__esModule",{value:!0});grainexpr.grain=grainexpr.GrainExpr=void 0;const glslfunctions_1$e=glslfunctions,expr_1$s=requireExpr();class GrainExpr extends expr_1$s.ExprVec4{constructor(e){super(expr_1$s.tag`vec4((1.0 - ${e} * random(gl_FragCoord.xy)) * gl_FragColor.rgb, gl_FragColor.a);`,["uGrain"]),this.grain=e,this.externalFuncs=[glslfunctions_1$e.glslFuncs.random],this.needs.centerSample=!0}setGrain(e){this.setUniform("uGrain"+this.id,e),this.grain=expr_1$s.wrapInValue(e)}}grainexpr.GrainExpr=GrainExpr;function grain(t){return new GrainExpr(expr_1$s.wrapInValue(t))}grainexpr.grain=grain;var changecompexpr={};Object.defineProperty(changecompexpr,"__esModule",{value:!0});changecompexpr.changecomp=changecompexpr.ChangeCompExpr=void 0;const expr_1$r=requireExpr(),getcompexpr_1$2=requireGetcompexpr();function getChangeFunc(t,e,r,o,n=""){return`${t} changecomp_${e}(${t} col, ${r.typeString()} setter) {
  col.${o} ${n}= setter;
  return col;
}`}function checkChangeComponents(t,e,r){if(t.length!==getcompexpr_1$2.typeStringToLength(e.typeString()))throw new Error("components length must be equal to the target float/vec");if(duplicateComponents(t))throw new Error("duplicate components not allowed on left side");getcompexpr_1$2.checkLegalComponents(t,r)}function duplicateComponents(t){return new Set(t.split("")).size!==t.length}class ChangeCompExpr extends expr_1$r.Operator{constructor(e,r,o,n){checkChangeComponents(o,r,e);const a=n==="+"?"plus":n==="-"?"minus":n==="*"?"mult":n==="/"?"div":"assign",l=`${e.typeString()}_${r.typeString()}_${o}_${a}`;super(e,{sections:[`changecomp_${l}(`,", ",")"],values:[e,r]},["uOriginal","uNew"]),this.originalVec=e,this.newVal=r,this.externalFuncs=[getChangeFunc(e.typeString(),l,r,o,n)]}setOriginal(e){this.setUniform("uOriginal"+this.id,e),this.originalVec=e}setNew(e){this.setUniform("uNew"+this.id,e),this.newVal=expr_1$r.wrapInValue(e)}}changecompexpr.ChangeCompExpr=ChangeCompExpr;function changecomp(t,e,r,o){return new ChangeCompExpr(t,expr_1$r.wrapInValue(e),r,o)}changecompexpr.changecomp=changecomp;var rgbtohsvexpr={};Object.defineProperty(rgbtohsvexpr,"__esModule",{value:!0});rgbtohsvexpr.rgb2hsv=rgbtohsvexpr.RGBToHSVExpr=void 0;const expr_1$q=requireExpr(),glslfunctions_1$d=glslfunctions;class RGBToHSVExpr extends expr_1$q.ExprVec4{constructor(e){super(expr_1$q.tag`rgb2hsv(${e})`,["uRGBCol"]),this.color=e,this.externalFuncs=[glslfunctions_1$d.glslFuncs.rgb2hsv]}setColor(e){this.setUniform("uRGBCol",e),this.color=e}}rgbtohsvexpr.RGBToHSVExpr=RGBToHSVExpr;function rgb2hsv(t){return new RGBToHSVExpr(t)}rgbtohsvexpr.rgb2hsv=rgb2hsv;var hsvtorgbexpr={};Object.defineProperty(hsvtorgbexpr,"__esModule",{value:!0});hsvtorgbexpr.hsv2rgb=hsvtorgbexpr.HSVToRGBExpr=void 0;const expr_1$p=requireExpr(),glslfunctions_1$c=glslfunctions;class HSVToRGBExpr extends expr_1$p.ExprVec4{constructor(e){super(expr_1$p.tag`hsv2rgb(${e})`,["uHSVCol"]),this.color=e,this.externalFuncs=[glslfunctions_1$c.glslFuncs.hsv2rgb]}setColor(e){this.setUniform("uHSVCol",e),this.color=e}}hsvtorgbexpr.HSVToRGBExpr=HSVToRGBExpr;function hsv2rgb(t){return new HSVToRGBExpr(t)}hsvtorgbexpr.hsv2rgb=hsv2rgb;var timeexpr={};Object.defineProperty(timeexpr,"__esModule",{value:!0});timeexpr.time=timeexpr.TimeExpr=void 0;const expr_1$o=requireExpr();class TimeExpr extends expr_1$o.ExprFloat{constructor(){super(expr_1$o.tag`uTime`,[]),this.needs.timeUniform=!0}}timeexpr.TimeExpr=TimeExpr;function time$1(){return new TimeExpr}timeexpr.time=time$1;var arity1={};Object.defineProperty(arity1,"__esModule",{value:!0});arity1.a1=arity1.Arity1HomogenousExpr=void 0;const expr_1$n=requireExpr();function genArity1SourceList$1(t,e){return{sections:[t+"(",")"],values:[e]}}class Arity1HomogenousExpr extends expr_1$n.Operator{constructor(e,r){super(e,genArity1SourceList$1(r,e),["uVal"]),this.val=e}setVal(e){this.setUniform("uVal"+this.id,e),this.val=expr_1$n.wrapInValue(e)}}arity1.Arity1HomogenousExpr=Arity1HomogenousExpr;function a1(t,e){return new Arity1HomogenousExpr(expr_1$n.wrapInValue(e),t)}arity1.a1=a1;var arity2={};Object.defineProperty(arity2,"__esModule",{value:!0});arity2.a2=arity2.Arity2HomogenousExpr=void 0;const expr_1$m=requireExpr();function genArity1SourceList(t,e,r){return{sections:[t+"(",",",")"],values:[e,r]}}class Arity2HomogenousExpr extends expr_1$m.Operator{constructor(e,r,o){super(r,genArity1SourceList(e,r,o),["uVal1","uVal2"]),this.val1=r,this.val2=o}setFirstVal(e){this.setUniform("uVal1"+this.id,e),this.val1=expr_1$m.wrapInValue(e)}setSecondVal(e){this.setUniform("uVal2"+this.id,e),this.val2=expr_1$m.wrapInValue(e)}}arity2.Arity2HomogenousExpr=Arity2HomogenousExpr;function a2(t,e,r){return new Arity2HomogenousExpr(t,expr_1$m.wrapInValue(e),expr_1$m.wrapInValue(r))}arity2.a2=a2;var fxaaexpr={};Object.defineProperty(fxaaexpr,"__esModule",{value:!0});fxaaexpr.fxaa=void 0;const expr_1$l=requireExpr(),glslfunctions_1$b=glslfunctions;class FXAAExpr extends expr_1$l.ExprVec4{constructor(){super(expr_1$l.tag`fxaa()`,[]),this.externalFuncs=[glslfunctions_1$b.glslFuncs.fxaa],this.needs.neighborSample=!0}}function fxaa(){return new FXAAExpr}fxaaexpr.fxaa=fxaa;var channelsampleexpr={};Object.defineProperty(channelsampleexpr,"__esModule",{value:!0});channelsampleexpr.channel=channelsampleexpr.ChannelSampleExpr=void 0;const codebuilder_1=requireCodebuilder(),expr_1$k=requireExpr(),normfragcoordexpr_1$1=requireNormfragcoordexpr(),glslfunctions_1$a=glslfunctions;function genChannelSampleSource(t,e){return{sections:["channel(",`, ${codebuilder_1.channelSamplerName(t)})`],values:[e]}}class ChannelSampleExpr extends expr_1$k.ExprVec4{constructor(e,r=normfragcoordexpr_1$1.pos()){super(genChannelSampleSource(e,r),["uVec"]),this.coord=r,this.externalFuncs=[glslfunctions_1$a.glslFuncs.channel],e!==-1?this.needs.extraBuffers=new Set([e]):this.needs.neighborSample=!0}setCoord(e){this.setUniform("uVec",e),this.coord=e}}channelsampleexpr.ChannelSampleExpr=ChannelSampleExpr;function channel(t,e){return new ChannelSampleExpr(t,e)}channelsampleexpr.channel=channel;var dofloop={},gaussianexpr={};Object.defineProperty(gaussianexpr,"__esModule",{value:!0});gaussianexpr.gaussian=gaussianexpr.GaussianExpr=void 0;const glslfunctions_1$9=glslfunctions,expr_1$j=requireExpr();class GaussianExpr extends expr_1$j.ExprFloat{constructor(e,r,o){super(expr_1$j.tag`gaussian(${e}, ${r}, ${o})`,["uFloatX","uFloatA","uFloatB"]),this.x=e,this.a=r,this.b=o,this.externalFuncs=[glslfunctions_1$9.glslFuncs.gaussian]}setX(e){this.setUniform("uFloatX"+this.id,e),this.x=expr_1$j.wrapInValue(e)}setA(e){this.setUniform("uFloatA"+this.id,e),this.a=expr_1$j.wrapInValue(e)}setB(e){this.setUniform("uFloatB"+this.id,e),this.b=expr_1$j.wrapInValue(e)}}gaussianexpr.GaussianExpr=GaussianExpr;function gaussian(t,e=0,r=1){return new GaussianExpr(expr_1$j.wrapInValue(t),expr_1$j.wrapInValue(e),expr_1$j.wrapInValue(r))}gaussianexpr.gaussian=gaussian;Object.defineProperty(dofloop,"__esModule",{value:!0});dofloop.dof=dofloop.DoFLoop=void 0;const mergepass_1$2=requireMergepass(),arity2_1$2=arity2,blurexpr_1$1=blurexpr,channelsampleexpr_1$3=channelsampleexpr,expr_1$i=requireExpr(),gaussianexpr_1=gaussianexpr,getcompexpr_1$1=requireGetcompexpr(),opexpr_1$4=requireOpexpr(),vecexprs_1$4=vecexprs;class DoFLoop extends mergepass_1$2.EffectLoop{constructor(e=expr_1$i.mut(expr_1$i.pfloat(.3)),r=expr_1$i.mut(expr_1$i.pfloat(.01)),o=getcompexpr_1$1.getcomp(channelsampleexpr_1$3.channel(0),"r"),n=2,a=13){let l=gaussianexpr_1.gaussian(o,e,r);const u=blurexpr_1$1.gauss(vecexprs_1$4.vec2(arity2_1$2.a2("pow",opexpr_1$4.op(1,"-",l),4),0),a),p=blurexpr_1$1.gauss(vecexprs_1$4.vec2(0,arity2_1$2.a2("pow",opexpr_1$4.op(1,"-",l),4)),a);super([u,p],{num:n}),this.gaussian=l}setDepth(e){this.gaussian.setA(e)}setRadius(e){this.gaussian.setB(e)}}dofloop.DoFLoop=DoFLoop;function dof(t,e,r,o){return new DoFLoop(expr_1$i.wrapInValue(t),expr_1$i.wrapInValue(e),expr_1$i.wrapInValue(r),o)}dofloop.dof=dof;var truedepthexpr={};Object.defineProperty(truedepthexpr,"__esModule",{value:!0});truedepthexpr.truedepth=truedepthexpr.TrueDepthExpr=void 0;const expr_1$h=requireExpr(),glslfunctions_1$8=glslfunctions;class TrueDepthExpr extends expr_1$h.ExprFloat{constructor(e){super(expr_1$h.tag`truedepth(${e})`,["uDist"]),this.depth=e,this.externalFuncs=[glslfunctions_1$8.glslFuncs.truedepth]}setDist(e){this.setUniform("uDist",e),this.depth=expr_1$h.wrapInValue(e)}}truedepthexpr.TrueDepthExpr=TrueDepthExpr;function truedepth(t){return new TrueDepthExpr(expr_1$h.wrapInValue(t))}truedepthexpr.truedepth=truedepth;var godraysexpr={};Object.defineProperty(godraysexpr,"__esModule",{value:!0});godraysexpr.godrays=godraysexpr.GodRaysExpr=void 0;const glslfunctions_1$7=glslfunctions,expr_1$g=requireExpr(),fragcolorexpr_1$3=requireFragcolorexpr(),vecexprs_1$3=vecexprs,DEFAULT_SAMPLES=100;class GodRaysExpr extends expr_1$g.ExprVec4{constructor(e=fragcolorexpr_1$3.fcolor(),r=expr_1$g.mut(1),o=expr_1$g.mut(1),n=expr_1$g.mut(1),a=expr_1$g.mut(.01),l=expr_1$g.mut(vecexprs_1$3.pvec2(.5,.5)),u=0,p=DEFAULT_SAMPLES,f){const h=expr_1$g.tag`${e}, ${r}, ${o}, ${n}, ${a}, ${l}, ${f!==void 0?f.threshold:expr_1$g.float(0)}, ${f!==void 0?f.newColor:vecexprs_1$3.vec4(0,0,0,0)})`,E=`godrays${f!==void 0?"_depth":""}${p!==100?"_s"+p:""}(`;h.sections[0]=E,super(h,["uCol","uExposure","uDecay","uDensity","uWeight","uLightPos","uThreshold","uNewColor"]),this.col=e,this.exposure=r,this.decay=o,this.density=n,this.weight=a,this.lightPos=l,this.threshold=f==null?void 0:f.threshold,this.newColor=f==null?void 0:f.newColor,this.funcIndex=~~(f!==void 0);let F=glslfunctions_1$7.glslFuncs.godrays.split("godrays(").join(E).replace(`NUM_SAMPLES = ${DEFAULT_SAMPLES}`,"NUM_SAMPLES = "+p);f!==void 0&&(F=F.replace(/\/\/uncomment\s/g,""),this.externalFuncs.push(glslfunctions_1$7.glslFuncs.depth2occlusion)),this.externalFuncs.push(F),this.brandExprWithChannel(this.funcIndex,u)}setColor(e){this.setUniform("uCol"+this.id,e),this.col=e}setExposure(e){this.setUniform("uExposure"+this.id,e),this.exposure=expr_1$g.wrapInValue(e)}setDecay(e){this.setUniform("uDecay"+this.id,e),this.decay=expr_1$g.wrapInValue(e)}setDensity(e){this.setUniform("uDensity"+this.id,e),this.density=expr_1$g.wrapInValue(e)}setWeight(e){this.setUniform("uWeight"+this.id,e),this.weight=expr_1$g.wrapInValue(e)}setLightPos(e){this.setUniform("uLightPos"+this.id,e),this.lightPos=e}setThreshold(e){this.setUniform("uThreshold"+this.id,e),this.threshold=expr_1$g.wrapInValue(e)}setNewColor(e){this.setUniform("uNewColor"+this.id,e),this.newColor=e}}godraysexpr.GodRaysExpr=GodRaysExpr;function godrays(t={}){return new GodRaysExpr(t.color,expr_1$g.wrapInValue(t.exposure),expr_1$g.wrapInValue(t.decay),expr_1$g.wrapInValue(t.density),expr_1$g.wrapInValue(t.weight),t.lightPos,t.samplerNum,t.numSamples,t.convertDepth===void 0?void 0:{threshold:expr_1$g.wrapInValue(t.convertDepth.threshold),newColor:t.convertDepth.newColor})}godraysexpr.godrays=godrays;var depthtoocclusionexpr={};Object.defineProperty(depthtoocclusionexpr,"__esModule",{value:!0});depthtoocclusionexpr.depth2occlusion=depthtoocclusionexpr.DepthToOcclusionExpr=void 0;const channelsampleexpr_1$2=channelsampleexpr,expr_1$f=requireExpr(),vecexprs_1$2=vecexprs;class DepthToOcclusionExpr extends expr_1$f.ExprVec4{constructor(e=channelsampleexpr_1$2.channel(0),r=expr_1$f.mut(vecexprs_1$2.pvec4(1,1,1,1)),o=expr_1$f.mut(expr_1$f.pfloat(.01))){super(expr_1$f.tag`depth2occlusion(${e}, ${r}, ${o})`,["uDepth","uNewCol","uThreshold"]),this.depthCol=e,this.newCol=r,this.threshold=o}setDepthColor(e){this.setUniform("uDepth"+this.id,e),this.depthCol=e}setNewColor(e){this.setUniform("uNewCol"+this.id,e),this.newCol=e}setThreshold(e){this.setUniform("uThreshold"+this.id,e),this.threshold=expr_1$f.wrapInValue(e)}}depthtoocclusionexpr.DepthToOcclusionExpr=DepthToOcclusionExpr;function depth2occlusion(t,e,r){return new DepthToOcclusionExpr(t,e,expr_1$f.wrapInValue(r))}depthtoocclusionexpr.depth2occlusion=depth2occlusion;var resolutionexpr={};Object.defineProperty(resolutionexpr,"__esModule",{value:!0});resolutionexpr.resolution=resolutionexpr.ResolutionExpr=void 0;const expr_1$e=requireExpr();class ResolutionExpr extends expr_1$e.ExprVec2{constructor(){super(expr_1$e.tag`uResolution`,[])}}resolutionexpr.ResolutionExpr=ResolutionExpr;function resolution(){return new ResolutionExpr}resolutionexpr.resolution=resolution;var mouseexpr={};Object.defineProperty(mouseexpr,"__esModule",{value:!0});mouseexpr.mouse=mouseexpr.MouseExpr=void 0;const expr_1$d=requireExpr();class MouseExpr extends expr_1$d.ExprVec2{constructor(){super(expr_1$d.tag`uMouse`,[]),this.needs.mouseUniform=!0}}mouseexpr.MouseExpr=MouseExpr;function mouse(){return new MouseExpr}mouseexpr.mouse=mouse;var rotateexpr={};Object.defineProperty(rotateexpr,"__esModule",{value:!0});rotateexpr.rotate=rotateexpr.RotateExpr=void 0;const glslfunctions_1$6=glslfunctions,expr_1$c=requireExpr();class RotateExpr extends expr_1$c.ExprVec2{constructor(e,r){super(expr_1$c.tag`rotate2d(${e}, ${r})`,["uVec","uAngle"]),this.vec=e,this.angle=r,this.externalFuncs=[glslfunctions_1$6.glslFuncs.rotate2d]}setVec(e){this.setUniform("uVec"+this.id,e),this.vec=e}setAngle(e){this.setUniform("uAngle"+this.id,e),this.angle=expr_1$c.wrapInValue(e)}}rotateexpr.RotateExpr=RotateExpr;function rotate(t,e){return new RotateExpr(t,expr_1$c.wrapInValue(e))}rotateexpr.rotate=rotate;var translateexpr={};Object.defineProperty(translateexpr,"__esModule",{value:!0});translateexpr.translate=translateexpr.TranslateExpr=void 0;const expr_1$b=requireExpr();class TranslateExpr extends expr_1$b.ExprVec2{constructor(e,r){super(expr_1$b.tag`(${e} + ${r})`,["uVec","uPos"]),this.vec=e,this.pos=r}setVec(e){this.setUniform("uVec"+this.id,e),this.vec=e}setPos(e){this.setUniform("uPos"+this.id,e),this.pos=e}}translateexpr.TranslateExpr=TranslateExpr;function translate(t,e){return new TranslateExpr(t,e)}translateexpr.translate=translate;var normmouseexpr={};Object.defineProperty(normmouseexpr,"__esModule",{value:!0});normmouseexpr.nmouse=normmouseexpr.NormMouseExpr=void 0;const expr_1$a=requireExpr();class NormMouseExpr extends expr_1$a.ExprVec2{constructor(){super(expr_1$a.tag`(uMouse / uResolution.xy)`,[]),this.needs.mouseUniform=!0}}normmouseexpr.NormMouseExpr=NormMouseExpr;function nmouse(){return new NormMouseExpr}normmouseexpr.nmouse=nmouse;var perlinexpr={};Object.defineProperty(perlinexpr,"__esModule",{value:!0});perlinexpr.fractalize=perlinexpr.perlin=perlinexpr.PerlinExpr=void 0;const glslfunctions_1$5=glslfunctions,expr_1$9=requireExpr(),opexpr_1$3=requireOpexpr();class PerlinExpr extends expr_1$9.ExprFloat{constructor(e){super(expr_1$9.tag`gradientnoise(${e})`,["uPos"]),this.pos=e,this.externalFuncs=[glslfunctions_1$5.glslFuncs.random2,glslfunctions_1$5.glslFuncs.gradientnoise]}setPos(e){this.setUniform("uPos",e),this.pos=e}}perlinexpr.PerlinExpr=PerlinExpr;function perlin(t){return new PerlinExpr(t)}perlinexpr.perlin=perlin;function fractalize(t,e,r){if(e<0)throw new Error("octaves can't be < 0");const o=(n,a,l)=>l<=0?expr_1$9.pfloat(0):opexpr_1$3.op(r(opexpr_1$3.op(n,"/",a*2)),"+",o(n,a/2,l-1));return o(t,.5,e)}perlinexpr.fractalize=fractalize;var simplexexpr={};Object.defineProperty(simplexexpr,"__esModule",{value:!0});simplexexpr.simplex=simplexexpr.SimplexNoise=void 0;const glslfunctions_1$4=glslfunctions,expr_1$8=requireExpr();class SimplexNoise extends expr_1$8.ExprFloat{constructor(e){super(expr_1$8.tag`simplexnoise(${e})`,["uPos"]),this.pos=e,this.externalFuncs=[glslfunctions_1$4.glslFuncs.simplexhelpers,glslfunctions_1$4.glslFuncs.simplexnoise]}setPos(e){this.setUniform("uPos",e),this.pos=e}}simplexexpr.SimplexNoise=SimplexNoise;function simplex(t){return new SimplexNoise(t)}simplexexpr.simplex=simplex;var motionblurloop={};Object.defineProperty(motionblurloop,"__esModule",{value:!0});motionblurloop.motionblur=motionblurloop.MotionBlurLoop=void 0;const mergepass_1$1=requireMergepass(),channelsampleexpr_1$1=channelsampleexpr,expr_1$7=requireExpr(),fragcolorexpr_1$2=requireFragcolorexpr(),opexpr_1$2=requireOpexpr();class MotionBlurLoop extends mergepass_1$1.EffectLoop{constructor(e=0,r=expr_1$7.float(expr_1$7.mut(.3))){const o=opexpr_1$2.op(channelsampleexpr_1$1.channel(e),"*",r),n=opexpr_1$2.op(fragcolorexpr_1$2.fcolor(),"*",opexpr_1$2.op(1,"-",r)),a=[mergepass_1$1.loop([opexpr_1$2.op(o,"+",n)]).target(e),channelsampleexpr_1$1.channel(e)];super(a,{num:1}),this.persistence=r}setPersistence(e){if(!(this.persistence instanceof expr_1$7.BasicFloat))throw new Error("persistence expression not basic float");this.persistence.setVal(e)}}motionblurloop.MotionBlurLoop=MotionBlurLoop;function motionblur(t,e){return new MotionBlurLoop(t,expr_1$7.wrapInValue(e))}motionblurloop.motionblur=motionblur;var randomexpr={};Object.defineProperty(randomexpr,"__esModule",{value:!0});randomexpr.random=randomexpr.RandomExpr=void 0;const glslfunctions_1$3=glslfunctions,expr_1$6=requireExpr(),normfragcoordexpr_1=requireNormfragcoordexpr();class RandomExpr extends expr_1$6.ExprFloat{constructor(e=normfragcoordexpr_1.pos()){super(expr_1$6.tag`random(${e})`,["uSeed"]),this.seed=e,this.externalFuncs=[glslfunctions_1$3.glslFuncs.random]}setSeed(e){this.setUniform("uSeed",e),this.seed=e}}randomexpr.RandomExpr=RandomExpr;function random(t){return new RandomExpr(t)}randomexpr.random=random;var sobelexpr={};Object.defineProperty(sobelexpr,"__esModule",{value:!0});sobelexpr.sobel=sobelexpr.SobelExpr=void 0;const glslfunctions_1$2=glslfunctions,expr_1$5=requireExpr();class SobelExpr extends expr_1$5.ExprVec4{constructor(e){super(expr_1$5.tag`sobel()`,[]),this.externalFuncs=[glslfunctions_1$2.glslFuncs.sobel],this.brandExprWithChannel(0,e)}}sobelexpr.SobelExpr=SobelExpr;function sobel(t){return new SobelExpr(t)}sobelexpr.sobel=sobel;var bloomloop={};Object.defineProperty(bloomloop,"__esModule",{value:!0});bloomloop.bloom=bloomloop.BloomLoop=void 0;const mergepass_1=requireMergepass(),arity2_1$1=arity2,blurexpr_1=blurexpr,brightnessexpr_1$1=brightnessexpr,channelsampleexpr_1=channelsampleexpr,contrastexpr_1=contrastexpr,expr_1$4=requireExpr(),fragcolorexpr_1$1=requireFragcolorexpr(),opexpr_1$1=requireOpexpr(),vecexprs_1$1=vecexprs;class BloomLoop extends mergepass_1.EffectLoop{constructor(e=expr_1$4.float(expr_1$4.mut(.4)),r=expr_1$4.float(expr_1$4.mut(1)),o=expr_1$4.float(expr_1$4.mut(1)),n=expr_1$4.float(expr_1$4.mut(1.3)),a=1,l=9,u=3){const p=expr_1$4.cfloat(expr_1$4.tag`((${channelsampleexpr_1.channel(a)}.r + ${channelsampleexpr_1.channel(a)}.g + ${channelsampleexpr_1.channel(a)}.b) / 3.)`),f=arity2_1$1.a2("step",p,e),h=expr_1$4.cvec4(expr_1$4.tag`vec4(${channelsampleexpr_1.channel(a)}.rgb * (1. - ${f}), 1.)`),E=[mergepass_1.loop([h]).target(a),mergepass_1.loop([blurexpr_1.gauss(vecexprs_1$1.vec2(r,0),l),blurexpr_1.gauss(vecexprs_1$1.vec2(0,o),l),brightnessexpr_1$1.brightness(.1),contrastexpr_1.contrast(n)],u).target(a),opexpr_1$1.op(fragcolorexpr_1$1.fcolor(),"+",channelsampleexpr_1.channel(a))];super(E,{num:1}),this.threshold=e,this.horizontal=r,this.vertical=o,this.boost=n}setHorizontal(e){if(!(this.horizontal instanceof expr_1$4.BasicFloat))throw new Error("horizontal expression not basic float");this.horizontal.setVal(e)}setVertical(e){if(!(this.vertical instanceof expr_1$4.BasicFloat))throw new Error("vertical expression not basic float");this.vertical.setVal(e)}setThreshold(e){if(!(this.threshold instanceof expr_1$4.BasicFloat))throw new Error("threshold expression not basic float");this.threshold.setVal(e)}setBoost(e){if(!(this.boost instanceof expr_1$4.BasicFloat))throw new Error("boost expression not basic float");this.boost.setVal(e)}}bloomloop.BloomLoop=BloomLoop;function bloom(t,e,r,o,n,a,l){return new BloomLoop(expr_1$4.wrapInValue(t),expr_1$4.wrapInValue(e),expr_1$4.wrapInValue(r),expr_1$4.wrapInValue(o),n,a,l)}bloomloop.bloom=bloom;var monochromeexpr={};Object.defineProperty(monochromeexpr,"__esModule",{value:!0});monochromeexpr.monochrome=monochromeexpr.MonochromeExpr=void 0;const expr_1$3=requireExpr(),glslfunctions_1$1=glslfunctions;class MonochromeExpr extends expr_1$3.ExprVec4{constructor(e){super(expr_1$3.tag`monochrome(${e})`,["uColor"]),this.externalFuncs=[glslfunctions_1$1.glslFuncs.monochrome],this.color=e}setColor(e){this.setUniform("uColor",e),this.color=e}}monochromeexpr.MonochromeExpr=MonochromeExpr;function monochrome(t){return new MonochromeExpr(t)}monochromeexpr.monochrome=monochrome;var invertexpr={};Object.defineProperty(invertexpr,"__esModule",{value:!0});invertexpr.invert=invertexpr.InvertExpr=void 0;const expr_1$2=requireExpr(),glslfunctions_1=glslfunctions;class InvertExpr extends expr_1$2.ExprVec4{constructor(e){super(expr_1$2.tag`invert(${e})`,["uColor"]),this.externalFuncs=[glslfunctions_1.glslFuncs.invert],this.color=e}setColor(e){this.setUniform("uColor",e),this.color=e}}invertexpr.InvertExpr=InvertExpr;function invert(t){return new InvertExpr(t)}invertexpr.invert=invert;var edgeexpr={};Object.defineProperty(edgeexpr,"__esModule",{value:!0});edgeexpr.edge=edgeexpr.EdgeExpr=void 0;const brightnessexpr_1=brightnessexpr,expr_1$1=requireExpr(),getcompexpr_1=requireGetcompexpr(),invertexpr_1=invertexpr,monochromeexpr_1$1=monochromeexpr,opexpr_1=requireOpexpr(),sobelexpr_1$1=sobelexpr;class EdgeExpr extends expr_1$1.WrappedExpr{constructor(e=expr_1$1.mut(-1),r){const o=opexpr_1.op(getcompexpr_1.getcomp(invertexpr_1.invert(monochromeexpr_1$1.monochrome(sobelexpr_1$1.sobel(r))),"r"),"*",e);super(brightnessexpr_1.brightness(o)),this.mult=e,this.operator=o}setMult(e){this.operator.setRight(e),this.mult=expr_1$1.wrapInValue(e)}}edgeexpr.EdgeExpr=EdgeExpr;function edge(t,e){const r=t==="dark"?-1:t==="light"?1:t;return new EdgeExpr(expr_1$1.wrapInValue(r),e)}edgeexpr.edge=edge;var edgecolorexpr={};Object.defineProperty(edgecolorexpr,"__esModule",{value:!0});edgecolorexpr.edgecolor=edgecolorexpr.EdgeColorExpr=void 0;const arity2_1=arity2,expr_1=requireExpr(),fragcolorexpr_1=requireFragcolorexpr(),monochromeexpr_1=monochromeexpr,sobelexpr_1=sobelexpr,vecexprs_1=vecexprs;class EdgeColorExpr extends expr_1.WrappedExpr{constructor(e,r,o=!0){const n=o?expr_1.cvec4(expr_1.tag`mix(${e}, ${fragcolorexpr_1.fcolor()}, ${monochromeexpr_1.monochrome(arity2_1.a2("step",vecexprs_1.vec4(.5,.5,.5,0),sobelexpr_1.sobel(r)))})`):expr_1.cvec4(expr_1.tag`mix(${e}, ${fragcolorexpr_1.fcolor()}, ${monochromeexpr_1.monochrome(sobelexpr_1.sobel(r))})`);super(n),this.color=e,this.expr=n}setColor(e){this.expr.setUniform("uCustomName0"+this.expr.id,e),this.color=e}}edgecolorexpr.EdgeColorExpr=EdgeColorExpr;function edgecolor(t,e,r){return new EdgeColorExpr(t,e,r)}edgecolorexpr.edgecolor=edgecolor;(function(t){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,n,a,l){l===void 0&&(l=a),Object.defineProperty(o,l,{enumerable:!0,get:function(){return n[a]}})}:function(o,n,a,l){l===void 0&&(l=a),o[l]=n[a]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(o,n){for(var a in o)a!=="default"&&!n.hasOwnProperty(a)&&e(n,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),r(requireMergepass(),t),r(exprtypes,t),r(glslfunctions,t),r(settings,t),r(blurexpr,t),r(requireFragcolorexpr(),t),r(vecexprs,t),r(requireOpexpr(),t),r(powerblur,t),r(blur2dloop,t),r(lenexpr,t),r(normexpr,t),r(fragcoordexpr,t),r(requireNormfragcoordexpr(),t),r(normcenterfragcoordexpr,t),r(requireScenesampleexpr(),t),r(brightnessexpr,t),r(contrastexpr,t),r(grainexpr,t),r(requireGetcompexpr(),t),r(changecompexpr,t),r(rgbtohsvexpr,t),r(hsvtorgbexpr,t),r(timeexpr,t),r(arity1,t),r(arity2,t),r(fxaaexpr,t),r(channelsampleexpr,t),r(dofloop,t),r(truedepthexpr,t),r(godraysexpr,t),r(depthtoocclusionexpr,t),r(resolutionexpr,t),r(mouseexpr,t),r(rotateexpr,t),r(translateexpr,t),r(normmouseexpr,t),r(perlinexpr,t),r(simplexexpr,t),r(motionblurloop,t),r(randomexpr,t),r(sobelexpr,t),r(bloomloop,t),r(monochromeexpr,t),r(invertexpr,t),r(edgeexpr,t),r(edgecolorexpr,t),r(requireTernaryexpr(),t),r(requireRegiondecorator(),t),r(requireExpr(),t)})(dist);Object.defineProperty(foggyrays$1,"__esModule",{value:!0});foggyrays$1.foggyrays=foggyrays$1.FoggyRaysExpr=void 0;const merge_pass_1$7=dist;class FoggyRaysExpr extends merge_pass_1$7.WrappedExpr{constructor(e,r,o,n,a,l){const u=merge_pass_1$7.float(e),p=merge_pass_1$7.float(r),f=merge_pass_1$7.float(o),h=merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.simplex(merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.pos(),"+",merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.time(),"*",p),"/",u)),"*",merge_pass_1$7.op(merge_pass_1$7.resolution(),"/",merge_pass_1$7.op(u,"*",2)))),"*",merge_pass_1$7.simplex(merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.pos(),"+",merge_pass_1$7.op(merge_pass_1$7.op(merge_pass_1$7.time(),"*",p),"/",merge_pass_1$7.op(u,"*",-2))),"*",merge_pass_1$7.op(merge_pass_1$7.resolution(),"/",merge_pass_1$7.op(u,"*",4))))),"*",.5),E=merge_pass_1$7.godrays({weight:.009,density:merge_pass_1$7.op(f,"+",merge_pass_1$7.op(h,"*",.5)),convertDepth:l!==void 0?{threshold:.01,newColor:l}:void 0,samplerNum:a,numSamples:n});super(E),this.periodFloat=u,this.speedFloat=p,this.throwDistanceFloat=f,this.godraysExpr=E,this.convertsDepth=l!==void 0,this.period=e,this.speed=r,this.throwDistance=o}setPeriod(e){this.periodFloat.setVal(merge_pass_1$7.wrapInValue(e)),this.period=merge_pass_1$7.wrapInValue(e)}setSpeed(e){this.speedFloat.setVal(merge_pass_1$7.wrapInValue(e)),this.speed=merge_pass_1$7.wrapInValue(e)}setThrowDistance(e){this.throwDistanceFloat.setVal(merge_pass_1$7.wrapInValue(e)),this.throwDistance=merge_pass_1$7.wrapInValue(e)}setNewColor(e){if(this.convertsDepth===void 0)throw new Error("can only set new color if you are converting from a depth buffer");this.godraysExpr.setNewColor(e)}}foggyrays$1.FoggyRaysExpr=FoggyRaysExpr;function foggyrays(t=merge_pass_1$7.mut(100),e=merge_pass_1$7.mut(1),r=merge_pass_1$7.mut(.3),o=100,n,a){return new FoggyRaysExpr(merge_pass_1$7.wrapInValue(t),merge_pass_1$7.wrapInValue(e),merge_pass_1$7.wrapInValue(r),o,n,a)}foggyrays$1.foggyrays=foggyrays;var vignette$1={};Object.defineProperty(vignette$1,"__esModule",{value:!0});vignette$1.vignette=vignette$1.Vignette=void 0;const merge_pass_1$6=dist;class Vignette extends merge_pass_1$6.EffectLoop{constructor(e,r,o){const n=merge_pass_1$6.float(e),a=merge_pass_1$6.float(r),l=merge_pass_1$6.float(o),u=merge_pass_1$6.op(merge_pass_1$6.len(merge_pass_1$6.center()),"*",n),p=merge_pass_1$6.blur2d(u,u),f=merge_pass_1$6.a2("pow",merge_pass_1$6.len(merge_pass_1$6.center()),l),h=merge_pass_1$6.brightness(merge_pass_1$6.op(f,"*",merge_pass_1$6.op(a,"*",-1)));super([p,h],{num:1}),this.blurScalarFloat=n,this.brightnessScalarFloat=a,this.brightnessExponentFloat=l,this.blurScalar=e,this.brightnessScalar=r,this.brightnessExponent=o}setBlurScalar(e){this.blurScalarFloat.setVal(merge_pass_1$6.wrapInValue(e)),this.blurScalar=merge_pass_1$6.wrapInValue(e)}setBrightnessScalar(e){this.brightnessScalarFloat.setVal(merge_pass_1$6.wrapInValue(e)),this.brightnessScalar=merge_pass_1$6.wrapInValue(e)}setBrightnessExponent(e){this.brightnessExponentFloat.setVal(merge_pass_1$6.wrapInValue(e)),this.brightnessExponent=merge_pass_1$6.wrapInValue(e)}}vignette$1.Vignette=Vignette;function vignette(t=merge_pass_1$6.mut(3),e=merge_pass_1$6.mut(1.8),r=merge_pass_1$6.mut(1.8)){return new Vignette(merge_pass_1$6.wrapInValue(t),merge_pass_1$6.wrapInValue(e),merge_pass_1$6.wrapInValue(r))}vignette$1.vignette=vignette;var blurandtrace$1={};Object.defineProperty(blurandtrace$1,"__esModule",{value:!0});blurandtrace$1.blurandtrace=blurandtrace$1.BlurAndTrace=void 0;const merge_pass_1$5=dist;class BlurAndTrace extends merge_pass_1$5.EffectLoop{constructor(e,r,o,n,a,l){const u=merge_pass_1$5.float(e),p=merge_pass_1$5.float(r);super([...l?[]:[merge_pass_1$5.loop([merge_pass_1$5.channel(a)]).target(a)],merge_pass_1$5.blur2d(p,p,o,n),merge_pass_1$5.edge(u,a)],{num:1}),this.brightnessFloat=u,this.blurSizeFloat=p,this.brightness=e,this.blurSize=r}setBrightness(e){this.brightnessFloat.setVal(merge_pass_1$5.wrapInValue(e)),this.brightness=merge_pass_1$5.wrapInValue(e)}setBlurSize(e){this.blurSizeFloat.setVal(merge_pass_1$5.wrapInValue(e)),this.blurSize=merge_pass_1$5.wrapInValue(e)}}blurandtrace$1.BlurAndTrace=BlurAndTrace;function blurandtrace(t=merge_pass_1$5.mut(1),e=merge_pass_1$5.mut(1),r=4,o=9,n=0,a=!1){return new BlurAndTrace(merge_pass_1$5.wrapInValue(t),merge_pass_1$5.wrapInValue(e),r,o,n,a)}blurandtrace$1.blurandtrace=blurandtrace;var lightbands$1={};Object.defineProperty(lightbands$1,"__esModule",{value:!0});lightbands$1.lightbands=lightbands$1.LightBands=void 0;const merge_pass_1$4=dist;class LightBands extends merge_pass_1$4.WrappedExpr{constructor(e,r,o,n){const a=merge_pass_1$4.float(e),l=merge_pass_1$4.float(r),u=merge_pass_1$4.float(o),p=merge_pass_1$4.brightness(merge_pass_1$4.ternary(merge_pass_1$4.op(merge_pass_1$4.getcomp(merge_pass_1$4.channel(0),"r"),"-",u),merge_pass_1$4.op(merge_pass_1$4.a1("sin",merge_pass_1$4.op(merge_pass_1$4.op(merge_pass_1$4.time(),"*",a),"+",merge_pass_1$4.truedepth(merge_pass_1$4.getcomp(merge_pass_1$4.channel(n),"r")))),"*",l),0));super(p),this.speedFloat=a,this.intensityFloat=l,this.thresholdFloat=u,this.speed=e,this.intensity=r,this.threshold=o}setSpeed(e){this.speedFloat.setVal(merge_pass_1$4.wrapInValue(e)),this.speed=merge_pass_1$4.wrapInValue(e)}setIntensity(e){this.intensityFloat.setVal(merge_pass_1$4.wrapInValue(e)),this.intensity=merge_pass_1$4.wrapInValue(e)}setThreshold(e){this.thresholdFloat.setVal(merge_pass_1$4.wrapInValue(e)),this.threshold=merge_pass_1$4.wrapInValue(e)}}lightbands$1.LightBands=LightBands;function lightbands(t=merge_pass_1$4.mut(4),e=merge_pass_1$4.mut(.3),r=merge_pass_1$4.mut(.01),o=0){return new LightBands(merge_pass_1$4.wrapInValue(t),merge_pass_1$4.wrapInValue(e),merge_pass_1$4.wrapInValue(r),o)}lightbands$1.lightbands=lightbands;var noisedisplacement$1={};Object.defineProperty(noisedisplacement$1,"__esModule",{value:!0});noisedisplacement$1.noisedisplacement=noisedisplacement$1.NoiseDisplacement=void 0;const merge_pass_1$3=dist,X_OFF=1234,Y_OFF=5678;class NoiseDisplacement extends merge_pass_1$3.WrappedExpr{constructor(e,r,o){const n=merge_pass_1$3.float(e),a=merge_pass_1$3.float(r),l=merge_pass_1$3.float(o),u=p=>merge_pass_1$3.simplex(merge_pass_1$3.op(merge_pass_1$3.op(merge_pass_1$3.changecomp(merge_pass_1$3.op(merge_pass_1$3.pos(),"/",n),merge_pass_1$3.op(merge_pass_1$3.time(),"*",a),p,"+"),"*",merge_pass_1$3.op(merge_pass_1$3.resolution(),"/",merge_pass_1$3.getcomp(merge_pass_1$3.resolution(),"y"))),"+",p==="x"?X_OFF:Y_OFF));super(merge_pass_1$3.channel(-1,merge_pass_1$3.op(merge_pass_1$3.op(merge_pass_1$3.op(merge_pass_1$3.vec2(u("x"),u("y")),"*",l),"*",merge_pass_1$3.op(merge_pass_1$3.get2comp(merge_pass_1$3.resolution(),"yx"),"/",merge_pass_1$3.getcomp(merge_pass_1$3.resolution(),"y"))),"+",merge_pass_1$3.pos()))),this.periodFloat=n,this.speedFloat=a,this.intensityFloat=l,this.period=e,this.speed=r,this.intensity=o}setPeriod(e){this.periodFloat.setVal(merge_pass_1$3.wrapInValue(e)),this.period=merge_pass_1$3.wrapInValue(e)}setSpeed(e){this.speedFloat.setVal(merge_pass_1$3.wrapInValue(e)),this.speed=merge_pass_1$3.wrapInValue(e)}setIntensity(e){this.intensityFloat.setVal(merge_pass_1$3.wrapInValue(e)),this.speed=merge_pass_1$3.wrapInValue(e)}}noisedisplacement$1.NoiseDisplacement=NoiseDisplacement;function noisedisplacement(t=merge_pass_1$3.mut(.1),e=merge_pass_1$3.mut(1),r=merge_pass_1$3.mut(.005)){return new NoiseDisplacement(merge_pass_1$3.wrapInValue(t),merge_pass_1$3.wrapInValue(e),merge_pass_1$3.wrapInValue(r))}noisedisplacement$1.noisedisplacement=noisedisplacement;var oldfilm$1={};Object.defineProperty(oldfilm$1,"__esModule",{value:!0});oldfilm$1.oldfilm=oldfilm$1.OldFilm=void 0;const merge_pass_1$2=dist;class OldFilm extends merge_pass_1$2.WrappedExpr{constructor(e,r,o){const n=merge_pass_1$2.float(e),a=merge_pass_1$2.float(r),l=merge_pass_1$2.float(o),u=merge_pass_1$2.a1("floor",merge_pass_1$2.op(merge_pass_1$2.time(),"*",24)),p=merge_pass_1$2.op(merge_pass_1$2.random(merge_pass_1$2.op(merge_pass_1$2.pixel(),"+",merge_pass_1$2.a2("mod",merge_pass_1$2.op(u,"*",99),3e3))),"*",l),f=10,h=merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.a1("abs",merge_pass_1$2.op(merge_pass_1$2.op(2,"*",merge_pass_1$2.a1("fract",merge_pass_1$2.op(f,"*",merge_pass_1$2.getcomp(merge_pass_1$2.pos(),"x")))),"-",1)),"-",.5),"*",2),"*",a),E=merge_pass_1$2.a2("step",merge_pass_1$2.op(1,"-",merge_pass_1$2.op(1,"/",f*12)),merge_pass_1$2.a2("mod",merge_pass_1$2.op(merge_pass_1$2.getcomp(merge_pass_1$2.pos(),"x"),"+",merge_pass_1$2.random(merge_pass_1$2.op(merge_pass_1$2.vec2(50,50),"*",merge_pass_1$2.time()))),1)),F=merge_pass_1$2.op(h,"*",E),x=merge_pass_1$2.a2("mod",merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.pos(),"*",merge_pass_1$2.op(merge_pass_1$2.resolution(),"/",merge_pass_1$2.getcomp(merge_pass_1$2.resolution(),"y"))),"+",u),merge_pass_1$2.vec2(100,100)),b=merge_pass_1$2.op(merge_pass_1$2.op(merge_pass_1$2.simplex(merge_pass_1$2.op(x,"*",7)),"*",.44),"+",.5),M=merge_pass_1$2.op(merge_pass_1$2.a2("step",b,.08),"*",n);super(merge_pass_1$2.monochrome(merge_pass_1$2.brightness(M,merge_pass_1$2.brightness(F,merge_pass_1$2.brightness(p))))),this.speckIntensityFloat=n,this.lineIntensityFloat=a,this.grainIntensityFloat=l,this.speckIntensity=e,this.lineIntensity=r,this.grainIntensity=o}setSpeckIntensity(e){this.speckIntensityFloat.setVal(merge_pass_1$2.wrapInValue(e)),this.speckIntensity=merge_pass_1$2.wrapInValue(e)}setLineIntensity(e){this.lineIntensityFloat.setVal(merge_pass_1$2.wrapInValue(e)),this.lineIntensity=merge_pass_1$2.wrapInValue(e)}setGrainIntensity(e){this.grainIntensityFloat.setVal(merge_pass_1$2.wrapInValue(e)),this.grainIntensity=merge_pass_1$2.wrapInValue(e)}}oldfilm$1.OldFilm=OldFilm;function oldfilm(t=merge_pass_1$2.mut(.4),e=merge_pass_1$2.mut(.12),r=merge_pass_1$2.mut(.11)){return new OldFilm(merge_pass_1$2.wrapInValue(t),merge_pass_1$2.wrapInValue(e),merge_pass_1$2.wrapInValue(r))}oldfilm$1.oldfilm=oldfilm;var kaleidoscope$1={};Object.defineProperty(kaleidoscope$1,"__esModule",{value:!0});kaleidoscope$1.kaleidoscope=kaleidoscope$1.Kaleidoscope=void 0;const merge_pass_1$1=dist;class Kaleidoscope extends merge_pass_1$1.WrappedExpr{constructor(e,r){const o=merge_pass_1$1.float(e),n=merge_pass_1$1.float(r),a=merge_pass_1$1.op(merge_pass_1$1.translate(merge_pass_1$1.pos(),merge_pass_1$1.vec2(-.5,-.5)),"/",n),l=merge_pass_1$1.a2("atan",merge_pass_1$1.getcomp(a,"y"),merge_pass_1$1.getcomp(a,"x")),u=merge_pass_1$1.op(2*Math.PI,"*",merge_pass_1$1.op(1,"/",o)),p=merge_pass_1$1.op(merge_pass_1$1.a1("floor",merge_pass_1$1.op(l,"/",u)),"*",u),f=merge_pass_1$1.op(l,"-",p),h=merge_pass_1$1.op(u,"-",merge_pass_1$1.op(2,"*",f)),E=merge_pass_1$1.a1("floor",merge_pass_1$1.op(merge_pass_1$1.a2("mod",merge_pass_1$1.op(p,"+",.1),merge_pass_1$1.op(u,"*",2)),"/",u)),F=merge_pass_1$1.translate(merge_pass_1$1.rotate(a,merge_pass_1$1.op(p,"-",merge_pass_1$1.op(h,"*",E))),merge_pass_1$1.vec2(.5,.5));super(merge_pass_1$1.channel(-1,F)),this.sidesFloat=o,this.scaleFloat=n,this.sides=e,this.scale=r}setSides(e){this.sidesFloat.setVal(merge_pass_1$1.wrapInValue(e)),this.sides=merge_pass_1$1.wrapInValue(e)}setScale(e){this.scaleFloat.setVal(merge_pass_1$1.wrapInValue(e)),this.scale=merge_pass_1$1.wrapInValue(e)}}kaleidoscope$1.Kaleidoscope=Kaleidoscope;function kaleidoscope(t=merge_pass_1$1.mut(8),e=merge_pass_1$1.mut(1)){return new Kaleidoscope(merge_pass_1$1.wrapInValue(t),merge_pass_1$1.wrapInValue(e))}kaleidoscope$1.kaleidoscope=kaleidoscope;var celshade$1={};Object.defineProperty(celshade$1,"__esModule",{value:!0});celshade$1.celshade=celshade$1.CelShade=void 0;const merge_pass_1=dist;class CelShade extends merge_pass_1.WrappedExpr{constructor(e,r,o,n){const a=merge_pass_1.float(e),l=merge_pass_1.float(r),u=merge_pass_1.float(o),p=merge_pass_1.float(n),f=merge_pass_1.cfloat(merge_pass_1.tag`(smoothstep(-${p} + ${u}, ${p} + ${u}, ${merge_pass_1.rgb2hsv(merge_pass_1.fcolor())}.z) * ${a} + ${l})`),h=merge_pass_1.hsv2rgb(merge_pass_1.changecomp(merge_pass_1.rgb2hsv(merge_pass_1.fcolor()),f,"z"));super(h),this.multFloat=a,this.bumpFloat=l,this.centerFloat=u,this.edgeFloat=p,this.mult=e,this.bump=r,this.center=o,this.edge=n}setMult(e){this.multFloat.setVal(merge_pass_1.wrapInValue(e)),this.mult=merge_pass_1.wrapInValue(e)}setBump(e){this.bumpFloat.setVal(merge_pass_1.wrapInValue(e)),this.bump=merge_pass_1.wrapInValue(e)}setCenter(e){this.centerFloat.setVal(merge_pass_1.wrapInValue(e)),this.center=merge_pass_1.wrapInValue(e)}setEdge(e){this.edgeFloat.setVal(merge_pass_1.wrapInValue(e)),this.edge=merge_pass_1.wrapInValue(e)}}celshade$1.CelShade=CelShade;function celshade(t=merge_pass_1.mut(.8),e=merge_pass_1.mut(.3),r=merge_pass_1.mut(.3),o=merge_pass_1.mut(.03)){return new CelShade(merge_pass_1.wrapInValue(t),merge_pass_1.wrapInValue(e),merge_pass_1.wrapInValue(r),merge_pass_1.wrapInValue(o))}celshade$1.celshade=celshade;(function(t){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,n,a,l){l===void 0&&(l=a),Object.defineProperty(o,l,{enumerable:!0,get:function(){return n[a]}})}:function(o,n,a,l){l===void 0&&(l=a),o[l]=n[a]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(o,n){for(var a in o)a!=="default"&&!n.hasOwnProperty(a)&&e(n,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),r(foggyrays$1,t),r(vignette$1,t),r(blurandtrace$1,t),r(lightbands$1,t),r(noisedisplacement$1,t),r(oldfilm$1,t),r(kaleidoscope$1,t),r(celshade$1,t)})(dist$1);document.getElementById("gl");const processed=document.getElementById("processed");processed.getContext("webgl");let gl,framebuffer,simulationProgram,drawProgram,uTime,uSimulationState,uRes,uAudio,uDA,uDB,uFeed,uKill,uDiffuse,uColA,uColB,uAutomata,textureBack,textureFront,dimensions={width:null,height:null},diffuse=!1,automata=!1,colA=getColor("A"),colB=getColor("B"),audio,audioData,bufferLength,analyser,audioContext,audioElement,uVar={dA:[1,!1,0,1],dB:[.5,!1,0,1],f:[.055,!1,0,.1],k:[.062,!1,0,.1]},mic=!1,width,height;const presets=[{dA:1,dB:.2,f:.029,k:.057},{dA:.21,dB:.105,f:.022,k:.049},{dA:.21,dB:.13,f:.041,k:.059},{dA:.21,dB:.105,f:.015,k:.049},{dA:.21,dB:.105,f:.049,k:.061}];let prevShuffle=-1;window.onload=function(){document.getElementById("loading").style.display="none",navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){audioContext=new(window.AudioContext||window.webkitAudioContext),audioElement=document.querySelector("audio");const e=audioContext.createMediaElementSource(audioElement);analyser=audioContext.createAnalyser(),analyser.fftSize=256,bufferLength=analyser.frequencyBinCount,audio=new Uint8Array(bufferLength),e.connect(analyser),analyser.connect(audioContext.destination),analyser.getByteFrequencyData(audio),mic=!0,audioElement.addEventListener("ended",()=>{},!1)});const canvas=document.getElementById("gl"),processed=document.getElementById("processed");gl=canvas.getContext("webgl"),width=canvas.width=processed.width=dimensions.width=document.body.clientWidth,height=canvas.height=processed.height=dimensions.height=document.body.clientHeight,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),makeBuffer(),makeShaders(),makeTextures(),setInitialState();const cm=CodeMirror(document.getElementById("editor"),{value:`feed(0.029)
kill(audio)
rateA(1)
rateB(0.2)
diffuse(true)
            
playMusic(1)`,mode:"javascript",lineNumbers:!0,colorpicker:{mode:"edit",type:"mini",outputFormat:"hex"}});cm.setOption("extraKeys",{"Ctrl-Enter":function(cm){var code=cm.getValue(),parsedCode=peg$parse(code);console.log(parsedCode),eval("("+parsedCode+")")},"Shift-Enter":function(t){runSelected(t)}});var helpIcon=document.getElementById("helpIcon"),overlay=document.getElementById("popupContainer"),shuffleIcon=document.getElementById("shuffleIcon"),tabHeader=document.getElementsByClassName("tab-header")[0],tabIndicator=document.getElementsByClassName("tab-indicator")[0],tabBody=document.getElementsByClassName("tab-body")[0],tabs=tabHeader.getElementsByTagName("div"),paramB=document.getElementById("paramB");helpIcon.addEventListener("click",t=>{document.getElementById("helpPopup").classList.add("open-popup"),overlay.style.visibility="visible",console.log("click")}),overlay.addEventListener("click",t=>{let e=document.getElementsByClassName("popup");overlay.style.visibility="hidden";for(let r of e)r.classList.remove("open-popup")}),shuffleIcon.addEventListener("click",t=>{let e=Math.floor(Math.random()*(presets.length-1));for(;e===prevShuffle;)e=Math.floor(Math.random()*(presets.length-1));console.log(e),uVar.dA[0]=presets[e].dA,uVar.dB[0]=presets[e].dB,uVar.f[0]=presets[e].f,uVar.k[0]=presets[e].k,uVar.dA[1]=!1,uVar.dB[1]=!1,uVar.f[1]=!1,uVar.k[1]=!1,prevShuffle=e});for(let t=0;t<tabs.length;t++)tabs[t].addEventListener("click",e=>{tabHeader.getElementsByClassName("active-tab")[0].classList.remove("active-tab"),tabs[t].classList.add("active-tab"),tabBody.getElementsByClassName("active-tab")[0].classList.remove("active-tab"),tabBody.getElementsByTagName("div")[t].classList.add("active-tab"),tabIndicator.style.left=`calc(calc(100% / 3) * ${t})`});paramB.addEventListener("click",t=>{var e=document.getElementsByClassName("paramContent");console.log("click");for(var r=0;r<e.length;r++)e[r].style.display==="none"?e[r].style.display="block":e[r].style.display="none"}),paramInfo()};function paramInfo(){for(var t=document.getElementById("textParams");t.firstChild;)t.removeChild(t.firstChild);for(let e in uVar){let r=document.createElement("p"),o=parseFloat(uVar[e][0]).toFixed(4);r.textContent=e+": "+o+`
`,t.append(r)}}function poke(t,e,r,o,n,a){gl.bindTexture(gl.TEXTURE_2D,a),gl.texSubImage2D(gl.TEXTURE_2D,0,t,e,1,1,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([r,o,n,255]))}var poking=function t(e,r,o,n,a){poke(e,r,o,n,a,textureBack)};function setInitialState(){gl.uniform1f(uDA,uVar.dA[0]),gl.uniform1f(uDB,uVar.dB[0]),gl.uniform1f(uFeed,uVar.f[0]),gl.uniform1f(uKill,uVar.k[0]);var t=width/2,e=height/2;rect(t,e,100,100)}function makeBuffer(){const t=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,t);const e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);gl.bufferData(gl.ARRAY_BUFFER,e,gl.STATIC_DRAW)}function makeShaders(){let t=document.getElementById("vertex"),e=t.text;const r=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(r,e),gl.compileShader(r),t=document.getElementById("render"),e=t.text;const o=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(o,e),gl.compileShader(o),console.log(gl.getShaderInfoLog(o)),drawProgram=gl.createProgram(),gl.attachShader(drawProgram,r),gl.attachShader(drawProgram,o),gl.linkProgram(drawProgram),gl.useProgram(drawProgram),uRes=gl.getUniformLocation(drawProgram,"resolution"),uColA=gl.getUniformLocation(drawProgram,"colA"),uColB=gl.getUniformLocation(drawProgram,"colB"),gl.uniform2f(uRes,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.uniform3f(uColA,colA[0],colA[1],colA[2]),gl.uniform3f(uColB,colB[0],colB[1],colB[2]);let n=gl.getAttribLocation(drawProgram,"a_position");gl.enableVertexAttribArray(n),gl.vertexAttribPointer(n,2,gl.FLOAT,!1,0,0),t=document.getElementById("simulation"),e=t.text;const a=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(a,e),gl.compileShader(a),console.log(gl.getShaderInfoLog(a)),simulationProgram=gl.createProgram(),gl.attachShader(simulationProgram,r),gl.attachShader(simulationProgram,a),gl.linkProgram(simulationProgram),gl.useProgram(simulationProgram),uRes=gl.getUniformLocation(simulationProgram,"resolution"),gl.uniform2f(uRes,gl.drawingBufferWidth,gl.drawingBufferHeight),uTime=gl.getUniformLocation(simulationProgram,"time"),uDA=gl.getUniformLocation(simulationProgram,"dA"),uDB=gl.getUniformLocation(simulationProgram,"dB"),uFeed=gl.getUniformLocation(simulationProgram,"feed"),uKill=gl.getUniformLocation(simulationProgram,"kill"),gl.getUniformLocation(simulationProgram,"size"),uDiffuse=gl.getUniformLocation(simulationProgram,"diffuse"),uAutomata=gl.getUniformLocation(simulationProgram,"automata"),uAudio=gl.getUniformLocation(simulationProgram,"audioData"),uSimulationState=gl.getUniformLocation(simulationProgram,"state"),n=gl.getAttribLocation(simulationProgram,"a_position"),gl.enableVertexAttribArray(simulationProgram),gl.vertexAttribPointer(n,2,gl.FLOAT,!1,0,0)}function makeTextures(){gl.getExtension("EXT_color_buffer_float"),textureBack=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,textureBack),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,dimensions.width,dimensions.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),textureFront=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,textureFront),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,dimensions.width,dimensions.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),framebuffer=gl.createFramebuffer(),render()}let time=0;function render(){if(window.requestAnimationFrame(render),gl.useProgram(simulationProgram),mic===!0){analyser.getByteFrequencyData(audio);let r=0;for(var t=0;t<bufferLength;t++)r+=audio[t];audioData=r/bufferLength;for(let o in uVar)if(uVar[o][1]===!0){let n=uVar[o][2],a=uVar[o][3];audioData=map(audioData,0,200,n,a),uVar[o][0]=audioData}}time++,gl.uniform1f(uTime,time),gl.uniform1f(uDA,uVar.dA[0]),gl.uniform1f(uDB,uVar.dB[0]),gl.uniform1f(uFeed,uVar.f[0]),gl.uniform1f(uKill,uVar.k[0]),gl.uniform1f(uDiffuse,diffuse),gl.uniform1f(uAutomata,automata),gl.uniform1f(uAudio,audioData),time%100===0&&(paramInfo(),update(uVar,time)),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,textureFront,0),gl.viewport(0,0,dimensions.width,dimensions.height),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,textureBack),gl.uniform1i(uSimulationState,0),gl.drawArrays(gl.TRIANGLES,0,6);let e=textureFront;textureFront=textureBack,textureBack=e,gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,dimensions.width,dimensions.height),gl.bindTexture(gl.TEXTURE_2D,textureFront),gl.useProgram(drawProgram),gl.drawArrays(gl.TRIANGLES,0,6)}function map(t,e,r,o,n){return o+(t-e)*(n-o)/(r-e)}function runSelected(cm){let pos=cm.getCursor(),text=null;if(text=cm.getDoc().getSelection(),text===""?text=cm.getLine(pos.line):pos={start:cm.getCursor("start"),end:cm.getCursor("end")},pos.start===void 0){let t=pos.line,e=0,r=text.length;pos={start:{line:t,ch:e},end:{line:t,ch:r}}}console.log(text);var parsedCode=peg$parse(text);console.log(parsedCode),flash(cm,pos),eval("("+parsedCode+")")}function flash(t,e){let r,o=function(){r.clear()};e!==null?e.start?r=t.markText(e.start,e.end,{className:"CodeMirror-highlight"}):r=t.markText({line:e.line,ch:0},{line:e.line,ch:null},{className:"CodeMirror-highlight"}):(self=t.markText(t.getCursor(!0,t.getCursor(!1,{className:"CodeMirror-highlight"}))),window.setTimeout(o,250)),console.log("highlighted")}
